name       : tigervnc
version    : 1.10.1
release    : 7
source     :
    - https://github.com/TigerVNC/tigervnc/archive/v1.10.1.tar.gz : 19fcc80d7d35dd58115262e53cac87d8903180261d94c2a6b0c19224f50b58c4
    - https://www.x.org/releases/individual/xserver/xorg-server-1.20.6.tar.gz : 1f00a9444482280e3815de4642758fcb279496002becb85c2f9d994456903ad4
license    :
    - GPL-2.0-or-later
    - MIT
component  : network.util
summary    : TigerVNC is a high-performance implementation of the VNC protocol, which allows you to control/view desktops remotely over the internet.
description: |
    Virtual Network Computing (VNC) is a remote display system which allows you to view and interact with a virtual desktop environment that is running on another computer on the network.
builddeps  :
    - pkgconfig(fontutil)
    - pkgconfig(libturbojpeg)
    - pkgconfig(xfont2)
    - pkgconfig(xkbfile)
    - pkgconfig(xorg-macros)
    - pkgconfig(xorg-server)
    - pkgconfig(xproto)
    - pkgconfig(xrender)
    - pkgconfig(xshmfence)
    - pkgconfig(xtrans)
    - fltk-devel
environment: |
    export CPATH="/usr/include/libdrm"
setup      : |
    #extract xorg
    for i in $sources/xorg-server-*.tar.gz; do
            tar xf ${i} -C $workdir/unix/xserver/
    done

    #patch xorg
    cp -r $workdir/unix/xserver/xorg-server-*/* $workdir/unix/xserver
    %patch --directory=$workdir/unix/xserver -p1 < $workdir/unix/xserver120.patch

    #deleted old xorg-server folder
    rm -r $workdir/unix/xserver/xorg-server-*

    #setup tigervnc-server
    pushd $workdir/unix/xserver
    autoreconf -fiv
    %configure --prefix=%PREFIX% \
        --with-pic \
        --without-dtrace \
        --enable-dri2 \
        --enable-dri3 \
        --enable-glx \
        --disable-dri \
        --disable-static \
        --disable-xorg \
        --disable-xnest \
        --disable-xvfb \
        --disable-dmx \
        --disable-xwin \
        --disable-xephyr \
        --disable-kdrive \
        --disable-xwayland \
        --disable-selective-werror \
        --disable-config-hal \
        --disable-config-udev \
        --disable-unit-tests \
        --disable-devel-docs
    popd
    #setup tigervnc
    %cmake -G "Unix Makefiles" \
    -DCMAKE_INSTALL_PREFIX=/usr
build      : |
    #build tigervnc
    %make

    #build tigervnc-server
    %make -C unix/xserver
install    : |
    #install tigervnc
    %make_install

    #install tigervnc-server
    %make_install -C unix/xserver
    rm -rf $installdir/usr/lib64/xorg/protocol.txt
    rm -rf $installdir/usr/share/man/man1/Xserver.1

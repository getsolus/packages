name       : tlp
version    : 1.2.2
release    : 14
source     :
    - https://github.com/linrunner/TLP/archive/1.2.2.tar.gz : 5c28bdda51661160f75b10634fa0fffad96e83204a7c704dad0095de6fee3315
license    : GPL-2.0-only
component  : system.utils
summary    : Linux Advanced Power Management
description: |
    Linux Advanced Power Management
builddeps  :
    - hdparm
    - iw
rundeps    :
    - linux-tools-x86_energy_perf_policy
setup      : |
    %patch -p1 < $pkgfiles/0001-Don-t-enable-tlp-service-on-virtualised-platforms.patch
    sed -i 's:SOUND_POWER_SAVE_ON_BAT=1:SOUND_POWER_SAVE_ON_BAT=0:g' default # Disable Audio Power Save
    sed -i 's:USB_AUTOSUSPEND=1:USB_AUTOSUSPEND=0:g' default # Disable USB Autosuspend
    sed -i 's:WIFI_PWR_ON_BAT=on:WIFI_PWR_ON_BAT=off:g' default # Disable Wireless Power Management
build      : |
    export TLP_LIBDIR='%libdir%'
    export TLP_SBIN='/usr/sbin'
    export TLP_ULIB='%libdir%/udev/'
    %make
install    : |
    export TLP_NO_INIT='1'
    export TLP_SYSD='%libdir%/systemd/system/'
    export TLP_ULIB='%libdir%/udev/'
    export TLP_WITH_ELOGIND='0'
    %make_install install-man
    rm -rf $installdir/var

    # Enable by default, users can disable now with systemctl mask tlp
    install -Ddm 00755 $installdir/%libdir%/systemd/system/multi-user.target.wants
    ln -sv ../tlp.service $installdir/%libdir%/systemd/system/multi-user.target.wants

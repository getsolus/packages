# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: google-cloud-sdk
version: 545.0.0
release: 36
source:
    - https://dl.google.com/dl/cloudsdk/release/downloads/for_packagers/linux/google-cloud-cli_545.0.0.orig_amd64.tar.gz: 2ab25d163fcb9604c1f28a3ce1928957ef4a8af09814472c1150cc698dd570f7
    - https://dl.google.com/dl/cloudsdk/release/downloads/for_packagers/linux/google-cloud-cli-gke-gcloud-auth-plugin_545.0.0.orig_amd64.tar.gz: 6f47b8c1ed504f17f8195a797e73ef0f7eaaaffc30840ac6ff24c331b98f3427
extract: false
strip: false
license: Apache-2.0
homepage: https://cloud.google.com/cli
component: network.clients
summary: Command-line tools for the Google Cloud Platform.
description: |
    A set of command-line tools for the Google Cloud Platform. Includes gcloud (with beta and alpha commands), gsutil, and bq.
builddeps:
    - pkgconfig(python3)
environment: |
    export CLOUDSDK_INSTALL_DIR=$installdir/usr/share/google-cloud-sdk
install: |
    mkdir -p $CLOUDSDK_INSTALL_DIR
    tar -xzvf $sources/google-cloud-cli_%version%.orig_amd64.tar.gz -C $installdir/usr/share
    tar -xzvf $sources/google-cloud-cli-gke-gcloud-auth-plugin_%version%.orig_amd64.tar.gz -C $installdir/usr/share

    cd $CLOUDSDK_INSTALL_DIR

    ./install.sh \
    --quiet \
    --usage-reporting False \
    --path-update False \
    --bash-completion False \
    > /dev/null

    # do a cleanup
    find $installdir -name '__pycache__' -type d -exec rm -rf {} +
    rm -rf .install install.* rpm deb
    # remove bundled python, use system python
    rm -rf platform/bundledpythonunix

    # install manpages
    mv -f help/man $installdir/usr/share/
    chmod 00644 $installdir/usr/share/man
    chmod 00644 $installdir/usr/share/man/man1
    rm -rf help

    # fix execute rights
    find . -name "*.html" -o -name "*.json" -exec chmod -x {} \;
    find . -name "*_test.py" -exec chmod +x {} \;

    # Install profile.d script sets up needed environment variables
    install -D -m 00644 $pkgfiles/50-google-cloud-sdk.sh $installdir/usr/share/defaults/etc/profile.d/50-google-cloud-sdk.sh

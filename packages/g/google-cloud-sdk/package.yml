# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : google-cloud-sdk
version    : 550.0.0
release    : 37
source     :
    - https://dl.google.com/dl/cloudsdk/release/downloads/for_packagers/linux/google-cloud-cli_550.0.0.orig_amd64.tar.gz : db4bfb7d01cfaf3a520f526234f5f9745dea5064753f4b01f9c84a402e31cd28
    - https://dl.google.com/dl/cloudsdk/release/downloads/for_packagers/linux/google-cloud-cli-gke-gcloud-auth-plugin_550.0.0.orig_amd64.tar.gz : d554128621096d81466eda8b814830e5fe33da7f5ac49ed89f09c4b8eb261008
extract    : false
strip      : false
license    : Apache-2.0
homepage   : https://cloud.google.com/cli
component  : network.clients
summary    : Command-line tools for the Google Cloud Platform.
description: |
    A set of command-line tools for the Google Cloud Platform. Includes gcloud (with beta and alpha commands), gsutil, and bq.
builddeps  :
    - pkgconfig(python3)
environment: |
    export CLOUDSDK_INSTALL_DIR=$installdir/usr/share/google-cloud-sdk
install    : |
    mkdir -p $CLOUDSDK_INSTALL_DIR
    tar -xzvf $sources/google-cloud-cli_%version%.orig_amd64.tar.gz -C $installdir/usr/share
    tar -xzvf $sources/google-cloud-cli-gke-gcloud-auth-plugin_%version%.orig_amd64.tar.gz -C $installdir/usr/share

    cd $CLOUDSDK_INSTALL_DIR

    ./install.sh \
    --quiet \
    --usage-reporting False \
    --path-update False \
    --bash-completion False \
    > /dev/null

    # do a cleanup
    find $installdir -name '__pycache__' -type d -exec rm -rf {} +
    rm -rf .install install.* rpm deb
    # remove bundled python, use system python
    rm -rf platform/bundledpythonunix

    # install manpages
    mv -f help/man $installdir/usr/share/
    chmod 00644 $installdir/usr/share/man
    chmod 00644 $installdir/usr/share/man/man1
    rm -rf help

    # fix execute rights
    find . -name "*.html" -o -name "*.json" -exec chmod -x {} \;
    find . -name "*_test.py" -exec chmod +x {} \;

    # Install profile.d script sets up needed environment variables
    install -D -m 00644 $pkgfiles/50-google-cloud-sdk.sh $installdir/usr/share/defaults/etc/profile.d/50-google-cloud-sdk.sh

    %install_license LICENSE
patterns   :
    - docs :
        - /usr/share/man
From 7eee0d5eec6135d80ef57dd8708e3f1d315b11d8 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Mon, 12 May 2014 14:57:18 +0200
Subject: [PATCH 01/16] Restore transparency

The transparency settings were removed as a side effect of
2bff4b63ed3ceef6055e35563e9b0b33ad57349d

This restores them and you will need a compositing window manager to
use it. The background image setting, also known as faux transparency,
was not restored.

The transparency checkbox lost its mnemonic accelerator because 't'
is already taken and using any other letter would make it hard to
restore the translations of the string.

Some changes by Peter Weber <peter.weber@mailbox.org>
---
 src/org.gnome.Terminal.gschema.xml | 10 +++++++
 src/preferences.ui                 | 47 ++++++++++++++++++++++++++++++
 src/profile-editor.cc              | 19 ++++++++++++
 src/terminal-schemas.hh            |  3 ++
 src/terminal-screen.cc             | 22 +++++++++++++-
 src/terminal-window.cc             |  7 +++++
 6 files changed, 107 insertions(+), 1 deletion(-)

diff --git a/src/org.gnome.Terminal.gschema.xml b/src/org.gnome.Terminal.gschema.xml
index 882b251a..d34e8dc2 100644
--- a/src/org.gnome.Terminal.gschema.xml
+++ b/src/org.gnome.Terminal.gschema.xml
@@ -349,6 +349,16 @@
       <default>'narrow'</default>
       <summary>Whether ambiguous-width characters are narrow or wide when using UTF-8 encoding</summary>
     </key>
+    <key name="use-transparent-background" type="b">
+      <default>false</default>
+      <summary>Whether to use a transparent background</summary>
+    </key>
+    <key name="background-transparency-percent" type="i">
+      <default>50</default>
+      <range min="0" max="100"/>
+      <summary>Adjust the amount of transparency</summary>
+      <description>A value between 0 and 100, where 0 is opaque and 100 is fully transparent.</description>
+    </key>
   </schema>
 
   <!-- Keybinding settings -->
diff --git a/src/preferences.ui b/src/preferences.ui
index ca58c656..f3979307 100644
--- a/src/preferences.ui
+++ b/src/preferences.ui
@@ -95,6 +95,11 @@
     <property name="step_increment">0.05</property>
     <property name="page_increment">0.25</property>
   </object>
+  <object class="GtkAdjustment" id="background-transparent-adjustment">
+    <property name="upper">100</property>
+    <property name="step_increment">1</property>
+    <property name="page_increment">10</property>
+  </object>
   <object class="GtkListStore" id="cjk-ambiguous-width-model">
     <columns>
       <!-- column-name gchararray -->
@@ -1435,6 +1440,48 @@
                                             <property name="position">1</property>
                                           </packing>
                                         </child>
+                                        <child>
+                                          <object class="GtkBox" id="use-transparent-background-box">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="orientation">horizontal</property>
+                                            <property name="spacing">12</property>
+                                            <child>
+                                              <object class="GtkCheckButton" id="use-transparent-background">
+                                                <property name="label" translatable="yes">Transparent background</property>
+                                                <property name="visible">True</property>
+                                                <property name="can_focus">True</property>
+                                                <property name="receives_default">False</property>
+                                                <property name="use_underline">True</property>
+                                                <property name="xalign">0</property>
+                                                <property name="draw_indicator">True</property>
+                                              </object>
+                                              <packing>
+                                                <property name="expand">False</property>
+                                                <property name="fill">False</property>
+                                                <property name="position">0</property>
+                                              </packing>
+                                            </child>
+                                            <child>
+                                              <object class="GtkScale" id="background-transparent-scale">
+                                                <property name="visible">True</property>
+                                                <property name="can_focus">True</property>
+                                                <property name="adjustment">background-transparent-adjustment</property>
+                                                <property name="draw_value">False</property>
+                                              </object>
+                                              <packing>
+                                                <property name="expand">True</property>
+                                                <property name="fill">True</property>
+                                                <property name="position">1</property>
+                                              </packing>
+                                            </child>
+                                          </object>
+                                          <packing>
+                                            <property name="expand">True</property>
+                                            <property name="fill">True</property>
+                                            <property name="position">2</property>
+                                          </packing>
+                                        </child>
                                       </object>
                                     </child>
                                   </object>
diff --git a/src/profile-editor.cc b/src/profile-editor.cc
index 0cb99b62..d0e71e26 100644
--- a/src/profile-editor.cc
+++ b/src/profile-editor.cc
@@ -1491,6 +1491,25 @@ profile_prefs_load (const char *uuid, GSettings *profile)
 			       GSettingsBindFlags(G_SETTINGS_BIND_GET |
 						  G_SETTINGS_BIND_SET));
   gtk_widget_set_visible (w, (vte_get_feature_flags() & VTE_FEATURE_FLAG_SIXEL) != 0);
+
+  profile_prefs_settings_bind (profile,
+                               TERMINAL_PROFILE_USE_TRANSPARENT_BACKGROUND,
+                               gtk_builder_get_object (builder, "use-transparent-background"),
+                               "active",
+                               GSettingsBindFlags(G_SETTINGS_BIND_GET |
+                                                  G_SETTINGS_BIND_SET));
+  profile_prefs_settings_bind (profile,
+                               TERMINAL_PROFILE_USE_TRANSPARENT_BACKGROUND,
+                               gtk_builder_get_object (builder, "background-transparent-scale"),
+                               "sensitive",
+                               GSettingsBindFlags(G_SETTINGS_BIND_GET |
+                                                  G_SETTINGS_BIND_NO_SENSITIVITY));
+  profile_prefs_settings_bind (profile,
+                               TERMINAL_PROFILE_BACKGROUND_TRANSPARENCY_PERCENT,
+                               gtk_builder_get_object (builder, "background-transparent-adjustment"),
+                               "value",
+                               GSettingsBindFlags(G_SETTINGS_BIND_GET |
+                                                  G_SETTINGS_BIND_SET));
 }
 
 /* Called once per Preferences window, to destroy stuff that doesn't depend on the profile being edited */
diff --git a/src/terminal-schemas.hh b/src/terminal-schemas.hh
index 61f1305e..c33723bf 100644
--- a/src/terminal-schemas.hh
+++ b/src/terminal-schemas.hh
@@ -78,6 +78,9 @@ G_BEGIN_DECLS
 #define TERMINAL_PROFILE_VISIBLE_NAME_KEY               "visible-name"
 #define TERMINAL_PROFILE_WORD_CHAR_EXCEPTIONS_KEY       "word-char-exceptions"
 
+#define TERMINAL_PROFILE_USE_TRANSPARENT_BACKGROUND      "use-transparent-background"
+#define TERMINAL_PROFILE_BACKGROUND_TRANSPARENCY_PERCENT "background-transparency-percent"
+
 #define TERMINAL_SETTING_CONFIRM_CLOSE_KEY              "confirm-close"
 #define TERMINAL_SETTING_CONTEXT_INFO_KEY               "context-info"
 #define TERMINAL_SETTING_DEFAULT_SHOW_MENUBAR_KEY       "default-show-menubar"
diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index a559f7f9..16f98c9d 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -1059,7 +1059,9 @@ terminal_screen_profile_changed_cb (GSettings     *profile,
       prop_name == I_(TERMINAL_PROFILE_HIGHLIGHT_COLORS_SET_KEY) ||
       prop_name == I_(TERMINAL_PROFILE_HIGHLIGHT_BACKGROUND_COLOR_KEY) ||
       prop_name == I_(TERMINAL_PROFILE_HIGHLIGHT_FOREGROUND_COLOR_KEY) ||
-      prop_name == I_(TERMINAL_PROFILE_PALETTE_KEY))
+      prop_name == I_(TERMINAL_PROFILE_PALETTE_KEY) ||
+      prop_name == I_(TERMINAL_PROFILE_USE_TRANSPARENT_BACKGROUND) ||
+      prop_name == I_(TERMINAL_PROFILE_BACKGROUND_TRANSPARENCY_PERCENT))
     update_color_scheme (screen);
 
   if (!prop_name || prop_name == I_(TERMINAL_PROFILE_AUDIBLE_BELL_KEY))
@@ -1144,6 +1146,8 @@ update_color_scheme (TerminalScreen *screen)
   GdkRGBA *cursor_bgp = nullptr, *cursor_fgp = nullptr;
   GdkRGBA *highlight_bgp = nullptr, *highlight_fgp = nullptr;
   GtkStyleContext *context;
+  GtkWidget *toplevel;
+  gboolean transparent;
   gboolean use_theme_colors;
 
   context = gtk_widget_get_style_context (widget);
@@ -1187,6 +1191,18 @@ update_color_scheme (TerminalScreen *screen)
     }
 
   colors = terminal_g_settings_get_rgba_palette (priv->profile, TERMINAL_PROFILE_PALETTE_KEY, &n_colors);
+
+  transparent = g_settings_get_boolean (profile, TERMINAL_PROFILE_USE_TRANSPARENT_BACKGROUND);
+  if (transparent)
+    {
+      gint transparency_percent;
+
+      transparency_percent = g_settings_get_int (profile, TERMINAL_PROFILE_BACKGROUND_TRANSPARENCY_PERCENT);
+      bg.alpha = (100 - transparency_percent) / 100.0;
+    }
+  else
+    bg.alpha = 1.0;
+
   vte_terminal_set_colors (VTE_TERMINAL (screen), &fg, &bg,
                            colors, n_colors);
   vte_terminal_set_color_bold (VTE_TERMINAL (screen), boldp);
@@ -1194,6 +1210,10 @@ update_color_scheme (TerminalScreen *screen)
   vte_terminal_set_color_cursor_foreground (VTE_TERMINAL (screen), cursor_fgp);
   vte_terminal_set_color_highlight (VTE_TERMINAL (screen), highlight_bgp);
   vte_terminal_set_color_highlight_foreground (VTE_TERMINAL (screen), highlight_fgp);
+
+  toplevel = gtk_widget_get_toplevel (GTK_WIDGET (screen));
+  if (toplevel != nullptr && gtk_widget_is_toplevel (toplevel))
+    gtk_widget_set_app_paintable (toplevel, transparent);
 }
 
 static void
diff --git a/src/terminal-window.cc b/src/terminal-window.cc
index 36eb7ce7..a41d2de2 100644
--- a/src/terminal-window.cc
+++ b/src/terminal-window.cc
@@ -2173,6 +2173,8 @@ terminal_window_init (TerminalWindow *window)
   };
   TerminalWindowPrivate *priv;
   TerminalApp *app;
+  GdkScreen *screen;
+  GdkVisual *visual;
   GSettings *gtk_debug_settings;
   GtkWindowGroup *window_group;
   //  GtkAccelGroup *accel_group;
@@ -2188,6 +2190,11 @@ terminal_window_init (TerminalWindow *window)
 
   gtk_widget_init_template (GTK_WIDGET (window));
 
+  screen = gtk_widget_get_screen (GTK_WIDGET (window));
+  visual = gdk_screen_get_rgba_visual (screen);
+  if (visual != nullptr)
+    gtk_widget_set_visual (GTK_WIDGET (window), visual);
+
   uuid_generate (u);
   uuid_unparse (u, uuidstr);
   priv->uuid = g_strdup (uuidstr);
-- 
2.40.0


From 212f0ed4a860aa9a348a7ec2499f0c178c2b5688 Mon Sep 17 00:00:00 2001
From: Lars Uebernickel <lars.uebernickel@canonical.com>
Date: Wed, 28 May 2014 14:11:02 +0200
Subject: [PATCH 02/16] window: Make the drawing robust across all themes

There are lots of themes out there in the wild that do not specify a
background-color for all widgets and the default is transparent. This
is usually not a problem because GTK+ sets an opaque region on the
whole window and things without a background-color get drawn with the
theme's default background colour. However, to achieve transparency
we disable the opaque region by making the window app-paintable. This
can lead to transparent menubars or notebook tabs in some themes. We
can avoid this by ensuring that the window always renders a background.

https://bugzilla.gnome.org/show_bug.cgi?id=730016
---
 src/terminal-window.cc | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)

diff --git a/src/terminal-window.cc b/src/terminal-window.cc
index a41d2de2..11d93419 100644
--- a/src/terminal-window.cc
+++ b/src/terminal-window.cc
@@ -2003,6 +2003,26 @@ terminal_window_realize (GtkWidget *widget)
   terminal_window_update_size (window);
 }
 
+static gboolean
+terminal_window_draw (GtkWidget *widget,
+                      cairo_t   *cr)
+{
+  if (gtk_widget_get_app_paintable (widget))
+    {
+      GtkStyleContext *context;
+      int width;
+      int height;
+
+      context = gtk_widget_get_style_context (widget);
+      width = gtk_widget_get_allocated_width (widget);
+      height = gtk_widget_get_allocated_height (widget);
+      gtk_render_background (context, cr, 0, 0, width, height);
+      gtk_render_frame (context, cr, 0, 0, width, height);
+    }
+
+  return GTK_WIDGET_CLASS (terminal_window_parent_class)->draw (widget, cr);
+}
+
 static gboolean
 terminal_window_state_event (GtkWidget            *widget,
                              GdkEventWindowState  *event)
@@ -2368,6 +2388,7 @@ terminal_window_class_init (TerminalWindowClass *klass)
 
   widget_class->show = terminal_window_show;
   widget_class->realize = terminal_window_realize;
+  widget_class->draw = terminal_window_draw;
   widget_class->window_state_event = terminal_window_state_event;
   widget_class->screen_changed = terminal_window_screen_changed;
   widget_class->style_updated = terminal_window_style_updated;
-- 
2.40.0


From 9e0de768d56f985e674f0079b9691875af2664d7 Mon Sep 17 00:00:00 2001
From: "Owen W. Taylor" <otaylor@fishsoup.net>
Date: Fri, 13 Nov 2015 15:16:42 +0100
Subject: [PATCH 03/16] screen, window: Extra padding around transparent
 terminals in Wayland

https://bugzilla.redhat.com/show_bug.cgi?id=1207943
---
 src/terminal-screen.cc | 41 +++++++++++++++++++++++++++++++++++++----
 src/terminal-window.cc | 18 ++++++++++++------
 2 files changed, 49 insertions(+), 10 deletions(-)

diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 16f98c9d..51fdc20b 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -156,6 +156,8 @@ static void terminal_screen_system_font_changed_cb (GSettings *,
 static gboolean terminal_screen_popup_menu (GtkWidget *widget);
 static gboolean terminal_screen_button_press (GtkWidget *widget,
                                               GdkEventButton *event);
+static void terminal_screen_hierarchy_changed (GtkWidget *widget,
+                                               GtkWidget *previous_toplevel);
 static void terminal_screen_child_exited  (VteTerminal *terminal,
                                            int status);
 
@@ -599,6 +601,7 @@ terminal_screen_class_init (TerminalScreenClass *klass)
   widget_class->drag_data_received = terminal_screen_drag_data_received;
   widget_class->button_press_event = terminal_screen_button_press;
   widget_class->popup_menu = terminal_screen_popup_menu;
+  widget_class->hierarchy_changed = terminal_screen_hierarchy_changed;
 
   terminal_class->child_exited = terminal_screen_child_exited;
 
@@ -1131,6 +1134,32 @@ terminal_screen_profile_changed_cb (GSettings     *profile,
   g_object_thaw_notify (object);
 }
 
+static void
+update_toplevel_transparency (TerminalScreen *screen)
+{
+  GtkWidget *widget = GTK_WIDGET (screen);
+  TerminalScreenPrivate *priv = screen->priv;
+  GSettings *profile = priv->profile;
+  GtkWidget *toplevel;
+
+  toplevel = gtk_widget_get_toplevel (widget);
+  if (toplevel != nullptr && gtk_widget_is_toplevel (toplevel))
+    {
+      gboolean transparent;
+
+      transparent = g_settings_get_boolean (profile, TERMINAL_PROFILE_USE_TRANSPARENT_BACKGROUND);
+      if (gtk_widget_get_app_paintable (toplevel) != transparent)
+        {
+          gtk_widget_set_app_paintable (toplevel, transparent);
+
+          /* The opaque region of the toplevel isn't updated until the toplevel is allocated;
+           * set_app_paintable() doesn't force an allocation, so do that manually.
+           */
+          gtk_widget_queue_resize (toplevel);
+        }
+    }
+}
+
 static void
 update_color_scheme (TerminalScreen *screen)
 {
@@ -1146,7 +1175,6 @@ update_color_scheme (TerminalScreen *screen)
   GdkRGBA *cursor_bgp = nullptr, *cursor_fgp = nullptr;
   GdkRGBA *highlight_bgp = nullptr, *highlight_fgp = nullptr;
   GtkStyleContext *context;
-  GtkWidget *toplevel;
   gboolean transparent;
   gboolean use_theme_colors;
 
@@ -1211,9 +1239,7 @@ update_color_scheme (TerminalScreen *screen)
   vte_terminal_set_color_highlight (VTE_TERMINAL (screen), highlight_bgp);
   vte_terminal_set_color_highlight_foreground (VTE_TERMINAL (screen), highlight_fgp);
 
-  toplevel = gtk_widget_get_toplevel (GTK_WIDGET (screen));
-  if (toplevel != nullptr && gtk_widget_is_toplevel (toplevel))
-    gtk_widget_set_app_paintable (toplevel, transparent);
+  update_toplevel_transparency (screen);
 }
 
 static void
@@ -1755,6 +1781,13 @@ terminal_screen_do_popup (TerminalScreen *screen,
   terminal_screen_popup_info_unref (info);
 }
 
+static void
+terminal_screen_hierarchy_changed (GtkWidget *widget,
+                                   GtkWidget *previous_toplevel)
+{
+  update_toplevel_transparency (TERMINAL_SCREEN (widget));
+}
+
 static gboolean
 terminal_screen_button_press (GtkWidget      *widget,
                               GdkEventButton *event)
diff --git a/src/terminal-window.cc b/src/terminal-window.cc
index 11d93419..61857bfe 100644
--- a/src/terminal-window.cc
+++ b/src/terminal-window.cc
@@ -2009,15 +2009,21 @@ terminal_window_draw (GtkWidget *widget,
 {
   if (gtk_widget_get_app_paintable (widget))
     {
+      GtkAllocation child_allocation;
       GtkStyleContext *context;
-      int width;
-      int height;
+      GtkWidget *child;
+
+      /* Get the *child* allocation, so we don't overwrite window borders */
+      child = gtk_bin_get_child (GTK_BIN (widget));
+      gtk_widget_get_allocation (child, &child_allocation);
 
       context = gtk_widget_get_style_context (widget);
-      width = gtk_widget_get_allocated_width (widget);
-      height = gtk_widget_get_allocated_height (widget);
-      gtk_render_background (context, cr, 0, 0, width, height);
-      gtk_render_frame (context, cr, 0, 0, width, height);
+      gtk_render_background (context, cr,
+                             child_allocation.x, child_allocation.y,
+                             child_allocation.width, child_allocation.height);
+      gtk_render_frame (context, cr,
+                        child_allocation.x, child_allocation.y,
+                        child_allocation.width, child_allocation.height);
     }
 
   return GTK_WIDGET_CLASS (terminal_window_parent_class)->draw (widget, cr);
-- 
2.40.0


From 53a8459fa2a4f9ebf76cbc8b93d919d84a8d1962 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Fri, 18 May 2018 20:15:34 +0200
Subject: [PATCH 04/16] screen: Try harder to find a foreground process group
 member

For pipelined commands, it's possible that the process group leader,
whose PID is used as the group ID, has terminated but not the entire
group. eg., $ cat <file> | less.  Sadly, there's no nice user-space
API to list the members of a group, and crawling the entire /proc like
pgrep might be overkill if the system is overloaded.

Therefore, the next 20 PIDs after the group ID and the first 20 PIDs
starting from 2 are checked in the hope that one of them would belong
to the foreground process group.

Subsequent commits will use this to track the current foreground
process, instead of using the shell's history, to notify when a
long-running foreground process group terminates.

https://bugzilla.gnome.org/show_bug.cgi?id=711059
---
 src/terminal-screen.cc | 30 +++++++++++++++++++++++++++++-
 1 file changed, 29 insertions(+), 1 deletion(-)

diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 51fdc20b..82c607a2 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -2346,7 +2346,35 @@ terminal_screen_has_foreground_process (TerminalScreen *screen,
 #else
   g_snprintf (filename, sizeof (filename), "/proc/%d/cmdline", fgpid);
   if (!g_file_get_contents (filename, &data_buf, &len, nullptr))
-    return TRUE;
+    {
+      int j;
+
+      for (j = 0; j < 20; j++)
+        {
+          pid_t pgid;
+          pid_t pid;
+
+          pid = (pid_t) (fgpid + 1 + j);
+          pgid = getpgid (pid);
+          if (pgid != fgpid)
+            {
+              pid = (pid_t) (2 + j);
+              pgid = getpgid (pid);
+              if (pgid != fgpid)
+                continue;
+            }
+
+          g_snprintf (filename, sizeof (filename), "/proc/%d/cmdline", (int) pid);
+
+          g_clear_pointer (&data_buf, g_free);
+          if (g_file_get_contents (filename, &data_buf, &len, nullptr))
+            break;
+        }
+
+      if (j == 20)
+        return TRUE;
+    }
+
   data = data_buf;
 #endif
 
-- 
2.40.0


From 042556027e4f58e3ca532a0413a992154cf67f17 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Thu, 3 May 2018 16:49:28 +0200
Subject: [PATCH 05/16] screen: Track the current foreground process

... using the interactive shell's precmd and preexec hooks, by
monitoring the contents of the terminal, and a combination of
tcgetpgrp(3) and /proc, instead of relying on the shell's history.

The shell's history cannot be reliably used to find out the current
foreground process. The history can be optionally turned off, and when
job control is in play, it will mistakenly record 'fg' as the current
process.

https://bugzilla.gnome.org/show_bug.cgi?id=711059
---
 src/terminal-debug.cc  |   1 +
 src/terminal-debug.hh  |   1 +
 src/terminal-screen.cc | 150 +++++++++++++++++++++++++++++++++++++++++
 3 files changed, 152 insertions(+)

diff --git a/src/terminal-debug.cc b/src/terminal-debug.cc
index bf2db7e9..e2645335 100644
--- a/src/terminal-debug.cc
+++ b/src/terminal-debug.cc
@@ -40,6 +40,7 @@ _terminal_debug_init(void)
     { "search",        TERMINAL_DEBUG_SEARCH        },
     { "bridge",        TERMINAL_DEBUG_BRIDGE        },
     { "default",       TERMINAL_DEBUG_DEFAULT       },
+    { "shell-command", TERMINAL_DEBUG_SHELL_COMMAND },
   };
 
   _terminal_debug_flags = TerminalDebugFlags(g_parse_debug_string (g_getenv ("GNOME_TERMINAL_DEBUG"),
diff --git a/src/terminal-debug.hh b/src/terminal-debug.hh
index fedc9e4d..94f0e30b 100644
--- a/src/terminal-debug.hh
+++ b/src/terminal-debug.hh
@@ -37,6 +37,7 @@ typedef enum {
   TERMINAL_DEBUG_SEARCH        = 1 << 9,
   TERMINAL_DEBUG_BRIDGE        = 1 << 10,
   TERMINAL_DEBUG_DEFAULT       = 1 << 11,
+  TERMINAL_DEBUG_SHELL_COMMAND = 1 << 12,
 } TerminalDebugFlags;
 
 void _terminal_debug_init(void);
diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 82c607a2..5de5ce91 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -112,6 +112,11 @@ struct _TerminalScreenPrivate
   gboolean exec_on_realize;
   guint idle_exec_source;
   ExecData *exec_data;
+
+  gboolean between_preexec_and_precmd;
+  char *current_cmdline;
+  guint contents_changed_source_id;
+  guint shell_preexec_source_id;
 };
 
 enum
@@ -161,6 +166,12 @@ static void terminal_screen_hierarchy_changed (GtkWidget *widget,
 static void terminal_screen_child_exited  (VteTerminal *terminal,
                                            int status);
 
+static void terminal_screen_contents_changed (VteTerminal *terminal);
+
+static void terminal_screen_shell_precmd (VteTerminal *terminal);
+
+static void terminal_screen_shell_preexec (VteTerminal *terminal);
+
 static void terminal_screen_window_title_changed      (VteTerminal *vte_terminal,
                                                        TerminalScreen *screen);
 
@@ -604,6 +615,9 @@ terminal_screen_class_init (TerminalScreenClass *klass)
   widget_class->hierarchy_changed = terminal_screen_hierarchy_changed;
 
   terminal_class->child_exited = terminal_screen_child_exited;
+  terminal_class->contents_changed = terminal_screen_contents_changed;
+  terminal_class->shell_precmd = terminal_screen_shell_precmd;
+  terminal_class->shell_preexec = terminal_screen_shell_preexec;
 
   signals[PROFILE_SET] =
     g_signal_new (I_("profile-set"),
@@ -709,6 +723,18 @@ terminal_screen_dispose (GObject *object)
                                         0, 0, nullptr, nullptr,
                                         screen);
 
+  if (priv->contents_changed_source_id != 0)
+    {
+      g_source_remove (priv->contents_changed_source_id);
+      priv->contents_changed_source_id = 0;
+    }
+
+  if (priv->shell_preexec_source_id != 0)
+    {
+      g_source_remove (priv->shell_preexec_source_id);
+      priv->shell_preexec_source_id = 0;
+    }
+
   if (priv->idle_exec_source != 0)
     {
       g_source_remove (priv->idle_exec_source);
@@ -745,6 +771,7 @@ terminal_screen_finalize (GObject *object)
   g_slist_free_full (priv->match_tags, (GDestroyNotify) free_tag_data);
 
   g_free (priv->uuid);
+  g_free (priv->current_cmdline);
 
   G_OBJECT_CLASS (terminal_screen_parent_class)->finalize (object);
 }
@@ -1969,6 +1996,125 @@ terminal_screen_child_exited (VteTerminal *terminal,
     }
 }
 
+static gboolean
+terminal_screen_contents_changed_cb (TerminalScreen *screen)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+  gs_free char *cmdline = nullptr;
+
+  g_return_val_if_fail (priv->between_preexec_and_precmd, G_SOURCE_REMOVE);
+  g_return_val_if_fail (priv->shell_preexec_source_id == 0, G_SOURCE_REMOVE);
+
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Contents changed [timeout]\n");
+
+  if (!terminal_screen_has_foreground_process (screen, nullptr, &cmdline))
+    goto out;
+
+  if (g_strcmp0 (priv->current_cmdline, cmdline) == 0)
+    goto out;
+
+  g_free (priv->current_cmdline);
+  priv->current_cmdline = cmdline;
+  cmdline = nullptr;
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Current foreground command-line: %s\n", priv->current_cmdline);
+
+ out:
+  priv->contents_changed_source_id = 0;
+  return G_SOURCE_REMOVE;
+}
+
+static void
+terminal_screen_contents_changed (VteTerminal *terminal)
+{
+  TerminalScreen *screen = TERMINAL_SCREEN (terminal);
+  TerminalScreenPrivate *priv = screen->priv;
+
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Contents changed\n");
+
+  if (!priv->between_preexec_and_precmd)
+    return;
+
+  if (priv->shell_preexec_source_id != 0)
+    return;
+
+  if (priv->contents_changed_source_id != 0)
+    return;
+
+  priv->contents_changed_source_id = g_timeout_add (500,
+                                                    (GSourceFunc) terminal_screen_contents_changed_cb,
+                                                    screen);
+}
+
+static void
+terminal_screen_shell_precmd (VteTerminal *terminal)
+{
+  TerminalScreen *screen = TERMINAL_SCREEN (terminal);
+  TerminalScreenPrivate *priv = screen->priv;
+
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Shell precmd\n");
+
+  priv->between_preexec_and_precmd = FALSE;
+
+  if (priv->contents_changed_source_id != 0)
+    {
+      g_source_remove (priv->contents_changed_source_id);
+      priv->contents_changed_source_id = 0;
+    }
+
+  if (priv->shell_preexec_source_id != 0)
+    {
+      g_source_remove (priv->shell_preexec_source_id);
+      priv->shell_preexec_source_id = 0;
+    }
+
+  g_clear_pointer (&priv->current_cmdline, g_free);
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Current foreground command-line: (none)\n");
+}
+
+static gboolean
+terminal_screen_shell_preexec_cb (TerminalScreen *screen)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+  gboolean retval = G_SOURCE_CONTINUE;
+  gs_free char *cmdline = nullptr;
+
+  g_return_val_if_fail (priv->between_preexec_and_precmd, G_SOURCE_REMOVE);
+  g_return_val_if_fail (priv->current_cmdline == nullptr, G_SOURCE_REMOVE);
+
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Shell preexec [timeout]\n");
+
+  if (!terminal_screen_has_foreground_process (screen, nullptr, &cmdline))
+    goto out;
+
+  priv->current_cmdline = cmdline;
+  cmdline = nullptr;
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Current foreground command-line: %s\n", priv->current_cmdline);
+
+  priv->shell_preexec_source_id = 0;
+  retval = G_SOURCE_REMOVE;
+
+ out:
+  return retval;
+}
+
+static void
+terminal_screen_shell_preexec (VteTerminal *terminal)
+{
+  TerminalScreen *screen = TERMINAL_SCREEN (terminal);
+  TerminalScreenPrivate *priv = screen->priv;
+
+  g_return_if_fail (!priv->between_preexec_and_precmd);
+  g_return_if_fail (priv->contents_changed_source_id == 0);
+  g_return_if_fail (priv->current_cmdline == nullptr);
+  g_return_if_fail (priv->shell_preexec_source_id == 0);
+
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Shell preexec\n");
+
+  priv->between_preexec_and_precmd = TRUE;
+
+  priv->shell_preexec_source_id = g_timeout_add (200, (GSourceFunc) terminal_screen_shell_preexec_cb, screen);
+}
+
 static void
 terminal_screen_drag_data_received (GtkWidget        *widget,
                                     GdkDragContext   *context,
@@ -2315,7 +2461,11 @@ terminal_screen_has_foreground_process (TerminalScreen *screen,
   if (fd == -1)
     return FALSE;
 
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Child PID: %d\n", priv->child_pid);
+
   fgpid = tcgetpgrp (fd);
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Current foreground process group [tcgetpgrp]: %d\n", fgpid);
+
   if (fgpid == -1 || fgpid == priv->child_pid)
     return FALSE;
 
-- 
2.40.0


From 92643324bc2dabeccccad621f6b294b6e928f717 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Thu, 10 May 2018 19:23:16 +0200
Subject: [PATCH 06/16] Notify when a long-running foreground process group
 terminates

Notifications are only sent if the VteTerminal in which the process
was running doesn't have the keyboard focus. If it's a tab in the
currently active window then the dialog-information-symbolic icon is
used to highlight the tab's label; otherwise a desktop-wide
notification is sent.

https://bugzilla.gnome.org/show_bug.cgi?id=711059
---
 src/terminal-app.cc       |  32 +++++++++++
 src/terminal-screen.cc    | 109 ++++++++++++++++++++++++++++++++++++++
 src/terminal-tab-label.cc |  30 ++++++++++-
 src/terminal-tab-label.hh |   4 ++
 4 files changed, 174 insertions(+), 1 deletion(-)

diff --git a/src/terminal-app.cc b/src/terminal-app.cc
index b6740e3c..f8ea76fe 100644
--- a/src/terminal-app.cc
+++ b/src/terminal-app.cc
@@ -850,6 +850,31 @@ app_menu_quit_cb (GSimpleAction *action,
     gtk_widget_destroy (GTK_WIDGET (window));
 }
 
+/* Other action callbacks */
+
+static void
+action_activate_tab_cb (GSimpleAction *action,
+                        GVariant      *parameter,
+                        gpointer       user_data)
+{
+  GtkApplication *application = (GtkApplication*)user_data;
+  GtkWidget *toplevel;
+  TerminalScreen *screen;
+  const char *uuid;
+
+  g_variant_get (parameter, "&s", &uuid);
+  screen = terminal_app_get_screen_by_uuid (TERMINAL_APP (application), uuid);
+  if (screen == nullptr)
+    return;
+
+  toplevel = gtk_widget_get_toplevel (GTK_WIDGET (screen));
+  if (!gtk_widget_is_toplevel (toplevel))
+    return;
+
+  terminal_window_switch_screen (TERMINAL_WINDOW (toplevel), screen);
+  gtk_window_present (GTK_WINDOW (toplevel));
+}
+
 #endif /* TERMINAL_SERVER */
 
 /* Class implementation */
@@ -892,9 +917,16 @@ terminal_app_startup (GApplication *application)
     { "quit",        app_menu_quit_cb,          nullptr, nullptr, nullptr }
   };
 
+  GActionEntry const other_actions[] = {
+    { "activate-tab", action_activate_tab_cb, "s", nullptr, nullptr }
+  };
+
   g_action_map_add_action_entries (G_ACTION_MAP (application),
                                    action_entries, G_N_ELEMENTS (action_entries),
                                    application);
+  g_action_map_add_action_entries (G_ACTION_MAP (application),
+                                   other_actions, G_N_ELEMENTS (other_actions),
+                                   application);
 
   /* Figure out whether the shell shows the menubar */
   gboolean shell_shows_menubar;
diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 5de5ce91..4d610170 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -55,6 +55,7 @@
 #include "terminal-marshal.h"
 #include "terminal-schemas.hh"
 #include "terminal-screen-container.hh"
+#include "terminal-tab-label.hh"
 #include "terminal-util.hh"
 #include "terminal-window.hh"
 #include "terminal-info-bar.hh"
@@ -161,6 +162,10 @@ static void terminal_screen_system_font_changed_cb (GSettings *,
 static gboolean terminal_screen_popup_menu (GtkWidget *widget);
 static gboolean terminal_screen_button_press (GtkWidget *widget,
                                               GdkEventButton *event);
+
+static gboolean terminal_screen_focus_in (GtkWidget *widget,
+                                          GdkEventFocus *event);
+
 static void terminal_screen_hierarchy_changed (GtkWidget *widget,
                                                GtkWidget *previous_toplevel);
 static void terminal_screen_child_exited  (VteTerminal *terminal,
@@ -607,6 +612,7 @@ terminal_screen_class_init (TerminalScreenClass *klass)
   object_class->get_property = terminal_screen_get_property;
   object_class->set_property = terminal_screen_set_property;
 
+  widget_class->focus_in_event = terminal_screen_focus_in;
   widget_class->realize = terminal_screen_realize;
   widget_class->style_updated = terminal_screen_style_updated;
   widget_class->drag_data_received = terminal_screen_drag_data_received;
@@ -712,6 +718,10 @@ terminal_screen_dispose (GObject *object)
   TerminalScreen *screen = TERMINAL_SCREEN (object);
   TerminalScreenPrivate *priv = screen->priv;
   GtkSettings *settings;
+  TerminalApp *app;
+
+  app = terminal_app_get ();
+  g_application_withdraw_notification (G_APPLICATION (app), priv->uuid);
 
   /* Unset child PID so that when an eventual child-exited signal arrives,
    * we don't emit "close".
@@ -1900,6 +1910,45 @@ terminal_screen_button_press (GtkWidget      *widget,
   return FALSE;
 }
 
+static gboolean
+terminal_screen_focus_in (GtkWidget     *widget,
+                          GdkEventFocus *event)
+{
+  TerminalScreen *screen = TERMINAL_SCREEN (widget);
+  TerminalApp *app;
+  TerminalWindow *window;
+
+  _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Notification withdrawn\n");
+
+  window = terminal_screen_get_window (screen);
+  if (window != nullptr)
+    {
+      TerminalScreenContainer *screen_container;
+
+      screen_container = terminal_screen_container_get_from_screen (screen);
+      if (screen_container != nullptr)
+        {
+          GtkWidget *mdi_container;
+
+          mdi_container = terminal_window_get_mdi_container (window);
+          /* FIXME: add interface method to retrieve tab label */
+          if (GTK_IS_NOTEBOOK (mdi_container))
+            {
+              GtkWidget *tab_label;
+
+              tab_label = gtk_notebook_get_tab_label (GTK_NOTEBOOK (mdi_container), GTK_WIDGET (screen_container));
+              terminal_tab_label_set_bold (TERMINAL_TAB_LABEL (tab_label), FALSE);
+              terminal_tab_label_set_icon (TERMINAL_TAB_LABEL (tab_label), nullptr, nullptr);
+            }
+        }
+    }
+
+  app = terminal_app_get ();
+  g_application_withdraw_notification (G_APPLICATION (app), screen->priv->uuid);
+
+  return GTK_WIDGET_CLASS (terminal_screen_parent_class)->focus_in_event (widget, event);
+}
+
 /**
  * terminal_screen_get_current_dir:
  * @screen:
@@ -2045,6 +2094,63 @@ terminal_screen_contents_changed (VteTerminal *terminal)
                                                     screen);
 }
 
+static void
+terminal_screen_show_notification (TerminalScreen *screen)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+  TerminalWindow *window;
+
+  window = terminal_screen_get_window (screen);
+  if (window == nullptr)
+    return;
+
+  if (gtk_window_is_active (GTK_WINDOW (window)))
+    {
+      GtkWidget *mdi_container;
+      TerminalScreenContainer *screen_container;
+
+      if (screen == terminal_window_get_active (window))
+        return;
+
+      screen_container = terminal_screen_container_get_from_screen (screen);
+      if (screen_container == nullptr)
+        return;
+
+      mdi_container = terminal_window_get_mdi_container (window);
+      /* FIXME: add interface method to retrieve tab label */
+      if (GTK_IS_NOTEBOOK (mdi_container))
+        {
+          GtkWidget *tab_label;
+
+          tab_label = gtk_notebook_get_tab_label (GTK_NOTEBOOK (mdi_container), GTK_WIDGET (screen_container));
+          terminal_tab_label_set_bold (TERMINAL_TAB_LABEL (tab_label), TRUE);
+          terminal_tab_label_set_icon (TERMINAL_TAB_LABEL (tab_label),
+                                       "dialog-information-symbolic",
+                                       _("Command completed"));
+          _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Notify tab\n");
+        }
+    }
+  else
+    {
+      gs_unref_object GNotification *notification = nullptr;
+      TerminalApp *app;
+      gs_free char *current_cmdline_valid = nullptr;
+      gs_free char *detailed_action = nullptr;
+
+      notification = g_notification_new (_("Command completed"));
+
+      current_cmdline_valid = g_utf8_make_valid (priv->current_cmdline, -1);
+      g_notification_set_body (notification, current_cmdline_valid);
+
+      detailed_action = g_strdup_printf ("app.activate-tab::%s", priv->uuid);
+      g_notification_set_default_action (notification, detailed_action);
+
+      app = terminal_app_get ();
+      g_application_send_notification (G_APPLICATION (app), priv->uuid, notification);
+      _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Notify desktop\n");
+    }
+}
+
 static void
 terminal_screen_shell_precmd (VteTerminal *terminal)
 {
@@ -2067,6 +2173,9 @@ terminal_screen_shell_precmd (VteTerminal *terminal)
       priv->shell_preexec_source_id = 0;
     }
 
+  if (priv->current_cmdline != nullptr)
+    terminal_screen_show_notification (screen);
+
   g_clear_pointer (&priv->current_cmdline, g_free);
   _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Current foreground command-line: (none)\n");
 }
diff --git a/src/terminal-tab-label.cc b/src/terminal-tab-label.cc
index 88af5d41..d6423f11 100644
--- a/src/terminal-tab-label.cc
+++ b/src/terminal-tab-label.cc
@@ -34,6 +34,7 @@
 struct _TerminalTabLabelPrivate
 {
   TerminalScreen *screen;
+  GtkWidget *icon;
   GtkWidget *label;
   GtkWidget *close_button;
   gboolean bold;
@@ -179,7 +180,7 @@ terminal_tab_label_constructed (GObject *object)
 {
   TerminalTabLabel *tab_label = TERMINAL_TAB_LABEL (object);
   TerminalTabLabelPrivate *priv = tab_label->priv;
-  GtkWidget *hbox, *label, *close_button;
+  GtkWidget *hbox, *icon, *label, *close_button;
 
   G_OBJECT_CLASS (terminal_tab_label_parent_class)->constructed (object);
 
@@ -189,6 +190,10 @@ terminal_tab_label_constructed (GObject *object)
   
   gtk_box_set_spacing (GTK_BOX (hbox), SPACING);
 
+  priv->icon = icon = gtk_image_new ();
+  gtk_widget_set_no_show_all (icon, TRUE);
+  gtk_box_pack_start (GTK_BOX (hbox), icon, FALSE, FALSE, 0);
+
   priv->label = label = gtk_label_new (nullptr);
   gtk_widget_set_halign (label, GTK_ALIGN_CENTER);
   gtk_widget_set_valign (label, GTK_ALIGN_BASELINE);
@@ -380,6 +385,29 @@ terminal_tab_label_set_bold (TerminalTabLabel *tab_label,
     pango_attr_list_unref (attr_list);
 }
 
+/**
+ * terminal_tab_label_set_icon:
+ * @tab_label: a #TerminalTabLabel
+ * @icon_name: (allow-none): an icon name
+ * @tooltip: (allow-none): text to be used as tooltip
+ *
+ * Shows an icon at the beginning of @tab_label. If @icon_name is
+ * %nullptr, then the icon will be hidden.
+ */
+void
+terminal_tab_label_set_icon (TerminalTabLabel *tab_label,
+                             const char *icon_name,
+                             const char *tooltip)
+{
+  TerminalTabLabelPrivate *priv = tab_label->priv;
+
+  g_return_if_fail (TERMINAL_IS_TAB_LABEL (tab_label));
+
+  gtk_widget_set_visible (priv->icon, icon_name != nullptr);
+  gtk_image_set_from_icon_name (GTK_IMAGE (priv->icon), icon_name, GTK_ICON_SIZE_MENU);
+  gtk_widget_set_tooltip_text (GTK_WIDGET (priv->icon), tooltip);
+}
+
 /**
  * terminal_tab_label_get_screen:
  * @tab_label: a #TerminalTabLabel
diff --git a/src/terminal-tab-label.hh b/src/terminal-tab-label.hh
index 91b7e617..37e808a7 100644
--- a/src/terminal-tab-label.hh
+++ b/src/terminal-tab-label.hh
@@ -59,6 +59,10 @@ GtkWidget *     terminal_tab_label_new        (TerminalScreen *screen);
 void            terminal_tab_label_set_bold   (TerminalTabLabel *tab_label,
                                                gboolean bold);
 
+void            terminal_tab_label_set_icon   (TerminalTabLabel *tab_label,
+                                               const char *icon_name,
+                                               const char *tooltip);
+
 TerminalScreen *terminal_tab_label_get_screen (TerminalTabLabel *tab_label);
 
 G_END_DECLS
-- 
2.40.0


From 523dcde65b666c2396213f3efa7ef3373b81ed6f Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Tue, 10 Apr 2018 15:39:35 +0200
Subject: [PATCH 07/16] profile: Split the Command tab into two nested GtkGrids

This will let the subsequent patch add a "Command" sub-heading to keep
the command settings separate from the to-be-restored title settings.

https://bugzilla.redhat.com/show_bug.cgi?id=1296110
---
 src/preferences.ui | 239 +++++++++++++++++++++++----------------------
 1 file changed, 123 insertions(+), 116 deletions(-)

diff --git a/src/preferences.ui b/src/preferences.ui
index f3979307..285a3c61 100644
--- a/src/preferences.ui
+++ b/src/preferences.ui
@@ -1998,130 +1998,137 @@
                             <property name="visible">True</property>
                             <property name="can_focus">False</property>
                             <property name="border_width">12</property>
-                            <property name="column_spacing">12</property>
-                            <property name="row_spacing">6</property>
-                            <child>
-                              <object class="GtkCheckButton" id="login-shell-checkbutton">
-                                <property name="label" translatable="yes">_Run command as a login shell</property>
-                                <property name="visible">True</property>
-                                <property name="can_focus">True</property>
-                                <property name="receives_default">False</property>
-                                <property name="use_underline">True</property>
-                                <property name="draw_indicator">True</property>
-                              </object>
-                              <packing>
-                                <property name="top_attach">0</property>
-                                <property name="left_attach">0</property>
-                                <property name="width">2</property>
-                              </packing>
-                            </child>
-                            <child>
-                              <object class="GtkCheckButton" id="use-custom-command-checkbutton">
-                                <property name="label" translatable="yes">Ru_n a custom command instead of my shell</property>
-                                <property name="visible">True</property>
-                                <property name="can_focus">True</property>
-                                <property name="receives_default">False</property>
-                                <property name="use_underline">True</property>
-                                <property name="draw_indicator">True</property>
-                              </object>
-                              <packing>
-                                <property name="top_attach">1</property>
-                                <property name="left_attach">0</property>
-                                <property name="width">2</property>
-                              </packing>
-                            </child>
-                            <child>
-                              <object class="GtkLabel" id="custom-command-entry-label">
-                                <property name="visible">True</property>
-                                <property name="can_focus">False</property>
-                                <property name="label" translatable="yes">Custom co_mmand:</property>
-                                <property name="use_underline">True</property>
-                                <property name="mnemonic_widget">custom-command-entry</property>
-                                <property name="xalign">0</property>
-                              </object>
-                              <packing>
-                                <property name="top_attach">2</property>
-                                <property name="left_attach">0</property>
-                              </packing>
-                            </child>
-                            <child>
-                              <object class="GtkEntry" id="custom-command-entry">
-                                <property name="visible">True</property>
-                                <property name="can_focus">True</property>
-                                <property name="hexpand">True</property>
-                                <property name="input_hints">GTK_INPUT_HINT_NO_EMOJI</property>
-                              </object>
-                              <packing>
-                                <property name="top_attach">2</property>
-                                <property name="left_attach">1</property>
-                              </packing>
-                            </child>
+                            <property name="row_spacing">18</property>
                             <child>
-                              <object class="GtkLabel" id="preserve-working-directory-checkbutton-label">
+                              <object class="GtkGrid">
                                 <property name="visible">True</property>
                                 <property name="can_focus">False</property>
-                                <property name="label" translatable="yes">_Preserve working directory:</property>
-                                <property name="use_underline">True</property>
-                                <property name="justify">center</property>
-                                <property name="mnemonic_widget">preserve-working-directory-combobox</property>
-                                <property name="xalign">0</property>
-                              </object>
-                              <packing>
-                                <property name="top_attach">3</property>
-                                <property name="left_attach">0</property>
-                              </packing>
-                            </child>
-                            <child>
-                              <object class="GtkComboBox" id="preserve-working-directory-combobox">
-                                <property name="visible">True</property>
-                                <property name="can_focus">False</property>
-                                <property name="model">preserve-working-directory-model</property>
-                                <property name="focus_on_click">False</property>
-                                <property name="halign">start</property>
+                                <property name="column_spacing">12</property>
+                                <property name="row_spacing">6</property>
                                 <child>
-                                  <object class="GtkCellRendererText" id="preserve-working-directory-renderer"/>
-                                  <attributes>
-                                    <attribute name="text">0</attribute>
-                                  </attributes>
+                                  <object class="GtkCheckButton" id="login-shell-checkbutton">
+                                    <property name="label" translatable="yes">_Run command as a login shell</property>
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="receives_default">False</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="draw_indicator">True</property>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">0</property>
+                                    <property name="left_attach">0</property>
+                                    <property name="width">2</property>
+                                  </packing>
                                 </child>
-                              </object>
-                              <packing>
-                                <property name="top_attach">3</property>
-                                <property name="left_attach">1</property>
-                              </packing>
-                            </child>
-                            <child>
-                              <object class="GtkLabel" id="exit-action-combobox-label">
-                                <property name="visible">True</property>
-                                <property name="can_focus">False</property>
-                                <property name="label" translatable="yes">When command _exits:</property>
-                                <property name="use_underline">True</property>
-                                <property name="mnemonic_widget">exit-action-combobox</property>
-                                <property name="xalign">0</property>
-                              </object>
-                              <packing>
-                                <property name="top_attach">4</property>
-                                <property name="left_attach">0</property>
-                              </packing>
-                            </child>
-                            <child>
-                              <object class="GtkComboBox" id="exit-action-combobox">
-                                <property name="visible">True</property>
-                                <property name="can_focus">False</property>
-                                <property name="model">model3</property>
-                                <property name="focus_on_click">False</property>
-                                <property name="halign">start</property>
                                 <child>
-                                  <object class="GtkCellRendererText" id="renderer3"/>
-                                  <attributes>
-                                    <attribute name="text">0</attribute>
-                                  </attributes>
+                                  <object class="GtkCheckButton" id="use-custom-command-checkbutton">
+                                    <property name="label" translatable="yes">Ru_n a custom command instead of my shell</property>
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="receives_default">False</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="draw_indicator">True</property>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">1</property>
+                                    <property name="left_attach">0</property>
+                                    <property name="width">2</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkLabel" id="custom-command-entry-label">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="label" translatable="yes">Custom co_mmand:</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="mnemonic_widget">custom-command-entry</property>
+                                    <property name="xalign">0</property>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">2</property>
+                                    <property name="left_attach">0</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkEntry" id="custom-command-entry">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="hexpand">True</property>
+                                    <property name="input_hints">GTK_INPUT_HINT_NO_EMOJI</property>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">2</property>
+                                    <property name="left_attach">1</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkLabel" id="preserve-working-directory-checkbutton-label">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="label" translatable="yes">_Preserve working directory:</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="justify">center</property>
+                                    <property name="mnemonic_widget">preserve-working-directory-combobox</property>
+                                    <property name="xalign">0</property>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">3</property>
+                                    <property name="left_attach">0</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkComboBox" id="preserve-working-directory-combobox">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="model">preserve-working-directory-model</property>
+                                    <property name="focus_on_click">False</property>
+                                    <property name="halign">start</property>
+                                    <child>
+                                      <object class="GtkCellRendererText" id="preserve-working-directory-renderer"/>
+                                      <attributes>
+                                        <attribute name="text">0</attribute>
+                                      </attributes>
+                                    </child>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">3</property>
+                                    <property name="left_attach">1</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkLabel" id="exit-action-combobox-label">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="label" translatable="yes">When command _exits:</property>
+                                    <property name="use_underline">True</property>
+                                    <property name="mnemonic_widget">exit-action-combobox</property>
+                                    <property name="xalign">0</property>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">4</property>
+                                    <property name="left_attach">0</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkComboBox" id="exit-action-combobox">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="model">model3</property>
+                                    <property name="focus_on_click">False</property>
+                                    <property name="halign">start</property>
+                                    <child>
+                                      <object class="GtkCellRendererText" id="renderer3"/>
+                                      <attributes>
+                                        <attribute name="text">0</attribute>
+                                      </attributes>
+                                    </child>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">4</property>
+                                    <property name="left_attach">1</property>
+                                  </packing>
                                 </child>
                               </object>
-                              <packing>
-                                <property name="top_attach">4</property>
-                                <property name="left_attach">1</property>
-                              </packing>
                             </child>
                           </object>
                           <packing>
-- 
2.40.0


From 3c4e18214f919a352c11b9737101cbe270ac6f75 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Tue, 10 Apr 2018 16:01:51 +0200
Subject: [PATCH 08/16] Revert "profile: Remove the "Command" sub-heading"

This reverts commit 8e27479299d075df0a52d0e8e7baeab344dcaa6c.

https://bugzilla.redhat.com/show_bug.cgi?id=1296110
---
 src/preferences.ui | 247 ++++++++++++++++++++++++++-------------------
 1 file changed, 143 insertions(+), 104 deletions(-)

diff --git a/src/preferences.ui b/src/preferences.ui
index 285a3c61..5422de71 100644
--- a/src/preferences.ui
+++ b/src/preferences.ui
@@ -2006,129 +2006,168 @@
                                 <property name="column_spacing">12</property>
                                 <property name="row_spacing">6</property>
                                 <child>
-                                  <object class="GtkCheckButton" id="login-shell-checkbutton">
-                                    <property name="label" translatable="yes">_Run command as a login shell</property>
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">True</property>
-                                    <property name="receives_default">False</property>
-                                    <property name="use_underline">True</property>
-                                    <property name="draw_indicator">True</property>
-                                  </object>
-                                  <packing>
-                                    <property name="top_attach">0</property>
-                                    <property name="left_attach">0</property>
-                                    <property name="width">2</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <object class="GtkCheckButton" id="use-custom-command-checkbutton">
-                                    <property name="label" translatable="yes">Ru_n a custom command instead of my shell</property>
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">True</property>
-                                    <property name="receives_default">False</property>
-                                    <property name="use_underline">True</property>
-                                    <property name="draw_indicator">True</property>
-                                  </object>
-                                  <packing>
-                                    <property name="top_attach">1</property>
-                                    <property name="left_attach">0</property>
-                                    <property name="width">2</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <object class="GtkLabel" id="custom-command-entry-label">
+                                  <object class="GtkLabel">
                                     <property name="visible">True</property>
                                     <property name="can_focus">False</property>
-                                    <property name="label" translatable="yes">Custom co_mmand:</property>
-                                    <property name="use_underline">True</property>
-                                    <property name="mnemonic_widget">custom-command-entry</property>
-                                    <property name="xalign">0</property>
-                                  </object>
-                                  <packing>
-                                    <property name="top_attach">2</property>
-                                    <property name="left_attach">0</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <object class="GtkEntry" id="custom-command-entry">
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">True</property>
-                                    <property name="hexpand">True</property>
-                                    <property name="input_hints">GTK_INPUT_HINT_NO_EMOJI</property>
-                                  </object>
-                                  <packing>
-                                    <property name="top_attach">2</property>
-                                    <property name="left_attach">1</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <object class="GtkLabel" id="preserve-working-directory-checkbutton-label">
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">False</property>
-                                    <property name="label" translatable="yes">_Preserve working directory:</property>
-                                    <property name="use_underline">True</property>
-                                    <property name="justify">center</property>
-                                    <property name="mnemonic_widget">preserve-working-directory-combobox</property>
                                     <property name="xalign">0</property>
+                                    <property name="label" translatable="yes">Command</property>
+                                    <attributes>
+                                      <attribute name="weight" value="bold"/>
+                                    </attributes>
                                   </object>
                                   <packing>
-                                    <property name="top_attach">3</property>
+                                    <property name="top_attach">0</property>
                                     <property name="left_attach">0</property>
                                   </packing>
                                 </child>
                                 <child>
-                                  <object class="GtkComboBox" id="preserve-working-directory-combobox">
+                                  <object class="GtkAlignment">
                                     <property name="visible">True</property>
                                     <property name="can_focus">False</property>
-                                    <property name="model">preserve-working-directory-model</property>
-                                    <property name="focus_on_click">False</property>
-                                    <property name="halign">start</property>
+                                    <property name="left_padding">12</property>
                                     <child>
-                                      <object class="GtkCellRendererText" id="preserve-working-directory-renderer"/>
-                                      <attributes>
-                                        <attribute name="text">0</attribute>
-                                      </attributes>
+                                      <object class="GtkGrid">
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">False</property>
+                                        <property name="column_spacing">12</property>
+                                        <property name="row_spacing">6</property>
+                                        <child>
+                                          <object class="GtkCheckButton" id="login-shell-checkbutton">
+                                            <property name="label" translatable="yes">_Run command as a login shell</property>
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">True</property>
+                                            <property name="receives_default">False</property>
+                                            <property name="use_underline">True</property>
+                                            <property name="draw_indicator">True</property>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">0</property>
+                                            <property name="left_attach">0</property>
+                                            <property name="width">2</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <object class="GtkCheckButton" id="use-custom-command-checkbutton">
+                                            <property name="label" translatable="yes">Ru_n a custom command instead of my shell</property>
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">True</property>
+                                            <property name="receives_default">False</property>
+                                            <property name="use_underline">True</property>
+                                            <property name="draw_indicator">True</property>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">1</property>
+                                            <property name="left_attach">0</property>
+                                            <property name="width">2</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <object class="GtkLabel" id="custom-command-entry-label">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="label" translatable="yes">Custom co_mmand:</property>
+                                            <property name="use_underline">True</property>
+                                            <property name="mnemonic_widget">custom-command-entry</property>
+                                            <property name="xalign">0</property>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">2</property>
+                                            <property name="left_attach">0</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <object class="GtkEntry" id="custom-command-entry">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">True</property>
+                                            <property name="hexpand">True</property>
+                                            <property name="input_hints">GTK_INPUT_HINT_NO_EMOJI</property>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">2</property>
+                                            <property name="left_attach">1</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <object class="GtkLabel" id="preserve-working-directory-checkbutton-label">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="label" translatable="yes">_Preserve working directory:</property>
+                                            <property name="use_underline">True</property>
+                                            <property name="justify">center</property>
+                                            <property name="mnemonic_widget">preserve-working-directory-combobox</property>
+                                            <property name="xalign">0</property>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">3</property>
+                                            <property name="left_attach">0</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <object class="GtkComboBox" id="preserve-working-directory-combobox">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="model">preserve-working-directory-model</property>
+                                            <property name="focus_on_click">False</property>
+                                            <property name="halign">start</property>
+                                            <child>
+                                              <object class="GtkCellRendererText" id="preserve-working-directory-renderer"/>
+                                              <attributes>
+                                                <attribute name="text">0</attribute>
+                                              </attributes>
+                                            </child>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">3</property>
+                                            <property name="left_attach">1</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <object class="GtkLabel" id="exit-action-combobox-label">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="label" translatable="yes">When command _exits:</property>
+                                            <property name="use_underline">True</property>
+                                            <property name="mnemonic_widget">exit-action-combobox</property>
+                                            <property name="xalign">0</property>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">4</property>
+                                            <property name="left_attach">0</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <object class="GtkComboBox" id="exit-action-combobox">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="model">model3</property>
+                                            <property name="focus_on_click">False</property>
+                                            <property name="halign">start</property>
+                                            <child>
+                                              <object class="GtkCellRendererText" id="renderer3"/>
+                                              <attributes>
+                                                <attribute name="text">0</attribute>
+                                              </attributes>
+                                            </child>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">4</property>
+                                            <property name="left_attach">1</property>
+                                          </packing>
+                                        </child>
+                                      </object>
                                     </child>
                                   </object>
                                   <packing>
-                                    <property name="top_attach">3</property>
-                                    <property name="left_attach">1</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <object class="GtkLabel" id="exit-action-combobox-label">
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">False</property>
-                                    <property name="label" translatable="yes">When command _exits:</property>
-                                    <property name="use_underline">True</property>
-                                    <property name="mnemonic_widget">exit-action-combobox</property>
-                                    <property name="xalign">0</property>
-                                  </object>
-                                  <packing>
-                                    <property name="top_attach">4</property>
+                                    <property name="top_attach">1</property>
                                     <property name="left_attach">0</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <object class="GtkComboBox" id="exit-action-combobox">
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">False</property>
-                                    <property name="model">model3</property>
-                                    <property name="focus_on_click">False</property>
-                                    <property name="halign">start</property>
-                                    <child>
-                                      <object class="GtkCellRendererText" id="renderer3"/>
-                                      <attributes>
-                                        <attribute name="text">0</attribute>
-                                      </attributes>
-                                    </child>
-                                  </object>
-                                  <packing>
-                                    <property name="top_attach">4</property>
-                                    <property name="left_attach">1</property>
+                                    <property name="width">3</property>
                                   </packing>
                                 </child>
                               </object>
+                              <packing>
+                                <property name="top_attach">1</property>
+                                <property name="left_attach">0</property>
+                              </packing>
                             </child>
                           </object>
                           <packing>
-- 
2.40.0


From 5141342c1f31f1a7a677b3befebab65a7310816c Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Thu, 30 Jun 2016 16:02:13 +0200
Subject: [PATCH 09/16] Revert "screen: Remove unused description and
 user_title API"

This reverts commit 3bb41272b7509a16ec2a5cd93e44f73d5743b626.

https://bugzilla.redhat.com/show_bug.cgi?id=1296110
---
 src/terminal-screen.cc | 64 ++++++++++++++++++++++++++++++++++++++++++
 src/terminal-screen.hh |  5 ++++
 2 files changed, 69 insertions(+)

diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 4d610170..8b37de55 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -116,6 +116,7 @@ struct _TerminalScreenPrivate
 
   gboolean between_preexec_and_precmd;
   char *current_cmdline;
+  char *title;
   guint contents_changed_source_id;
   guint shell_preexec_source_id;
 };
@@ -133,6 +134,7 @@ enum {
   PROP_0,
   PROP_PROFILE,
   PROP_TITLE,
+  PROP_DESCRIPTION
 };
 
 enum
@@ -571,6 +573,9 @@ terminal_screen_get_property (GObject *object,
       case PROP_TITLE:
         g_value_set_string (value, terminal_screen_get_title (screen));
         break;
+      case PROP_DESCRIPTION:
+        g_value_take_string (value, terminal_screen_get_description (screen));
+        break;
       default:
         G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
         break;
@@ -591,6 +596,7 @@ terminal_screen_set_property (GObject *object,
         terminal_screen_set_profile (screen, (GSettings*)g_value_get_object (value));
         break;
       case PROP_TITLE:
+      case PROP_DESCRIPTION:
         /* not writable */
       default:
         G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
@@ -686,6 +692,14 @@ terminal_screen_class_init (TerminalScreenClass *klass)
 				      G_PARAM_STATIC_NICK |
 				      G_PARAM_STATIC_BLURB)));
 
+  g_object_class_install_property
+    (object_class,
+     PROP_DESCRIPTION,
+     g_param_spec_string ("description", nullptr, nullptr,
+                          nullptr,
+                          GParamFlags(G_PARAM_READABLE |
+                                      G_PARAM_STATIC_STRINGS)));
+
   g_type_class_add_private (object_class, sizeof (TerminalScreenPrivate));
 
   n_url_regexes = G_N_ELEMENTS (url_regex_patterns);
@@ -782,6 +796,7 @@ terminal_screen_finalize (GObject *object)
 
   g_free (priv->uuid);
   g_free (priv->current_cmdline);
+  g_free (priv->title);
 
   G_OBJECT_CLASS (terminal_screen_parent_class)->finalize (object);
 }
@@ -1040,6 +1055,21 @@ terminal_screen_get_title (TerminalScreen *screen)
   return vte_terminal_get_window_title (VTE_TERMINAL (screen));
 }
 
+char *
+terminal_screen_get_description (TerminalScreen *screen)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+  const char *title;
+
+  /* use --title argument if one was supplied, otherwise ask the profile */
+  if (priv->title)
+    title = priv->title;
+
+  return g_strdup_printf ("%s  %d",
+                          title && title[0] ? title : _("Terminal"),
+                          screen->priv->child_pid);
+}
+
 static void
 terminal_screen_profile_changed_cb (GSettings     *profile,
                                     const char    *prop_name,
@@ -1368,6 +1398,7 @@ terminal_screen_set_profile (TerminalScreen *screen,
     g_object_unref (old_profile);
 
   g_object_notify (G_OBJECT (screen), "profile");
+  g_object_notify (G_OBJECT (screen), "description");
 }
 
 GSettings*
@@ -1658,6 +1689,8 @@ spawn_result_cb (VteTerminal *terminal,
 
   priv->child_pid = pid;
 
+  g_object_notify (G_OBJECT (screen), "description");
+
   if (error) {
      // FIXMEchpe should be unnecessary, vte already does this internally
     vte_terminal_set_pty (terminal, nullptr);
@@ -1949,6 +1982,35 @@ terminal_screen_focus_in (GtkWidget     *widget,
   return GTK_WIDGET_CLASS (terminal_screen_parent_class)->focus_in_event (widget, event);
 }
 
+void
+terminal_screen_set_user_title (TerminalScreen *screen,
+                                const char     *title)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+
+  g_return_if_fail (TERMINAL_IS_SCREEN (screen));
+
+  if (g_strcmp0 (priv->title, title) == 0)
+    return;
+
+  g_free (priv->title);
+  priv->title = title && title[0] ? g_strdup (title) : nullptr;
+
+  g_object_notify (G_OBJECT (screen), "description");
+}
+
+const char*
+terminal_screen_get_user_title (TerminalScreen *screen)
+{
+  TerminalScreenPrivate *priv;
+
+  g_return_val_if_fail (TERMINAL_IS_SCREEN (screen), nullptr);
+
+  priv = screen->priv;
+
+  return priv->title ? priv->title : _("Terminal");
+}
+
 /**
  * terminal_screen_get_current_dir:
  * @screen:
@@ -2002,6 +2064,8 @@ terminal_screen_child_exited (VteTerminal *terminal,
 
   priv->child_pid = -1;
 
+  g_object_notify (G_OBJECT (screen), "description");
+
   action = TerminalExitAction(g_settings_get_enum (priv->profile, TERMINAL_PROFILE_EXIT_ACTION_KEY));
 
   switch (action)
diff --git a/src/terminal-screen.hh b/src/terminal-screen.hh
index ded6b8ca..f4ec9047 100644
--- a/src/terminal-screen.hh
+++ b/src/terminal-screen.hh
@@ -113,7 +113,12 @@ void terminal_screen_set_profile (TerminalScreen *screen,
 GSettings* terminal_screen_get_profile (TerminalScreen *screen);
 GSettings* terminal_screen_ref_profile (TerminalScreen *screen);
 
+const char *terminal_screen_get_user_title     (TerminalScreen *screen);
 const char* terminal_screen_get_title          (TerminalScreen *screen);
+char *      terminal_screen_get_description    (TerminalScreen *screen);
+
+void terminal_screen_set_user_title (TerminalScreen *screen,
+                                     const char *text);
 
 char *terminal_screen_get_current_dir (TerminalScreen *screen);
 
-- 
2.40.0


From 3414c88a27d0125ee7b37a6dce2fd4590df261f0 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Thu, 30 Jun 2016 17:39:48 +0200
Subject: [PATCH 10/16] Revert "Remove the static title setting from profile
 preferences"

This reverts commit e9cb8fea14a849704074c5d69f173bcf4dc2fb27.

https://bugzilla.redhat.com/show_bug.cgi?id=1296110
---
 src/org.gnome.Terminal.gschema.xml |  5 +++
 src/preferences.ui                 | 71 ++++++++++++++++++++++++++++++
 src/profile-editor.cc              |  6 +++
 src/terminal-schemas.hh            |  1 +
 src/terminal-screen.cc             |  9 ++++
 5 files changed, 92 insertions(+)

diff --git a/src/org.gnome.Terminal.gschema.xml b/src/org.gnome.Terminal.gschema.xml
index d34e8dc2..9ba0f3b5 100644
--- a/src/org.gnome.Terminal.gschema.xml
+++ b/src/org.gnome.Terminal.gschema.xml
@@ -209,6 +209,11 @@
       <summary>Whether to enable SIXEL images</summary>
       <description>If true, SIXEL sequences are parsed and images are rendered.</description>
     </key>
+    <key name="title" type="s">
+      <default l10n="messages" context="title">'Terminal'</default>
+      <summary>Title for terminal</summary>
+      <description>Title to display for the terminal window or tab. This title may be replaced by or combined with the title set by the application inside the terminal, depending on the title_mode setting.</description>
+    </key>
     <key name="bold-is-bright" type="b">
       <default>false</default>
       <summary>Whether bold is also bright</summary>
diff --git a/src/preferences.ui b/src/preferences.ui
index 5422de71..d851bcb6 100644
--- a/src/preferences.ui
+++ b/src/preferences.ui
@@ -1999,6 +1999,77 @@
                             <property name="can_focus">False</property>
                             <property name="border_width">12</property>
                             <property name="row_spacing">18</property>
+                            <child>
+                              <object class="GtkGrid">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="row_spacing">6</property>
+                                <child>
+                                  <object class="GtkLabel">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="xalign">0</property>
+                                    <property name="label" translatable="yes">Title</property>
+                                    <attributes>
+                                      <attribute name="weight" value="bold"/>
+                                    </attributes>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">0</property>
+                                    <property name="left_attach">0</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <object class="GtkAlignment">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="left_padding">12</property>
+                                    <child>
+                                      <object class="GtkGrid">
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">False</property>
+                                        <property name="column_spacing">12</property>
+                                        <property name="row_spacing">6</property>
+                                        <child>
+                                          <object class="GtkLabel" id="title-entry-label">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="xalign">0</property>
+                                            <property name="label" translatable="yes">Title:</property>
+                                            <property name="use_underline">True</property>
+                                            <property name="mnemonic_widget">title-entry</property>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">0</property>
+                                            <property name="left_attach">0</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <object class="GtkEntry" id="title-entry">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">True</property>
+                                            <property name="hexpand">True</property>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">0</property>
+                                            <property name="left_attach">1</property>
+                                          </packing>
+                                        </child>
+                                      </object>
+                                    </child>
+                                  </object>
+                                  <packing>
+                                    <property name="top_attach">1</property>
+                                    <property name="left_attach">0</property>
+                                    <property name="width">3</property>
+                                  </packing>
+                                </child>
+                              </object>
+                              <packing>
+                                <property name="top_attach">0</property>
+                                <property name="left_attach">0</property>
+                              </packing>
+                            </child>
                             <child>
                               <object class="GtkGrid">
                                 <property name="visible">True</property>
diff --git a/src/profile-editor.cc b/src/profile-editor.cc
index d0e71e26..f7997fbf 100644
--- a/src/profile-editor.cc
+++ b/src/profile-editor.cc
@@ -1416,6 +1416,12 @@ profile_prefs_load (const char *uuid, GSettings *profile)
                                             (GSettingsBindSetMapping) enum_to_string,
                                             terminal_preserve_working_directory_get_type, nullptr);
 
+  profile_prefs_settings_bind (profile,
+                               TERMINAL_PROFILE_TITLE_KEY,
+                               gtk_builder_get_object (builder, "title-entry"),
+                               "text",
+                               GSettingsBindFlags(G_SETTINGS_BIND_GET |
+                                                  G_SETTINGS_BIND_SET));
   profile_prefs_settings_bind (profile, TERMINAL_PROFILE_USE_CUSTOM_COMMAND_KEY,
                                gtk_builder_get_object (builder,
                                                        "use-custom-command-checkbutton"),
diff --git a/src/terminal-schemas.hh b/src/terminal-schemas.hh
index c33723bf..d0f111a0 100644
--- a/src/terminal-schemas.hh
+++ b/src/terminal-schemas.hh
@@ -71,6 +71,7 @@ G_BEGIN_DECLS
 #define TERMINAL_PROFILE_SCROLL_ON_KEYSTROKE_KEY        "scroll-on-keystroke"
 #define TERMINAL_PROFILE_SCROLL_ON_OUTPUT_KEY           "scroll-on-output"
 #define TERMINAL_PROFILE_TEXT_BLINK_MODE_KEY            "text-blink-mode"
+#define TERMINAL_PROFILE_TITLE_KEY                      "title"
 #define TERMINAL_PROFILE_USE_CUSTOM_COMMAND_KEY         "use-custom-command"
 #define TERMINAL_PROFILE_USE_SKEY_KEY                   "use-skey"
 #define TERMINAL_PROFILE_USE_SYSTEM_FONT_KEY            "use-system-font"
diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 8b37de55..506ab66e 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -1059,11 +1059,14 @@ char *
 terminal_screen_get_description (TerminalScreen *screen)
 {
   TerminalScreenPrivate *priv = screen->priv;
+  gs_free char *title_string = nullptr;
   const char *title;
 
   /* use --title argument if one was supplied, otherwise ask the profile */
   if (priv->title)
     title = priv->title;
+  else
+    title = title_string = g_settings_get_string (priv->profile, TERMINAL_PROFILE_TITLE_KEY);
 
   return g_strdup_printf ("%s  %d",
                           title && title[0] ? title : _("Terminal"),
@@ -1109,6 +1112,12 @@ terminal_screen_profile_changed_cb (GSettings     *profile,
       vte_terminal_set_cjk_ambiguous_width (vte_terminal, width);
     }
 
+  if (!prop_name ||
+      prop_name == I_(TERMINAL_PROFILE_TITLE_KEY))
+    {
+      g_object_notify (object, "description");
+    }
+
   if (gtk_widget_get_realized (GTK_WIDGET (screen)) &&
       (!prop_name ||
        prop_name == I_(TERMINAL_PROFILE_USE_SYSTEM_FONT_KEY) ||
-- 
2.40.0


From ff089312a574191b11dec38be4532a48d7bdd5b5 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Tue, 17 Feb 2015 17:06:17 +0100
Subject: [PATCH 11/16] Restore translations for setting a title and
 transparency

---
 po/am.po          |   8 +-
 po/an.po          |  12 +-
 po/ar.po          |  16 +-
 po/as.po          |  16 +-
 po/ast.po         |   8 +-
 po/az.po          |   8 +-
 po/be.po          |   3 +
 po/be@latin.po    |   8 +-
 po/bg.po          |   9 +
 po/bn.po          |   8 +-
 po/bn_IN.po       |  11 +-
 po/br.po          |   6 +-
 po/bs.po          |  10 +
 po/ca.po          |  12 +
 po/ca@valencia.po |  12 +
 po/cs.po          |  12 +
 po/cy.po          |   8 +-
 po/da.po          |  12 +
 po/de.po          |  12 +
 po/dz.po          |   8 +-
 po/el.po          |  15 +-
 po/en@shaw.po     |   8 +-
 po/en_CA.po       |   8 +-
 po/en_GB.po       |  16 +-
 po/eo.po          |   8 +-
 po/es.po          |  16 +-
 po/et.po          |   3 +
 po/eu.po          |  12 +
 po/fa.po          |  18 +-
 po/fi.po          |  12 +
 po/fr.po          |  24 ++
 po/fur.po         |  11 +-
 po/ga.po          |   3 +
 po/gl.po          |  15 +-
 po/gu.po          |  16 +-
 po/he.po          |  16 +-
 po/hi.po          |  17 +-
 po/hr.po          |  10 +
 po/hu.po          |  12 +
 po/hy.po          |   8 +-
 po/id.po          |  12 +
 po/it.po          |  12 +
 po/ja.po          |  12 +
 po/ka.po          |   5 +
 po/kk.po          |  12 +
 po/km.po          |   4 +-
 po/kn.po          |  15 +-
 po/ko.po          |  12 +
 po/ku.po          |   8 +-
 po/lt.po          |  12 +
 po/lv.po          |  16 ++
 po/mai.po         |   8 +-
 po/mg.po          |   8 +-
 po/mk.po          |   8 +-
 po/ml.po          |   3 +
 po/mn.po          |   8 +-
 po/mr.po          |  16 +-
 po/ms.po          |   4 +-
 po/nb.po          |  12 +
 po/nds.po         |   8 +-
 po/ne.po          |  11 +-
 po/nl.po          |  12 +
 po/nn.po          |   8 +-
 po/oc.po          |  12 +-
 po/or.po          |   4 +-
 po/pa.po          |  23 +-
 po/ps.po          |   8 +-
 po/pt.po          |  16 +-
 po/pt_BR.po       |  12 +
 po/ro.po          |   4 +-
 po/ru.po          |  16 ++
 po/rw.po          |   3 +-
 po/si.po          |   8 +-
 po/sk.po          |  12 +
 po/sl.po          | 559 +---------------------------------------------
 po/sq.po          |   8 +-
 po/sr.po          |  22 +-
 po/sr@latin.po    |  22 +-
 po/sv.po          |  12 +
 po/ta.po          |  27 ++-
 po/te.po          |  27 ++-
 po/tg.po          |  16 +-
 po/th.po          |  20 +-
 po/tr.po          |  12 +
 po/ug.po          |   4 +-
 po/uk.po          |  15 ++
 po/vi.po          |  15 +-
 po/wa.po          |  12 +-
 po/xh.po          |  12 +-
 po/zh_CN.po       |  15 +-
 po/zh_HK.po       |  15 +-
 po/zh_TW.po       |  15 +-
 92 files changed, 736 insertions(+), 883 deletions(-)

diff --git a/po/am.po b/po/am.po
index 3445d96d..ee992f07 100644
--- a/po/am.po
+++ b/po/am.po
@@ -214,8 +214,8 @@ msgid "<b>Background</b>"
 msgstr "<b></b>"
 
 #: ../src/gnome-terminal.glade2.h:2
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/gnome-terminal.glade2.h:3
 msgid "<b>Compatibility</b>"
@@ -614,8 +614,8 @@ msgid "_Text color:"
 msgstr "_ "
 
 #: ../src/gnome-terminal.glade2.h:102
-msgid "_Transparent background"
-msgstr "_ "
+msgid "Transparent background"
+msgstr " "
 
 #: ../src/gnome-terminal.glade2.h:103
 msgid "_Update login records when command is launched"
diff --git a/po/an.po b/po/an.po
index fcec2668..9e07cb68 100644
--- a/po/an.po
+++ b/po/an.po
@@ -2241,8 +2241,8 @@ msgstr "_Zarrar a finestra"
 #~ msgid "Use custom default terminal si_ze"
 #~ msgstr "Emplegar grandaria predeterminada presonali_zada de terminal"
 
-#~ msgid "Title"
-#~ msgstr "Titol"
+msgid "Title"
+msgstr "Titol"
 
 #~ msgid "When terminal commands set their o_wn titles:"
 #~ msgstr ""
@@ -2266,8 +2266,8 @@ msgstr "_Zarrar a finestra"
 #~ msgid "Close Window"
 #~ msgstr "Zarrar a finestra"
 
-#~ msgid "Set Title"
-#~ msgstr "Establir titol"
+msgid "Set Title"
+msgstr "Establir titol"
 
 #~ msgid "Switch to Tab 2"
 #~ msgstr "Cambiar a la pestanya 2"
@@ -2340,8 +2340,8 @@ msgstr "_Zarrar a finestra"
 #~ msgid "_Input Methods"
 #~ msgstr "Me_todos de dentrada"
 
-#~ msgid "_Title:"
-#~ msgstr "_Titol:"
+msgid "_Title:"
+msgstr "_Titol:"
 
 #~ msgid "Keyboard Shortcuts"
 #~ msgstr "Alcorces de teclau"
diff --git a/po/ar.po b/po/ar.po
index fac62fd1..f77804d8 100644
--- a/po/ar.po
+++ b/po/ar.po
@@ -2574,11 +2574,11 @@ msgstr "_ "
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "_:"
+msgid "_Title:"
+msgstr "_:"
 
 #~ msgid "Title and Command"
 #~ msgstr " "
@@ -2586,8 +2586,8 @@ msgstr "_ "
 #~ msgid "_Unlimited"
 #~ msgstr "_ "
 
-#~ msgid "Set Title"
-#~ msgstr " "
+msgid "Set Title"
+msgstr " "
 
 #~ msgid "Current Locale"
 #~ msgstr " "
@@ -3330,8 +3330,8 @@ msgstr "_ "
 #~ msgid "Background image _scrolls"
 #~ msgstr "  _"
 
-#~ msgid "_Transparent background"
-#~ msgstr " _"
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid "S_hade transparent or image background:"
 #~ msgstr "_    :"
diff --git a/po/as.po b/po/as.po
index 3fade2b8..5b905340 100644
--- a/po/as.po
+++ b/po/as.po
@@ -2163,11 +2163,11 @@ msgstr "   (_l)"
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr " (_T):"
+msgid "_Title:"
+msgstr " (_T):"
 
 #~ msgid "Title and Command"
 #~ msgstr "  "
@@ -2175,8 +2175,8 @@ msgstr "   (_l)"
 #~ msgid "_Unlimited"
 #~ msgstr " (_U)"
 
-#~ msgid "Set Title"
-#~ msgstr "  "
+msgid "Set Title"
+msgstr "  "
 
 #~ msgid "Current Locale"
 #~ msgstr " "
@@ -2979,8 +2979,8 @@ msgstr "   (_l)"
 #~ msgid "Background image _scrolls"
 #~ msgstr "    (_s)"
 
-#~ msgid "_Transparent background"
-#~ msgstr "  (_T)"
+msgid "Transparent background"
+msgstr "  "
 
 #~ msgid "S_hade transparent or image background:"
 #~ msgstr "        (_h):"
diff --git a/po/ast.po b/po/ast.po
index d1c6e7b8..4dc0892e 100644
--- a/po/ast.po
+++ b/po/ast.po
@@ -1304,8 +1304,8 @@ msgid "_Base on:"
 msgstr "_Basu en:"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b>Comandu</b>"
+msgid "Command"
+msgstr "Comandu"
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground, Background, Bold and Underline</b>"
@@ -1598,8 +1598,8 @@ msgid "_Text color:"
 msgstr "Color del _testu:"
 
 #: ../src/profile-preferences.glade.h:77
-msgid "_Transparent background"
-msgstr "Fondu _tresparente"
+msgid "Transparent background"
+msgstr "Fondu tresparente"
 
 #: ../src/profile-preferences.glade.h:78
 msgid "_Underline color:"
diff --git a/po/az.po b/po/az.po
index 586c1e4d..4bd84679 100644
--- a/po/az.po
+++ b/po/az.po
@@ -218,8 +218,8 @@ msgid "<b>Background</b>"
 msgstr "<b>Arxa plan</b>"
 
 #: ../src/gnome-terminal.glade2.h:2
-msgid "<b>Command</b>"
-msgstr "<b>mr</b>"
+msgid "Command"
+msgstr "mr"
 
 #: ../src/gnome-terminal.glade2.h:3
 msgid "<b>Compatibility</b>"
@@ -620,8 +620,8 @@ msgid "_Text color:"
 msgstr "_Mtn rngi:"
 
 #: ../src/gnome-terminal.glade2.h:102
-msgid "_Transparent background"
-msgstr "_ffaf arxa plan"
+msgid "Transparent background"
+msgstr "ffaf arxa plan"
 
 #: ../src/gnome-terminal.glade2.h:103
 msgid "_Update login records when command is launched"
diff --git a/po/be.po b/po/be.po
index 298ec2d6..50f46093 100644
--- a/po/be.po
+++ b/po/be.po
@@ -2635,3 +2635,6 @@ msgstr "_ "
 
 #~ msgid "Current Locale"
 #~ msgstr " "
+
+msgid "Transparent background"
+msgstr " "
diff --git a/po/be@latin.po b/po/be@latin.po
index 82ef0664..27e9877f 100644
--- a/po/be@latin.po
+++ b/po/be@latin.po
@@ -1146,8 +1146,8 @@ msgid "_Base on:"
 msgstr "Na _bazie:"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b>Zahad</b>"
+msgid "Command"
+msgstr "Zahad"
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground and Background</b>"
@@ -1426,8 +1426,8 @@ msgid "_Text color:"
 msgstr "Koler _tekstu:"
 
 #: ../src/profile-preferences.glade.h:73
-msgid "_Transparent background"
-msgstr "_Prazrysty fon"
+msgid "Transparent background"
+msgstr "Prazrysty fon"
 
 #: ../src/profile-preferences.glade.h:74
 msgid "_Update login records when command is launched"
diff --git a/po/bg.po b/po/bg.po
index 24e4aa3c..8b30af1e 100644
--- a/po/bg.po
+++ b/po/bg.po
@@ -2480,3 +2480,12 @@ msgstr "_   "
 #, c-format
 msgid "Failed to parse arguments: %s\n"
 msgstr "     : %s\n"
+
+msgid "Transparent background"
+msgstr " "
+
+msgid "_Title:"
+msgstr "_:"
+
+msgid "Set Title"
+msgstr "  "
diff --git a/po/bn.po b/po/bn.po
index 4906009c..f97d43b0 100644
--- a/po/bn.po
+++ b/po/bn.po
@@ -1217,8 +1217,8 @@ msgid "_Base on:"
 msgstr "    : (_B)"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground, Background, and Bold</b>"
@@ -1524,8 +1524,8 @@ msgid "_Text color:"
 msgstr " : (_T)"
 
 #: ../src/profile-preferences.glade.h:76
-msgid "_Transparent background"
-msgstr "  (_T)"
+msgid "Transparent background"
+msgstr "  "
 
 #: ../src/profile-preferences.glade.h:77
 msgid "_Unlimited"
diff --git a/po/bn_IN.po b/po/bn_IN.po
index 96f28aae..fdd0ef72 100644
--- a/po/bn_IN.po
+++ b/po/bn_IN.po
@@ -2894,8 +2894,8 @@ msgstr "   (_l)"
 #~ msgid "_Unlimited"
 #~ msgstr " (_U)"
 
-#~ msgid "Set Title"
-#~ msgstr "  "
+msgid "Set Title"
+msgstr "  "
 
 #~ msgid "Switch to Tab 3"
 #~ msgstr " -  "
@@ -2936,5 +2936,8 @@ msgstr "   (_l)"
 #~ msgid "_Input Methods"
 #~ msgstr "  (_I)"
 
-#~ msgid "_Title:"
-#~ msgstr ": (_T)"
+msgid "_Title:"
+msgstr ": (_T)"
+
+msgid "Transparent background"
+msgstr "  "
diff --git a/po/br.po b/po/br.po
index e16ea07d..f4cbe857 100644
--- a/po/br.po
+++ b/po/br.po
@@ -958,8 +958,8 @@ msgid "_Base on:"
 msgstr ""
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b>Arc'had</b>"
+msgid "Command"
+msgstr "Arc'had"
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground and Background</b>"
@@ -1211,7 +1211,7 @@ msgid "_Text color:"
 msgstr "Liv an destenn :"
 
 #: ../src/profile-preferences.glade.h:73
-msgid "_Transparent background"
+msgid "Transparent background"
 msgstr ""
 
 #: ../src/profile-preferences.glade.h:74
diff --git a/po/bs.po b/po/bs.po
index 49e71085..87035529 100644
--- a/po/bs.po
+++ b/po/bs.po
@@ -680,6 +680,10 @@ msgstr "Kratica tastature za poveavanje fonta"
 msgid "Keyboard shortcut to make font smaller"
 msgstr "Kratica tastature za smanjivanje fonta"
 
+#: ../src/gnome-terminal.glade2.h:102
+msgid "Transparent background"
+msgstr "Providna pozadina"
+
 #: ../src/org.gnome.Terminal.gschema.xml.h:78
 msgid "Keyboard shortcut to make font normal-size"
 msgstr "Kratica tastature za postavljanje fonta na normalnu veliinu"
@@ -2054,3 +2058,9 @@ msgstr ""
 #: ../src/terminal-window.c:3652
 msgid "C_lose Window"
 msgstr "_Zatvori prozor"
+
+msgid "_Title:"
+msgstr "_Naslov:"
+
+msgid "Set Title"
+msgstr "Postavi naslov"
diff --git a/po/ca.po b/po/ca.po
index 17de40fa..7661e3da 100644
--- a/po/ca.po
+++ b/po/ca.po
@@ -2510,3 +2510,15 @@ msgstr "Tanca la _finestra"
 #, c-format
 msgid "Failed to parse arguments: %s\n"
 msgstr "Ha fallat l'anlisi dels arguments: %s\n"
+
+msgid "Transparent background"
+msgstr "Fons transparent"
+
+msgid "Title"
+msgstr "Ttol"
+
+msgid "_Title:"
+msgstr "Tt_ol:"
+
+msgid "Set Title"
+msgstr "Estableix el ttol"
diff --git a/po/ca@valencia.po b/po/ca@valencia.po
index a6e8fb42..c9ed8508 100644
--- a/po/ca@valencia.po
+++ b/po/ca@valencia.po
@@ -2357,3 +2357,15 @@ msgstr "Tanca la _finestra"
 
 #~ msgid "Whether to use a dark theme variant"
 #~ msgstr "Si s'ha d'utilitzar la variant de tema fosc"
+
+msgid "Transparent background"
+msgstr "Fons transparent"
+
+msgid "Title"
+msgstr "Ttol"
+
+msgid "_Title:"
+msgstr "Tt_ol:"
+
+msgid "Set Title"
+msgstr "Estableix el ttol"
diff --git a/po/cs.po b/po/cs.po
index 1beaf216..f27be077 100644
--- a/po/cs.po
+++ b/po/cs.po
@@ -2452,3 +2452,15 @@ msgstr "_Zavt okno"
 #, c-format
 msgid "Failed to parse arguments: %s\n"
 msgstr "Selhala analza argument: %s\n"
+
+msgid "Transparent background"
+msgstr "Prsvitn pozad"
+
+msgid "Title"
+msgstr "Zhlav"
+
+msgid "_Title:"
+msgstr "Z_hlav:"
+
+msgid "Set Title"
+msgstr "Nastavit zhlav"
diff --git a/po/cy.po b/po/cy.po
index 644df823..cd862feb 100644
--- a/po/cy.po
+++ b/po/cy.po
@@ -1167,8 +1167,8 @@ msgid "_Base on:"
 msgstr "Ei _seilio ar:"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b>Gorchymyn</b>"
+msgid "Command"
+msgstr "Gorchymyn"
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground and Background</b>"
@@ -1448,8 +1448,8 @@ msgid "_Text color:"
 msgstr "Lliw'r _testun:"
 
 #: ../src/profile-preferences.glade.h:73
-msgid "_Transparent background"
-msgstr "Cefndir _tryloyw"
+msgid "Transparent background"
+msgstr "Cefndir tryloyw"
 
 #: ../src/profile-preferences.glade.h:74
 msgid "_Update login records when command is launched"
diff --git a/po/da.po b/po/da.po
index f3fbaec7..352fcf1c 100644
--- a/po/da.po
+++ b/po/da.po
@@ -2517,3 +2517,15 @@ msgstr "Kunne ikke fortolke argumenter: %s\n"
 
 #~ msgid "_Detach Tab"
 #~ msgstr "_Lsriv faneblad"
+
+msgid "Title"
+msgstr "Titel"
+
+msgid "_Title:"
+msgstr "_Titel:"
+
+msgid "Set Title"
+msgstr "St titel"
+
+msgid "Transparent background"
+msgstr "Gennemsigtig baggrund"
diff --git a/po/de.po b/po/de.po
index 988a392b..6a82f915 100644
--- a/po/de.po
+++ b/po/de.po
@@ -2604,3 +2604,15 @@ msgstr "Einlesen der Argumente schlug fehl: %s\n"
 
 #~ msgid "_Quit"
 #~ msgstr "_Beenden"
+
+msgid "Title"
+msgstr "Titel"
+
+msgid "_Title:"
+msgstr "_Titel:"
+
+msgid "Set Title"
+msgstr "Titel festlegen"
+
+msgid "Transparent background"
+msgstr "Transparenter Hintergrund"
diff --git a/po/dz.po b/po/dz.po
index d97e6102..a768fe4a 100644
--- a/po/dz.po
+++ b/po/dz.po
@@ -1255,8 +1255,8 @@ msgid "_Base on:"
 msgstr ":(_B)"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/profile-preferences.glade.h:2
 #, fuzzy
@@ -1551,8 +1551,8 @@ msgid "_Text color:"
 msgstr ":(_T)"
 
 #: ../src/profile-preferences.glade.h:77
-msgid "_Transparent background"
-msgstr "(_T)"
+msgid "Transparent background"
+msgstr ""
 
 #: ../src/profile-preferences.glade.h:78
 #, fuzzy
diff --git a/po/el.po b/po/el.po
index 6ec773a0..258c9e84 100644
--- a/po/el.po
+++ b/po/el.po
@@ -2940,17 +2940,17 @@ msgstr "   : %s\n"
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "_:"
+msgid "_Title:"
+msgstr "_:"
 
 #~ msgid "Title and Command"
 #~ msgstr "  "
 
-#~ msgid "Set Title"
-#~ msgstr " "
+msgid "Set Title"
+msgstr " "
 
 #~ msgid "Current Locale"
 #~ msgstr "  "
@@ -2988,3 +2988,6 @@ msgstr "   : %s\n"
 
 #~ msgid "_Input Methods"
 #~ msgstr "_ "
+
+msgid "Transparent background"
+msgstr " "
diff --git a/po/en@shaw.po b/po/en@shaw.po
index 5bdb3925..6fb8a7e1 100644
--- a/po/en@shaw.po
+++ b/po/en@shaw.po
@@ -1212,8 +1212,8 @@ msgid "_Base on:"
 msgstr "_ :"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground, Background, Bold and Underline</b>"
@@ -1468,8 +1468,8 @@ msgid "_Text color:"
 msgstr "_ :"
 
 #: ../src/profile-preferences.glade.h:78
-msgid "_Transparent background"
-msgstr "_ "
+msgid "Transparent background"
+msgstr " "
 
 #: ../src/profile-preferences.glade.h:79
 msgid "_Underline color:"
diff --git a/po/en_CA.po b/po/en_CA.po
index 6c9e0cd7..db4aa891 100644
--- a/po/en_CA.po
+++ b/po/en_CA.po
@@ -219,8 +219,8 @@ msgid "<b>Background</b>"
 msgstr "<b>Background</b>"
 
 #: ../src/gnome-terminal.glade2.h:3
-msgid "<b>Command</b>"
-msgstr "<b>Command</b>"
+msgid "Command"
+msgstr "Command"
 
 #: ../src/gnome-terminal.glade2.h:4
 msgid "<b>Compatibility</b>"
@@ -557,8 +557,8 @@ msgid "_Text color:"
 msgstr "_Text colour:"
 
 #: ../src/gnome-terminal.glade2.h:86
-msgid "_Transparent background"
-msgstr "_Transparent background"
+msgid "Transparent background"
+msgstr "Transparent background"
 
 #: ../src/gnome-terminal.glade2.h:87
 msgid "_Update login records when command is launched"
diff --git a/po/en_GB.po b/po/en_GB.po
index 2d112348..675cdb3d 100644
--- a/po/en_GB.po
+++ b/po/en_GB.po
@@ -2858,8 +2858,8 @@ msgstr "Failed to parse arguments: %s\n"
 #~ msgid "Default size:"
 #~ msgstr "Default size:"
 
-#~ msgid "Title"
-#~ msgstr "Title"
+msgid "Title"
+msgstr "Title"
 
 #~ msgid "When terminal commands set their o_wn titles:"
 #~ msgstr "When terminal commands set their o_wn titles:"
@@ -2876,8 +2876,8 @@ msgstr "Failed to parse arguments: %s\n"
 #~ msgid "_Unlimited"
 #~ msgstr "_Unlimited"
 
-#~ msgid "Set Title"
-#~ msgstr "Set Title"
+msgid "Set Title"
+msgstr "Set Title"
 
 #~ msgid "Switch to Tab 3"
 #~ msgstr "Switch to Tab 3"
@@ -2918,8 +2918,8 @@ msgstr "Failed to parse arguments: %s\n"
 #~ msgid "_Input Methods"
 #~ msgstr "_Input Methods"
 
-#~ msgid "_Title:"
-#~ msgstr "_Title:"
+msgid "_Title:"
+msgstr "_Title:"
 
 #~ msgid "Add or Remove Terminal Encodings"
 #~ msgstr "Add or Remove Terminal Encodings"
@@ -3614,8 +3614,8 @@ msgstr "Failed to parse arguments: %s\n"
 #~ msgid "Background image _scrolls"
 #~ msgstr "Background image _scrolls"
 
-#~ msgid "_Transparent background"
-#~ msgstr "_Transparent background"
+msgid "Transparent background"
+msgstr "Transparent background"
 
 #~ msgid "S_hade transparent or image background:"
 #~ msgstr "S_hade transparent or image background:"
diff --git a/po/eo.po b/po/eo.po
index 0e83b981..0d98ea57 100644
--- a/po/eo.po
+++ b/po/eo.po
@@ -2827,8 +2827,8 @@ msgstr "_Fermi la fenestron"
 #~ msgid "_Font:"
 #~ msgstr "_Tiparo:"
 
-#~ msgid "Set Title"
-#~ msgstr "Agordi titolon"
+msgid "Set Title"
+msgstr "Agordi titolon"
 
 #~ msgid "Switch to Tab 3"
 #~ msgstr "alti al langeto 3"
@@ -2890,8 +2890,8 @@ msgstr "_Fermi la fenestron"
 #~ msgid "_Input Methods"
 #~ msgstr "_Enigmetodoj"
 
-#~ msgid "_Title:"
-#~ msgstr "_Titolo:"
+msgid "_Title:"
+msgstr "_Titolo:"
 
 #~ msgid "On the left side"
 #~ msgstr "Maldekstre"
diff --git a/po/es.po b/po/es.po
index fefea713..1cef08bf 100644
--- a/po/es.po
+++ b/po/es.po
@@ -2946,17 +2946,17 @@ msgstr "Fall al analizar los argumentos: %s\n"
 #~ msgid "Default size:"
 #~ msgstr "Tamao predeterminado:"
 
-#~ msgid "Title"
-#~ msgstr "Titulo"
+msgid "Title"
+msgstr "Titulo"
 
-#~ msgid "_Title:"
-#~ msgstr "_Ttulo:"
+msgid "_Title:"
+msgstr "_Ttulo:"
 
 #~ msgid "Title and Command"
 #~ msgstr "Ttulo y comando"
 
-#~ msgid "Set Title"
-#~ msgstr "Establecer ttulo"
+msgid "Set Title"
+msgstr "Establecer ttulo"
 
 #~ msgid "Current Locale"
 #~ msgstr "Configuracin regional actual"
@@ -3783,8 +3783,8 @@ msgstr "Fall al analizar los argumentos: %s\n"
 #~ msgid "_Solid color"
 #~ msgstr "Color _slido"
 
-#~ msgid "_Transparent background"
-#~ msgstr "Fondo _transparente"
+msgid "Transparent background"
+msgstr "Fondo transparente"
 
 #~ msgid "No such profile \"%s\", using default profile\n"
 #~ msgstr "No existe el perfil %s, usando el perfil predeterminado\n"
diff --git a/po/et.po b/po/et.po
index 4b1c2a7c..77076116 100644
--- a/po/et.po
+++ b/po/et.po
@@ -1747,3 +1747,6 @@ msgstr "Su_lge aken"
 
 #~ msgid "Choose base profile"
 #~ msgstr "Vali phiprofiil"
+
+msgid "Transparent background"
+msgstr "Lbipaistev taust"
diff --git a/po/eu.po b/po/eu.po
index 05484111..7f93de46 100644
--- a/po/eu.po
+++ b/po/eu.po
@@ -2391,3 +2391,15 @@ msgstr "Huts egin du argumentuak analizatzean: %s\n"
 
 #~ msgid "_Detach Tab"
 #~ msgstr "_Desuztartu fitxa"
+
+msgid "Title"
+msgstr "Titulua"
+
+msgid "_Title:"
+msgstr "_Titulua:"
+
+msgid "Set Title"
+msgstr "Ezarri titulua"
+
+msgid "Transparent background"
+msgstr "Atzeko plano gardena"
diff --git a/po/fa.po b/po/fa.po
index bf738bca..352d7365 100644
--- a/po/fa.po
+++ b/po/fa.po
@@ -2818,8 +2818,11 @@ msgstr "   : %s\n"
 #~ msgid "_Font:"
 #~ msgstr "_:"
 
-#~ msgid "Title"
-#~ msgstr ""
+#~ msgid "Use custom default terminal si_ze"
+#~ msgstr "   _  "
+
+msgid "Title"
+msgstr ""
 
 #~ msgid "When terminal commands set their o_wn titles:"
 #~ msgstr "     _   :"
@@ -2833,8 +2836,8 @@ msgstr "   : %s\n"
 #~ msgid "_Unlimited"
 #~ msgstr "_"
 
-#~ msgid "Set Title"
-#~ msgstr " "
+msgid "Set Title"
+msgstr " "
 
 #~ msgid "Switch to Tab 3"
 #~ msgstr "   "
@@ -2875,5 +2878,8 @@ msgstr "   : %s\n"
 #~ msgid "_Input Methods"
 #~ msgstr " _"
 
-#~ msgid "_Title:"
-#~ msgstr "_:"
+msgid "_Title:"
+msgstr "_:"
+
+msgid "Transparent background"
+msgstr " "
diff --git a/po/fi.po b/po/fi.po
index 28f05dbd..ba5995c9 100644
--- a/po/fi.po
+++ b/po/fi.po
@@ -2782,9 +2782,21 @@ msgstr "Virhe tulkittaessa argumentteja: %s\n"
 #~ msgid "_Update login records when command is launched"
 #~ msgstr "_Pivit kirjautumistallenne kun komento kynnistetn"
 
+msgid "Transparent background"
+msgstr "Lpinkyv tausta"
+
 #~| msgid "Error parsing command: %s"
 #~ msgid "Missing command"
 #~ msgstr "Puuttuva komento"
 
 #~ msgid "Whether to use a dark theme variant"
 #~ msgstr "Kytetnk teeman tummaan muunnelmaa"
+
+msgid "Title"
+msgstr "Otsikko"
+
+msgid "_Title:"
+msgstr "_Otsikko:"
+
+msgid "Set Title"
+msgstr "Aseta otsikko"
diff --git a/po/fr.po b/po/fr.po
index 60db7700..71628caa 100644
--- a/po/fr.po
+++ b/po/fr.po
@@ -2569,3 +2569,27 @@ msgstr "Impossible danalyser les paramtres: %s\n"
 
 #~ msgid "Icelandic"
 #~ msgstr "Islandais"
+
+#~ msgid "Set _Character Encoding"
+#~ msgstr "_Dfinir le codage des caractres"
+
+#~ msgid "Move Tab _Left"
+#~ msgstr "Dplacer longlet vers la _gauche"
+
+#~ msgid "Move Tab _Right"
+#~ msgstr "Dplacer longlet vers la _droite"
+
+#~ msgid "_Detach Tab"
+#~ msgstr "_Dtacher longlet"
+
+msgid "Transparent background"
+msgstr "Arrire-plan transparent"
+
+msgid "Title"
+msgstr "Titre"
+
+msgid "_Title:"
+msgstr "_Titre:"
+
+msgid "Set Title"
+msgstr "Dfinir le titre"
diff --git a/po/fur.po b/po/fur.po
index bfcab11d..4a7aed17 100644
--- a/po/fur.po
+++ b/po/fur.po
@@ -571,6 +571,10 @@ msgstr ""
 msgid "Which encoding to use"
 msgstr "Codifiche di dopr"
 
+#: ../src/gnome-terminal.glade2.h:86
+msgid "Transparent background"
+msgstr "Fondl trasparent"
+
 #: src/org.gnome.Terminal.gschema.xml:350
 msgid ""
 "Whether ambiguous-width characters are narrow or wide when using UTF-8 "
@@ -3613,6 +3617,9 @@ msgstr "Analisi dai argoments falide: %s\n"
 #~ msgid "The text you clicked on doesn't seem to be a valid OTP challenge."
 #~ msgstr "Il test fract nol samee jessi un OTP challenge."
 
+msgid "Set Title"
+msgstr "Imposte titul"
+
 #~ msgid "Switch to Tab 3"
 #~ msgstr "Passe a la schede 3"
 
@@ -3668,8 +3675,8 @@ msgstr "Analisi dai argoments falide: %s\n"
 #~ msgid "_Input Methods"
 #~ msgstr "_Cemt inser test"
 
-#~ msgid "_Title:"
-#~ msgstr "_Titul:"
+msgid "_Title:"
+msgstr "_Titul:"
 
 #~ msgid "text/plain dropped on terminal had wrong format (%d) or length (%d)\n"
 #~ msgstr ""
diff --git a/po/ga.po b/po/ga.po
index 93d5fa9d..feb87dce 100644
--- a/po/ga.po
+++ b/po/ga.po
@@ -1925,3 +1925,6 @@ msgstr "_Dn Fuinneog"
 #: ../src/terminal-window.c:3582
 msgid "C_lose Terminal"
 msgstr "_Dn Teirminal"
+
+msgid "Transparent background"
+msgstr "Clra trdhearcach"
diff --git a/po/gl.po b/po/gl.po
index c0dc3349..adea6024 100644
--- a/po/gl.po
+++ b/po/gl.po
@@ -2500,11 +2500,14 @@ msgstr "P_echar a xanela"
 msgid "Failed to parse arguments: %s\n"
 msgstr "Produciuse un erro ao analizar os argumentos: %s\n"
 
-#~ msgid "org.gnome.Terminal"
-#~ msgstr "org.gnome.Terminal"
+msgid "Title"
+msgstr "Ttulo"
 
-#~ msgid "Armenian"
-#~ msgstr "Armenio"
+msgid "_Title:"
+msgstr "_Ttulo:"
 
-#~ msgid "Georgian"
-#~ msgstr "Xeorxiano"
+msgid "Set Title"
+msgstr "Definir o ttulo"
+
+msgid "Transparent background"
+msgstr "Fondo transparente"
diff --git a/po/gu.po b/po/gu.po
index 76b459cf..485beeac 100644
--- a/po/gu.po
+++ b/po/gu.po
@@ -2155,8 +2155,8 @@ msgstr "   (_l)"
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
 #~ msgid "When terminal commands set their o_wn titles:"
 #~ msgstr "       (_w):"
@@ -2176,8 +2176,8 @@ msgstr "   (_l)"
 #~ msgid "Close Window"
 #~ msgstr "  "
 
-#~ msgid "Set Title"
-#~ msgstr "  "
+msgid "Set Title"
+msgstr "  "
 
 #~ msgid "The shortcut key %s is already bound to the %s action"
 #~ msgstr "  %s    %s   "
@@ -2203,8 +2203,8 @@ msgstr "   (_l)"
 #~ msgid "_Input Methods"
 #~ msgstr "   (_I)"
 
-#~ msgid "_Title:"
-#~ msgstr " (_T):"
+msgid "_Title:"
+msgstr " (_T):"
 
 #~ msgid "Keyboard shortcut to switch to tab 1"
 #~ msgstr "      "
@@ -2944,8 +2944,8 @@ msgstr "   (_l)"
 #~ msgid "_Solid color"
 #~ msgstr "  (_S)"
 
-#~ msgid "_Transparent background"
-#~ msgstr "    (_T)"
+msgid "Transparent background"
+msgstr "   "
 
 #~ msgid "No such profile \"%s\", using default profile\n"
 #~ msgstr "\"%s\"    ,     \n"
diff --git a/po/he.po b/po/he.po
index 8c1c6012..e198baff 100644
--- a/po/he.po
+++ b/po/he.po
@@ -2818,17 +2818,17 @@ msgstr "Failed to parse arguments: %s\n"
 #~ msgid "Default size:"
 #~ msgstr "  :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "_:"
+msgid "_Title:"
+msgstr "_:"
 
 #~ msgid "Title and Command"
 #~ msgstr " "
 
-#~ msgid "Set Title"
-#~ msgstr " "
+msgid "Set Title"
+msgstr " "
 
 #~ msgid "Current Locale"
 #~ msgstr " "
@@ -3642,8 +3642,8 @@ msgstr "Failed to parse arguments: %s\n"
 #~ msgid "_Solid color"
 #~ msgstr " _"
 
-#~ msgid "_Transparent background"
-#~ msgstr " _"
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid "No such profile \"%s\", using default profile\n"
 #~ msgstr "No such profile \"%s\", using default profile\n"
diff --git a/po/hi.po b/po/hi.po
index 2d7dc5b1..8d3d0529 100644
--- a/po/hi.po
+++ b/po/hi.po
@@ -2267,9 +2267,8 @@ msgstr "   (_l)"
 #~ msgid "Use custom default terminal si_ze"
 #~ msgstr "       (_z)"
 
-#~| msgid "_Title:"
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
 #~ msgid "When terminal commands set their o_wn titles:"
 #~ msgstr "         (_w):"
@@ -2289,8 +2288,8 @@ msgstr "   (_l)"
 #~ msgid "Close Window"
 #~ msgstr "  "
 
-#~ msgid "Set Title"
-#~ msgstr "  "
+msgid "Set Title"
+msgstr "  "
 
 #~ msgid "Switch to Tab 2"
 #~ msgstr " 2  "
@@ -2349,8 +2348,8 @@ msgstr "   (_l)"
 #~ msgid "_Input Methods"
 #~ msgstr "  (_I)"
 
-#~ msgid "_Title:"
-#~ msgstr " (_T):"
+msgid "_Title:"
+msgstr " (_T):"
 
 #~ msgid "Disable connection to session manager"
 #~ msgstr "     "
@@ -2979,8 +2978,8 @@ msgstr "   (_l)"
 #~ msgid "_Background image"
 #~ msgstr "  (_B)"
 
-#~ msgid "_Transparent background"
-#~ msgstr "  (_T)"
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid "S/Key Challenge Response"
 #~ msgstr "/  "
diff --git a/po/hr.po b/po/hr.po
index aa384812..4a28d9ae 100644
--- a/po/hr.po
+++ b/po/hr.po
@@ -2771,3 +2771,13 @@ msgstr "Greka u obradi argumenata: %s\n"
 
 #~ msgid "Use transparency from system theme"
 #~ msgstr "Koristi prozirnost iz teme sustava"
+
+#: ../src/profile-preferences.glade.h:69
+msgid "Transparent background"
+msgstr "Prozirna pozadina"
+
+msgid "_Title:"
+msgstr "_Naslov:"
+
+msgid "Set Title"
+msgstr "Postavi naslov"
diff --git a/po/hu.po b/po/hu.po
index d09d6ece..8911e09d 100644
--- a/po/hu.po
+++ b/po/hu.po
@@ -2483,3 +2483,15 @@ msgstr "_Ablak bezrsa"
 #, c-format
 msgid "Failed to parse arguments: %s\n"
 msgstr "A paramterek feldolgozsa meghisult: %s\n"
+
+msgid "Title"
+msgstr "Cm"
+
+msgid "_Title:"
+msgstr "_Cm:"
+
+msgid "Set Title"
+msgstr "Cm belltsa"
+
+msgid "Transparent background"
+msgstr "ttetsz httr"
diff --git a/po/hy.po b/po/hy.po
index aaf2d9b2..4d466f16 100644
--- a/po/hy.po
+++ b/po/hy.po
@@ -757,8 +757,8 @@ msgid "_Base on:"
 msgstr ""
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground and Background</b>"
@@ -1012,8 +1012,8 @@ msgid "_Text color:"
 msgstr "_ "
 
 #: ../src/profile-preferences.glade.h:73
-msgid "_Transparent background"
-msgstr "_ "
+msgid "Transparent background"
+msgstr " "
 
 #: ../src/profile-preferences.glade.h:74
 msgid "_Update login records when command is launched"
diff --git a/po/id.po b/po/id.po
index 28527487..2cff39a2 100644
--- a/po/id.po
+++ b/po/id.po
@@ -2500,3 +2500,15 @@ msgstr "Gagal mengurai argumen: \"%s\"\n"
 
 #~ msgid "_Detach Tab"
 #~ msgstr "_Pisahkan Tab"
+
+msgid "Transparent background"
+msgstr "Latar belakang transparan"
+
+msgid "Title"
+msgstr "Judul"
+
+msgid "_Title:"
+msgstr "_Judul:"
+
+msgid "Set Title"
+msgstr "Atur Judul"
diff --git a/po/it.po b/po/it.po
index c559a981..a69b00e5 100644
--- a/po/it.po
+++ b/po/it.po
@@ -2428,3 +2428,15 @@ msgstr "Chiudi _finestra"
 #, c-format
 msgid "Failed to parse arguments: %s\n"
 msgstr "Analisi degli argomenti non riuscita: %s\n"
+
+msgid "Transparent background"
+msgstr "Sfondo trasparente"
+
+msgid "Title"
+msgstr "Titolo"
+
+msgid "_Title:"
+msgstr "_Titolo:"
+
+msgid "Set Title"
+msgstr "Imposta titolo"
diff --git a/po/ja.po b/po/ja.po
index ab72bc42..690281a6 100644
--- a/po/ja.po
+++ b/po/ja.po
@@ -2534,3 +2534,15 @@ msgstr "(_L)"
 
 #~ msgid "_Incremental Search"
 #~ msgstr "(_I)"
+
+msgid "Transparent background"
+msgstr ""
+
+msgid "Title"
+msgstr ""
+
+msgid "_Title:"
+msgstr "(_T):"
+
+msgid "Set Title"
+msgstr ""
diff --git a/po/ka.po b/po/ka.po
index 6d5c2b62..a2d0ef3a 100644
--- a/po/ka.po
+++ b/po/ka.po
@@ -177,6 +177,11 @@ msgstr " -
 msgid "Human-readable name of the profile."
 msgstr " -  ."
 
+#: ../src/gnome-terminal.glade2.h:86
+#, fuzzy
+msgid "Transparent background"
+msgstr ""
+
 #: src/org.gnome.Terminal.gschema.xml:139
 msgid "Default color of text in the terminal"
 msgstr "   "
diff --git a/po/kk.po b/po/kk.po
index 34ce6b2a..5d415eb3 100644
--- a/po/kk.po
+++ b/po/kk.po
@@ -2741,3 +2741,15 @@ msgstr "   : %
 
 #~ msgid "Be quiet"
 #~ msgstr " "
+
+msgid "Transparent background"
+msgstr " "
+
+msgid "Title"
+msgstr ""
+
+msgid "_Title:"
+msgstr "_:"
+
+msgid "Set Title"
+msgstr " "
diff --git a/po/km.po b/po/km.po
index 352897d2..b6db9394 100644
--- a/po/km.po
+++ b/po/km.po
@@ -2909,8 +2909,8 @@ msgstr ""
 #~ msgid "Background image _scrolls"
 #~ msgstr ""
 
-#~ msgid "_Transparent background"
-#~ msgstr ""
+msgid "Transparent background"
+msgstr ""
 
 #~ msgid "S_hade transparent or image background:"
 #~ msgstr "  "
diff --git a/po/kn.po b/po/kn.po
index c887f88a..0fc1c313 100644
--- a/po/kn.po
+++ b/po/kn.po
@@ -2261,8 +2261,8 @@ msgstr "   (_l)"
 #~ msgid "Use custom default terminal si_ze"
 #~ msgstr "    (_z)"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
 #~ msgid "When terminal commands set their o_wn titles:"
 #~ msgstr "     (_w):"
@@ -2282,8 +2282,8 @@ msgstr "   (_l)"
 #~ msgid "Close Window"
 #~ msgstr " "
 
-#~ msgid "Set Title"
-#~ msgstr " "
+msgid "Set Title"
+msgstr " "
 
 #~ msgid "Switch to Tab 2"
 #~ msgstr "2   "
@@ -2342,5 +2342,8 @@ msgstr "   (_l)"
 #~ msgid "_Input Methods"
 #~ msgstr "  (_I)"
 
-#~ msgid "_Title:"
-#~ msgstr "(_T):"
+msgid "_Title:"
+msgstr "(_T):"
+
+msgid "Transparent background"
+msgstr " "
diff --git a/po/ko.po b/po/ko.po
index d30b5fd7..627ca437 100644
--- a/po/ko.po
+++ b/po/ko.po
@@ -2537,3 +2537,15 @@ msgstr "  : %s\n"
 
 #~ msgid "Verbose output"
 #~ msgstr " "
+
+msgid "Transparent background"
+msgstr " "
+
+msgid "Title"
+msgstr ""
+
+msgid "_Title:"
+msgstr "(_T):"
+
+msgid "Set Title"
+msgstr " "
diff --git a/po/ku.po b/po/ku.po
index bc2bb7f0..d2a83a00 100644
--- a/po/ku.po
+++ b/po/ku.po
@@ -223,8 +223,8 @@ msgid "<b>Background</b>"
 msgstr "<b>Zemn</b>"
 
 #: ../src/gnome-terminal.glade2.h:3
-msgid "<b>Command</b>"
-msgstr "<b>Ferman</b>"
+msgid "Command"
+msgstr "Ferman"
 
 #: ../src/gnome-terminal.glade2.h:4
 msgid "<b>Compatibility</b>"
@@ -558,8 +558,8 @@ msgid "_Text color:"
 msgstr "Reng _nivs:"
 
 #: ../src/gnome-terminal.glade2.h:86
-msgid "_Transparent background"
-msgstr "Rerd _transparan"
+msgid "Transparent background"
+msgstr "Rerd transparan"
 
 #: ../src/gnome-terminal.glade2.h:87
 msgid "_Update login records when command is launched"
diff --git a/po/lt.po b/po/lt.po
index 20f4a6c1..ace70da0 100644
--- a/po/lt.po
+++ b/po/lt.po
@@ -2795,3 +2795,15 @@ msgstr "Nepavyko apdoroti argument: %s\n"
 
 #~ msgid "Whether to use a dark theme variant"
 #~ msgstr "Ar naudoti tams temos variant"
+
+msgid "Transparent background"
+msgstr "Permatomas fonas"
+
+msgid "Title"
+msgstr "Pavadinimas"
+
+msgid "_Title:"
+msgstr "_Pavadinimas:"
+
+msgid "Set Title"
+msgstr "Nustatyti pavadinim"
diff --git a/po/lv.po b/po/lv.po
index dd601873..1544e268 100644
--- a/po/lv.po
+++ b/po/lv.po
@@ -2715,3 +2715,19 @@ msgstr "Neizdevs parst parametrus  %s\n"
 
 #~ msgid "_Add or Remove"
 #~ msgstr "_Pievienot vai izemt"
+
+msgid "Transparent background"
+msgstr "Caurspdgs fons"
+
+msgid "Title"
+msgstr "Nosaukums"
+
+msgid "_Title:"
+msgstr "_Nosaukums:"
+
+msgctxt "title"
+msgid "'Terminal'"
+msgstr "Terminlis"
+
+msgid "Set Title"
+msgstr "Iestatt nosaukumu"
diff --git a/po/mai.po b/po/mai.po
index 715d0b9e..0f31634e 100644
--- a/po/mai.po
+++ b/po/mai.po
@@ -1044,8 +1044,8 @@ msgid "_Base on:"
 msgstr " : (_B)"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground and Background</b>"
@@ -1291,8 +1291,8 @@ msgid "_Text color:"
 msgstr "  (_T):"
 
 #: ../src/profile-preferences.glade.h:69
-msgid "_Transparent background"
-msgstr "  (_T)"
+msgid "Transparent background"
+msgstr " "
 
 #: ../src/profile-preferences.glade.h:70
 msgid "_Update login records when command is launched"
diff --git a/po/mg.po b/po/mg.po
index 99fa0f5e..a2166025 100644
--- a/po/mg.po
+++ b/po/mg.po
@@ -220,8 +220,8 @@ msgid "<b>Background</b>"
 msgstr "<b>Afara</b>"
 
 #: ../src/gnome-terminal.glade2.h:3
-msgid "<b>Command</b>"
-msgstr "<b>Baiko</b>"
+msgid "Command"
+msgstr "Baiko"
 
 #: ../src/gnome-terminal.glade2.h:4
 msgid "<b>Compatibility</b>"
@@ -567,8 +567,8 @@ msgid "_Text color:"
 msgstr "Lokon'ny _soratra:"
 
 #: ../src/gnome-terminal.glade2.h:86
-msgid "_Transparent background"
-msgstr "_Afara tatera-pahazavana"
+msgid "Transparent background"
+msgstr "Afara tatera-pahazavana"
 
 #: ../src/gnome-terminal.glade2.h:87
 msgid "_Update login records when command is launched"
diff --git a/po/mk.po b/po/mk.po
index 4fe43192..a5a874b4 100644
--- a/po/mk.po
+++ b/po/mk.po
@@ -863,8 +863,8 @@ msgid "_Base on:"
 msgstr "_ :"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/profile-preferences.glade.h:2
 #| msgid "<b>Foreground and Background</b>"
@@ -1167,8 +1167,8 @@ msgid "_Text color:"
 msgstr "_  :"
 
 #: ../src/profile-preferences.glade.h:77
-msgid "_Transparent background"
-msgstr "_ "
+msgid "Transparent background"
+msgstr " "
 
 #: ../src/profile-preferences.glade.h:78
 #| msgid "_Text color:"
diff --git a/po/ml.po b/po/ml.po
index 29614970..e3bce122 100644
--- a/po/ml.po
+++ b/po/ml.po
@@ -2577,3 +2577,6 @@ msgstr "  (_l)"
 
 #~ msgid "_Unlimited"
 #~ msgstr " (_U)"
+
+msgid "Transparent background"
+msgstr "  "
diff --git a/po/mn.po b/po/mn.po
index 2f9d8607..09c4437d 100644
--- a/po/mn.po
+++ b/po/mn.po
@@ -217,8 +217,8 @@ msgid "<b>Background</b>"
 msgstr "<b></b>"
 
 #: ../src/gnome-terminal.glade2.h:2
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/gnome-terminal.glade2.h:3
 msgid "<b>Compatibility</b>"
@@ -618,8 +618,8 @@ msgid "_Text color:"
 msgstr "_ :"
 
 #: ../src/gnome-terminal.glade2.h:102
-msgid "_Transparent background"
-msgstr "_ "
+msgid "Transparent background"
+msgstr " "
 
 #: ../src/gnome-terminal.glade2.h:103
 msgid "_Update login records when command is launched"
diff --git a/po/mr.po b/po/mr.po
index 61997daf..9c7dc77a 100644
--- a/po/mr.po
+++ b/po/mr.po
@@ -2219,8 +2219,8 @@ msgstr "   (_l)"
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
 #~ msgid "When terminal commands set their o_wn titles:"
 #~ msgstr "       (_w):"
@@ -2240,8 +2240,8 @@ msgstr "   (_l)"
 #~ msgid "Close Window"
 #~ msgstr "  "
 
-#~ msgid "Set Title"
-#~ msgstr "  "
+msgid "Set Title"
+msgstr "  "
 
 #~ msgid "The shortcut key %s is already bound to the %s action"
 #~ msgstr "%s    %s    "
@@ -2267,8 +2267,8 @@ msgstr "   (_l)"
 #~ msgid "_Input Methods"
 #~ msgstr "  (_I)"
 
-#~ msgid "_Title:"
-#~ msgstr " (_T):"
+msgid "_Title:"
+msgstr " (_T):"
 
 #~ msgid "Keyboard shortcut to switch to tab 1"
 #~ msgstr " 1   "
@@ -3015,8 +3015,8 @@ msgstr "   (_l)"
 #~ msgid "_Solid color"
 #~ msgstr "  (_S)"
 
-#~ msgid "_Transparent background"
-#~ msgstr " (_T)"
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid "Disabled"
 #~ msgstr ""
diff --git a/po/ms.po b/po/ms.po
index 114f0d4e..5d3f2e01 100644
--- a/po/ms.po
+++ b/po/ms.po
@@ -2717,8 +2717,8 @@ msgstr "T_utup Tetingkap"
 #~ msgid "_Profile name:"
 #~ msgstr "_Nama profil: "
 
-#~ msgid "_Transparent background"
-#~ msgstr "LatarBelakang _Telus"
+msgid "Transparent background"
+msgstr "LatarBelakang Telus"
 
 #~ msgid "_Update login records when command is launched"
 #~ msgstr "_Kemaskini rekod logmasuk bila arahan dilancarkan"
diff --git a/po/nb.po b/po/nb.po
index 99cb5599..5b1a79ad 100644
--- a/po/nb.po
+++ b/po/nb.po
@@ -2436,3 +2436,15 @@ msgstr "_Lukk vindu"
 #, c-format
 msgid "Failed to parse arguments: %s\n"
 msgstr "Klarte ikke  lese argumenter: %s\n"
+
+msgid "Transparent background"
+msgstr "Gjennomsiktig bakgrunn"
+
+msgid "Title"
+msgstr "Tittel"
+
+msgid "_Title:"
+msgstr "_Tittel:"
+
+msgid "Set Title"
+msgstr "Sett tittel"
diff --git a/po/nds.po b/po/nds.po
index 82f930b1..d52fbd94 100644
--- a/po/nds.po
+++ b/po/nds.po
@@ -748,8 +748,8 @@ msgid "_Base on:"
 msgstr "_Steiht op:"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b>Order</b>"
+msgid "Command"
+msgstr "Order"
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground and Background</b>"
@@ -996,8 +996,8 @@ msgid "_Text color:"
 msgstr "_Textklr:"
 
 #: ../src/profile-preferences.glade.h:73
-msgid "_Transparent background"
-msgstr "_Drschienenachtergrund:"
+msgid "Transparent background"
+msgstr "Drschienenachtergrund:"
 
 #: ../src/profile-preferences.glade.h:74
 msgid "_Update login records when command is launched"
diff --git a/po/ne.po b/po/ne.po
index 992d7bad..7c560b83 100644
--- a/po/ne.po
+++ b/po/ne.po
@@ -2745,8 +2745,8 @@ msgstr "%s   \n"
 #~ msgid "_None (use solid color)"
 #~ msgstr "   (   )"
 
-#~ msgid "_Transparent background"
-#~ msgstr " "
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid "_Use the system fixed width font"
 #~ msgstr "      "
@@ -3338,6 +3338,9 @@ msgstr "%s   \n"
 #~ msgid "The text you clicked on doesn't seem to be a valid OTP challenge."
 #~ msgstr "     OTP    "
 
+msgid "Set Title"
+msgstr "  "
+
 #~ msgid "Switch to Tab 3"
 #~ msgstr "    "
 
@@ -3477,8 +3480,8 @@ msgstr "%s   \n"
 #~ msgid "_Input Methods"
 #~ msgstr " "
 
-#~ msgid "_Title:"
-#~ msgstr ":"
+msgid "_Title:"
+msgstr ":"
 
 #~ msgid "text/plain dropped on terminal had wrong format (%d) or length (%d)\n"
 #~ msgstr "  /   (%d)   (%d) \n"
diff --git a/po/nl.po b/po/nl.po
index cb6a5d2a..81f17d0f 100644
--- a/po/nl.po
+++ b/po/nl.po
@@ -2808,3 +2808,15 @@ msgstr "Argumenten ontleden is mislukt: %s\n"
 
 #~ msgid "_Add or Remove"
 #~ msgstr "_Toevoegen of verwijderen"
+
+msgid "Title"
+msgstr "Titel"
+
+msgid "_Title:"
+msgstr "_Titel:"
+
+msgid "Set Title"
+msgstr "Titel instellen"
+
+msgid "Transparent background"
+msgstr "Transparante achtergrond"
diff --git a/po/nn.po b/po/nn.po
index 5aa43b11..f892290c 100644
--- a/po/nn.po
+++ b/po/nn.po
@@ -1149,8 +1149,8 @@ msgid "_Base on:"
 msgstr "_Tuft p:"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b>Kommando</b>"
+msgid "Command"
+msgstr "Kommando"
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground and Background</b>"
@@ -1429,8 +1429,8 @@ msgid "_Text color:"
 msgstr "_Tekstfarge:"
 
 #: ../src/profile-preferences.glade.h:73
-msgid "_Transparent background"
-msgstr "_Gjennomskinleg bakgrunn"
+msgid "Transparent background"
+msgstr "Gjennomskinleg bakgrunn"
 
 #: ../src/profile-preferences.glade.h:74
 msgid "_Update login records when command is launched"
diff --git a/po/oc.po b/po/oc.po
index 4563b354..0ecd5919 100644
--- a/po/oc.po
+++ b/po/oc.po
@@ -3057,8 +3057,8 @@ msgstr "Impossible d'analisar los paramtres : %s\n"
 #~ msgid "Save as..."
 #~ msgstr "Enregistrar jos..."
 
-#~ msgid "_Title:"
-#~ msgstr "_Ttol :"
+msgid "_Title:"
+msgstr "_Ttol :"
 
 #~ msgid "_Detach tab"
 #~ msgstr "Des_tacar l'onglet"
@@ -3518,8 +3518,8 @@ msgstr "Impossible d'analisar los paramtres : %s\n"
 #~ msgid "_Use the system fixed width font"
 #~ msgstr "_Utilizar la polia de chassa fixa del sistma"
 
-#~ msgid "Set Title"
-#~ msgstr "Definir lo ttol"
+msgid "Set Title"
+msgstr "Definir lo ttol"
 
 #~ msgid "The shortcut key %s is already bound to the %s action"
 #~ msgstr "L'acorchi de clavir  %s  es ja atribuit a l'accion  %s "
@@ -3833,8 +3833,8 @@ msgstr "Impossible d'analisar los paramtres : %s\n"
 #~ msgid "Run;"
 #~ msgstr "Executar;Consla;Shell;"
 
-#~ msgid "_Transparent background"
-#~ msgstr "Rireplan _transparent"
+msgid "Transparent background"
+msgstr "Rireplan transparent"
 
 #~ msgid ""
 #~ "A subset of possible encodings are presented in the Encoding submenu. "
diff --git a/po/or.po b/po/or.po
index ec1e6bfb..218acd71 100644
--- a/po/or.po
+++ b/po/or.po
@@ -2705,8 +2705,8 @@ msgstr " (_T):"
 #~ msgid "Background image _scrolls"
 #~ msgstr "   (_s)"
 
-#~ msgid "_Transparent background"
-#~ msgstr "  (_T)"
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid "S_hade transparent or image background:"
 #~ msgstr "     (_h):"
diff --git a/po/pa.po b/po/pa.po
index 1cb4b46d..2bdd01fe 100644
--- a/po/pa.po
+++ b/po/pa.po
@@ -2718,10 +2718,9 @@ msgstr "  (_l)"
 #~ msgid "GNOME Terminal Client"
 #~ msgstr "  "
 
-#~| msgid "Terminal"
-#~ msgctxt "title"
-#~ msgid "'Terminal'"
-#~ msgstr "''"
+msgctxt "title"
+msgid "'Terminal'"
+msgstr "''"
 
 #~ msgid "Title for terminal"
 #~ msgstr "  "
@@ -2766,11 +2765,11 @@ msgstr "  (_l)"
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "(_T):"
+msgid "_Title:"
+msgstr "(_T):"
 
 #~ msgid "Title and Command"
 #~ msgstr "  "
@@ -2778,8 +2777,8 @@ msgstr "  (_l)"
 #~ msgid "_Unlimited"
 #~ msgstr "(_U)"
 
-#~ msgid "Set Title"
-#~ msgstr "  "
+msgid "Set Title"
+msgstr "  "
 
 #~ msgid "Current Locale"
 #~ msgstr " "
@@ -3559,8 +3558,8 @@ msgstr "  (_l)"
 #~ msgid "_Solid color"
 #~ msgstr "  (_S)"
 
-#~ msgid "_Transparent background"
-#~ msgstr " (_T)"
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid "S/Key Challenge Response"
 #~ msgstr "S/  "
diff --git a/po/ps.po b/po/ps.po
index b25a2cb4..3855b2f3 100644
--- a/po/ps.po
+++ b/po/ps.po
@@ -810,8 +810,8 @@ msgid "_Base on:"
 msgstr ":  _"
 
 #: ../src/profile-preferences.glade.h:1
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/profile-preferences.glade.h:2
 msgid "<b>Foreground and Background</b>"
@@ -1053,8 +1053,8 @@ msgid "_Text color:"
 msgstr ":  _"
 
 #: ../src/profile-preferences.glade.h:69
-msgid "_Transparent background"
-msgstr " _"
+msgid "Transparent background"
+msgstr " "
 
 #: ../src/profile-preferences.glade.h:70
 msgid "_Update login records when command is launched"
diff --git a/po/pt.po b/po/pt.po
index f5df7eb5..9728483b 100644
--- a/po/pt.po
+++ b/po/pt.po
@@ -2865,11 +2865,11 @@ msgstr "Falha ao processar argumentos: %s\n"
 #~ msgid "Default size:"
 #~ msgstr "Tamanho predefinido:"
 
-#~ msgid "Title"
-#~ msgstr "Ttulo"
+msgid "Title"
+msgstr "Ttulo"
 
-#~ msgid "_Title:"
-#~ msgstr "_Ttulo:"
+msgid "_Title:"
+msgstr "_Ttulo:"
 
 #~ msgid "Title and Command"
 #~ msgstr "Ttulo e comando"
@@ -2877,8 +2877,8 @@ msgstr "Falha ao processar argumentos: %s\n"
 #~ msgid "_Unlimited"
 #~ msgstr "_Ilimitado"
 
-#~ msgid "Set Title"
-#~ msgstr "Definir o Ttulo"
+msgid "Set Title"
+msgstr "Definir o Ttulo"
 
 #~ msgid "Current Locale"
 #~ msgstr "Configurao Regional Atual"
@@ -3633,8 +3633,8 @@ msgstr "Falha ao processar argumentos: %s\n"
 #~ msgid "Background image _scrolls"
 #~ msgstr "Imagem de fundo _rola"
 
-#~ msgid "_Transparent background"
-#~ msgstr "Fundo _transparente"
+msgid "Transparent background"
+msgstr "Fundo transparente"
 
 #~ msgid "S_hade transparent or image background:"
 #~ msgstr "Transparente som_breado ou imagem de fundo:"
diff --git a/po/pt_BR.po b/po/pt_BR.po
index 4fac562a..117f63bb 100644
--- a/po/pt_BR.po
+++ b/po/pt_BR.po
@@ -2423,3 +2423,15 @@ msgstr "_Fechar janela"
 #, c-format
 msgid "Failed to parse arguments: %s\n"
 msgstr "Falha ao analisar os argumentos: %s\n"
+
+msgid "Title"
+msgstr "Ttulo"
+
+msgid "_Title:"
+msgstr "_Ttulo:"
+
+msgid "Set Title"
+msgstr "Definir ttulo"
+
+msgid "Transparent background"
+msgstr "Fundo transparente"
diff --git a/po/ro.po b/po/ro.po
index 627aea90..14d04172 100644
--- a/po/ro.po
+++ b/po/ro.po
@@ -3545,8 +3545,8 @@ msgstr "Parsarea argumentelor a euat: %s\n"
 #~ msgid "_Solid color"
 #~ msgstr "Culoare _solid"
 
-#~ msgid "_Transparent background"
-#~ msgstr "Fundal _transparent"
+msgid "Transparent background"
+msgstr "Fundal transparent"
 
 #~ msgid "_Unlimited"
 #~ msgstr "_Neliminat"
diff --git a/po/ru.po b/po/ru.po
index e563cb75..d3fabaca 100644
--- a/po/ru.po
+++ b/po/ru.po
@@ -2771,3 +2771,19 @@ msgstr "   : %s\n"
 
 #~ msgid "_Add or Remove"
 #~ msgstr "_  "
+
+msgid "Transparent background"
+msgstr " "
+
+msgid "Title"
+msgstr ""
+
+msgid "_Title:"
+msgstr "_:"
+
+msgctxt "title"
+msgid "'Terminal'"
+msgstr "''"
+
+msgid "Set Title"
+msgstr " "
diff --git a/po/rw.po b/po/rw.po
index 012f64e3..5ff633f8 100644
--- a/po/rw.po
+++ b/po/rw.po
@@ -749,7 +749,7 @@ msgstr "Ibara ry'Inyandiko..."
 
 #: ../src/gnome-terminal.glade2.h:102
 #, fuzzy
-msgid "_Transparent background"
+msgid "Transparent background"
 msgstr "Mbuganyuma"
 
 #: ../src/gnome-terminal.glade2.h:103
@@ -2398,7 +2398,6 @@ msgstr ""
 
 # sch/source\ui\app\menu.src:RID_MENU.WORKAROUND_22.SID_INSERT_TITLE.text
 #: ../src/terminal-screen.c:2005
-#, fuzzy
 msgid "_Title:"
 msgstr "Umutwe..."
 
diff --git a/po/si.po b/po/si.po
index adca7d5a..6379cee7 100644
--- a/po/si.po
+++ b/po/si.po
@@ -218,8 +218,8 @@ msgid "<b>Background</b>"
 msgstr "<b></b>"
 
 #: ../src/gnome-terminal.glade2.h:3
-msgid "<b>Command</b>"
-msgstr "<b></b>"
+msgid "Command"
+msgstr ""
 
 #: ../src/gnome-terminal.glade2.h:4
 msgid "<b>Compatibility</b>"
@@ -538,8 +538,8 @@ msgid "_Text color:"
 msgstr " : (_T)"
 
 #: ../src/gnome-terminal.glade2.h:86
-msgid "_Transparent background"
-msgstr "   (_T)"
+msgid "Transparent background"
+msgstr "  "
 
 #: ../src/gnome-terminal.glade2.h:87
 msgid "_Update login records when command is launched"
diff --git a/po/sk.po b/po/sk.po
index e6745075..20d303c8 100644
--- a/po/sk.po
+++ b/po/sk.po
@@ -3086,3 +3086,15 @@ msgstr "_Zavrie okno"
 #~ "\n"
 #~ "Viac informcii o jednotlivch prkazoch zskate pomocou %s PRKAZ --"
 #~ "help.\n"
+
+msgid "Transparent background"
+msgstr "Priehadn pozadie"
+
+msgid "Title"
+msgstr "Titulok"
+
+msgid "_Title:"
+msgstr "_Titulok:"
+
+msgid "Set Title"
+msgstr "Nastavi titulok"
diff --git a/po/sl.po b/po/sl.po
index 796c3a09..a8344029 100644
--- a/po/sl.po
+++ b/po/sl.po
@@ -2461,557 +2461,14 @@ msgstr "_Zapri okno"
 msgid "Failed to parse arguments: %s\n"
 msgstr "Napaka med razlenjevanjem argumentov: %s\n"
 
-#~ msgid "org.gnome.Terminal"
-#~ msgstr "org.gnome.Terminal"
+msgid "Title"
+msgstr "Naslov"
 
-#~ msgid "Armenian"
-#~ msgstr "Armenski"
+msgid "_Title:"
+msgstr "_Naziv:"
 
-#~ msgid "Georgian"
-#~ msgstr "Gruzijski"
+msgid "Set Title"
+msgstr "Doloitev naziva okna"
 
-#~ msgid "Whether to allow bold text"
-#~ msgstr "Ali naj se dovoli krepko besedilo"
-
-#~ msgid "If true, allow applications in the terminal to make text boldface."
-#~ msgstr ""
-#~ "Izbrana monost omogoa, da programi izpiejo krepko oblikovano besedilo"
-
-#~ msgid "Hindi"
-#~ msgstr "Hindujski"
-
-#~ msgid "Persian"
-#~ msgstr "Perzijski"
-
-#~ msgid "Gujarati"
-#~ msgstr "Gujaratski"
-
-#~ msgid "Gurmukhi"
-#~ msgstr "Gurmukijski"
-
-#~ msgid "Icelandic"
-#~ msgstr "Islandski"
-
-#~ msgid "Set _Character Encoding"
-#~ msgstr "Doloi nabor _znakov"
-
-#~ msgid "Move Tab _Left"
-#~ msgstr "Premakni zavihek _levo"
-
-#~ msgid "Move Tab _Right"
-#~ msgstr "Premakni zavihek _desno"
-
-#~ msgid "_Detach Tab"
-#~ msgstr "_Odpni zavihek"
-
-#~ msgid "Whether to show menubar in new windows/tabs"
-#~ msgstr "Ali naj bo v novih oknih ali zavihkih vidna menijska vrstica"
-
-#~ msgid "True if the menubar should be shown in new window"
-#~ msgstr ""
-#~ "Izbrana monost doloa, da bo v novih oknih prikazana menijska vrstica"
-
-#~ msgid "_Quit"
-#~ msgstr "_Konaj"
-
-#~ msgid "Unnamed"
-#~ msgstr "Neimenovan"
-
-#~ msgid "Open in _Midnight Commander"
-#~ msgstr "Odpri s programom _Midnight Commander"
-
-#~ msgid ""
-#~ "Open the currently selected folder in the terminal file manager Midnight "
-#~ "Commander"
-#~ msgstr ""
-#~ "Odpri trenutno izbrano mapo v terminalu s programom Midnight Commander"
-
-#~ msgid ""
-#~ "Open the currently open folder in the terminal file manager Midnight "
-#~ "Commander"
-#~ msgstr ""
-#~ "Odpri trenutno odprto mapo v terminalu s programom Midnight Commander"
-
-#~ msgid "Open _Midnight Commander"
-#~ msgstr "Odpri program _Midnight Commander"
-
-#~ msgid "Open the terminal file manager Midnight Commander"
-#~ msgstr "V terminalu odpri program Midnight Commander"
-
-#~ msgid "Verbose output"
-#~ msgstr "Podroben izpis"
-
-#~ msgid "Output options:"
-#~ msgstr "Monosti izpisa:"
-
-#~ msgid "Show output options"
-#~ msgstr "Prikae monosti odvoda"
-
-#~ msgid "%s is not a valid application ID"
-#~ msgstr "%s ni veljaven ID programa"
-
-#~ msgid "Server application ID"
-#~ msgstr "ID programa strenika"
-
-#~ msgid "ID"
-#~ msgstr "ID"
-
-#~ msgid "Show completions"
-#~ msgstr "Pokai dopolnjevanje"
-
-#~ msgid "Global options:"
-#~ msgstr "Splone monosti:"
-
-#~ msgid "Show global options"
-#~ msgstr "Pokae splone monosti"
-
-#~ msgid "FD passing of stdin is not supported"
-#~ msgstr "Sklic FD na standardni vhod ni podprt"
-
-#~ msgid "FD passing of stdout is not supported"
-#~ msgstr "Sklic FD na standardni izhod ni podprt"
-
-#~ msgid "FD passing of stderr is not supported"
-#~ msgstr "Sklic FD na standardno napako ni podprt"
-
-#~ msgid "Invalid argument %s to --fd option"
-#~ msgstr "Neveljaven argument %s za monost --fd"
-
-#~ msgid "Forward stdin"
-#~ msgstr "Posreduj standardni vhod"
-
-#~ msgid "Forward stdout"
-#~ msgstr "Posreduj standardni izhod"
-
-#~ msgid "Forward stderr"
-#~ msgstr "Posreduj standardno napako"
-
-#~ msgid "Exec options:"
-#~ msgstr "Monosti izvajanja:"
-
-#~ msgid "Show exec options"
-#~ msgstr "Prikae monosti izvajanja"
-
-#~ msgid "Maximise the window"
-#~ msgstr "Razpni okno"
-
-#~ msgid "Window options:"
-#~ msgstr "Monosti okna:"
-
-#~ msgid "Show window options"
-#~ msgstr "Pokai monosti okna"
-
-#~ msgid "Zoom value %s is outside allowed range"
-#~ msgstr "Vrednost priblianja %s je izven veljavnega obmoja"
-
-#~ msgid "UUID"
-#~ msgstr "UUID"
-
-#~ msgid "Terminal options:"
-#~ msgstr "Monosti terminala:"
-
-#~ msgid "Processing options:"
-#~ msgstr "Monosti opravil:"
-
-#~ msgid "Show processing options"
-#~ msgstr "Prikae monosti opravil"
-
-#~ msgid "Missing argument"
-#~ msgstr "Manjka argument"
-
-#~ msgid "Unknown command %s"
-#~ msgstr "Neznan ukaz %s"
-
-#~ msgid "%s needs the command to run as arguments after --"
-#~ msgstr "%s zahteva ukaz za zagon ukaza kot argument za '--'"
-
-#~ msgid "Extraneous arguments after --"
-#~ msgstr "Dodatni argument za  -- "
-
-#~ msgid "GTerminal"
-#~ msgstr "GTerminal"
-
-#~ msgid "Error processing arguments: %s\n"
-#~ msgstr "Napaka med obdelavo argumentov: %s\n"
-
-#~ msgid "Keyboard shortcut to create a new profile"
-#~ msgstr "Tipkovna blinjica za ustvarjanje novega profila"
-
-#~ msgid "Keyboard shortcut to open the current profiles Preferences dialog"
-#~ msgstr "Tipkovna blinjica za odpiranje pogovornega okna lastnosti profila"
-
-#~ msgid "List of available encodings"
-#~ msgstr "Seznam razpololjivih znakovnih naborov"
-
-#~ msgid ""
-#~ "A subset of possible encodings are presented in the Encoding submenu. "
-#~ "This is a list of encodings to appear there."
-#~ msgstr ""
-#~ "Podrejeni izbor razpololjivih naborov znakov je prikazan v podmeniju "
-#~ "kodiranja. Seznam je prikazan spodaj."
-
-#~ msgid "_Profile used when launching a new terminal:"
-#~ msgstr "Profil, ki naj se _uporabi ob zagonu novega terminala:"
-
-#~ msgid "E_ncodings shown in menu:"
-#~ msgstr "Nabori _prikazani v meniju:"
-
-#~ msgid "Profile Editor"
-#~ msgstr "Urejevalnik profilov"
-
-#~ msgid "_Profile name:"
-#~ msgstr "Ime _profila:"
-
-#~ msgid "_Rewrap on resize"
-#~ msgstr "_Samodejno prelomi"
-
-#~ msgid ""
-#~ "<b>Note:</b> Terminal applications have these colors available to them."
-#~ msgstr "<b>Opomba:</b> programi terminala imajo na voljo te barve."
-
-#~ msgid ""
-#~ "<b>Note:</b> These options may cause some applications to behave "
-#~ "incorrectly.  They are only here to allow you to work around certain "
-#~ "applications and operating systems that expect different terminal "
-#~ "behavior."
-#~ msgstr ""
-#~ "<b>Opomba:</b> Te monosti lahko vplivajo na nepravilno delovanje "
-#~ "nekaterih programov. Tu so le zato, da lahko delate z doloenimi programi "
-#~ "in operacijskimi sistemi, ki priakujejo drugano delovanje terminala."
-
-#~ msgid "New Terminal in New Tab"
-#~ msgstr "Nov terminal v novem zavihku"
-
-#~ msgid "New Terminal in New Window"
-#~ msgstr "Nov terminal v novem oknu"
-
-#~ msgid "Close All Terminals"
-#~ msgstr "Zapri vsa okna terminala"
-
-#~ msgid "Clear Find Highlight"
-#~ msgstr "Poisti poudarjanje iskanja"
-
-#~ msgid "Detach Terminal"
-#~ msgstr "Odpni terminal"
-
-#~ msgid "User Defined"
-#~ msgstr "Prikrojeno"
-
-#~ msgid "Click button to choose profile"
-#~ msgstr "Kliknite gumb za izbiro profila"
-
-#~ msgid "Profile list"
-#~ msgstr "Seznam profilov"
-
-#~ msgid "Show"
-#~ msgstr "Pokai"
-
-#~ msgid "_Encoding"
-#~ msgstr "_Nabor znakov"
-
-#~ msgid "_Profile Preferences"
-#~ msgstr "_Monosti profila"
-
-#~ msgid "Switch to this tab"
-#~ msgstr "Preklopi na ta zavihek"
-
-#~ msgid "_%u. %s"
-#~ msgstr "_%u. %s"
-
-#~ msgid "_%c. %s"
-#~ msgstr "_%c. %s"
-
-#~ msgid "Open _Terminal"
-#~ msgstr "Odpri _terminal"
-
-#~ msgid "Open Ta_b"
-#~ msgstr "Odpri za_vihek"
-
-#~ msgid "New _Profile"
-#~ msgstr "Nov _profil"
-
-#~ msgid "_Close All Terminals"
-#~ msgstr "_Zapri vsa okna terminala"
-
-#~ msgid "Pre_ferences"
-#~ msgstr "_Monosti"
-
-#~ msgid "Find Ne_xt"
-#~ msgstr "Najdi _naslednje"
-
-#~ msgid "Find Pre_vious"
-#~ msgstr "Najdi _predhodne"
-
-#~ msgid "Go to _Line"
-#~ msgstr "Skoi v _vrstico ..."
-
-#~ msgid "_Incremental Search"
-#~ msgstr "_Postopno iskanje ..."
-
-#~ msgid "_Add or Remove"
-#~ msgstr "_Dodaj ali odstrani ..."
-
-#~ msgid "_Next Terminal"
-#~ msgstr "_Naslednji terminal"
-
-#~ msgid ""
-#~ "Default color of bold text in the terminal, as a color specification (can "
-#~ "be HTML-style hex digits, or a color name such as \"red\"). This is "
-#~ "ignored if bold_color_same_as_fg is true."
-#~ msgstr ""
-#~ "Privzeta barva krepkega besedila terminala. Doloena je lahko kot HTML, "
-#~ "estnajstiko ali pa z imenom (\"red\" za rdeo). Monost je prezrta "
-#~ "kadar barva krepkega besedila enaka obiajnemu besedilu."
-
-#~ msgid "_Custom font"
-#~ msgstr "Pisava po _meri"
-
-#~ msgid "_Text color:"
-#~ msgstr "Barva _besedila:"
-
-#~ msgid "_Background color:"
-#~ msgstr "Barva _ozadja:"
-
-#~ msgid "_Same as text color"
-#~ msgstr "Enako barvi _besedila"
-
-#~ msgid "Bol_d color:"
-#~ msgstr "Barva krepkega besedila:"
-
-#~ msgid "Search _backwards"
-#~ msgstr "Poii _nazaj"
-
-#~ msgid ""
-#~ "Possible values are \"close\" to close the terminal, and \"restart\" to "
-#~ "restart the command."
-#~ msgstr ""
-#~ "Mogoe vrednosti so \"close\" (zapri) za zapiranje terminala in "
-#~ "\"restart\" (ponovni zagon) za vnovien zagon ukaza."
-
-#~ msgid "shell;prompt;command;commandline;"
-#~ msgstr "lupina;ukaz;ukazna vrstica;terminal;"
-
-#~ msgid ""
-#~ "If true, the system login records utmp and wtmp will be updated when the "
-#~ "command inside the terminal is launched."
-#~ msgstr ""
-#~ "Izbrana monost omogoa, da bosta prijavna zapisa utmp in wtmp "
-#~ "posodobljena, ko se bo zagnal ukaz znotraj terminala."
-
-#~ msgid "_Update login records when command is launched"
-#~ msgstr "Posodobi prijavne zapise, ko je _ukaz zagnan"
-
-#~ msgid "Unknown completion request for \"%s\""
-#~ msgstr "Neznana zahteva za dokonanje \"%s\""
-
-#~ msgid "Missing command"
-#~ msgstr "Manjka ukaz"
-
-#~ msgid "Whether to use a dark theme variant"
-#~ msgstr "Ali naj se uporabi temna tema okna"
-
-#~ msgid "Use _dark theme variant"
-#~ msgstr "Uporabi _temno temo"
-
-#~ msgid "Set the terminal title"
-#~ msgstr "Nastavi naziv terminala"
-
-#~ msgid "_Use the system fixed width font"
-#~ msgstr "_Uporabi sistemsko pisavo doloene irine"
-
-#~ msgid "_Font:"
-#~ msgstr "_Pisava:"
-
-#~ msgid "_Unlimited"
-#~ msgstr "_Neomejeno"
-
-#~ msgid ""
-#~ "Commands:\n"
-#~ "  help    Shows this information\n"
-#~ "  run     Create a new terminal running the specified command\n"
-#~ "  shell   Create a new terminal running the user shell\n"
-#~ "\n"
-#~ "Use \"%s COMMAND --help\" to get help on each command.\n"
-#~ msgstr ""
-#~ "Ukazi:\n"
-#~ "  help    Pokae podrobnosti pomoi\n"
-#~ "  run     Ustvari nov terminalno okno z izvedenim doloenim ukazom\n"
-#~ "  shell   Ustvari nov terminalno okno z uporabniko lupino\n"
-#~ "\n"
-#~ "Uporaba \"%s UKAZ --help\" za ve podrobnosti o ukazu.\n"
-
-#~ msgid "Be quiet"
-#~ msgstr "Brez sporoanja"
-
-#~ msgid "GNOME Terminal Client"
-#~ msgstr "Terminalski odjemalec GNOME"
-
-#~ msgid "Show server options"
-#~ msgstr "Pokae monosti strenika"
-
-#~ msgctxt "title"
-#~ msgid "'Terminal'"
-#~ msgstr "'Terminal'"
-
-#~ msgid "Title for terminal"
-#~ msgstr "Naziv terminala"
-
-#~ msgid ""
-#~ "Title to display for the terminal window or tab. This title may be "
-#~ "replaced by or combined with the title set by the application inside the "
-#~ "terminal, depending on the title_mode setting."
-#~ msgstr ""
-#~ "Naziv, ki naj bo prikazan v zavihku ali oknu terminala. Naziv lahko "
-#~ "spremeni program zagnan znotraj terminala, to pa doloa klju title_mode."
-
-#~ msgid "Characters that are considered \"part of a word\""
-#~ msgstr "Znaki, ki pripadajo besedam"
-
-#~ msgid ""
-#~ "When selecting text by word, sequences of these characters are considered "
-#~ "single words. Ranges can be given as \"A-Z\". Literal hyphen (not "
-#~ "expressing a range) should be the first character given."
-#~ msgstr ""
-#~ "Kadar se izbira besedilo po besedi, se nize teh znakov obravnava kot dele "
-#~ "besede. Lahko so podani intervali v obliki \"A-Z\". Pomiljaj, ki ne "
-#~ "predstavlja intervala, mora biti prvi podani znak."
-
-#~ msgid "Whether to use custom terminal size for new windows"
-#~ msgstr "Ali naj se za nova okna uporabi privzeta velikost terminalnega okna"
-
-#~ msgid ""
-#~ "If true, newly created terminal windows will have custom size specified "
-#~ "by default_size_columns and default_size_rows."
-#~ msgstr ""
-#~ "Izbrana monost omogoa, da bo pri novo ustvarjenem terminalu privzeto "
-#~ "uporabljena velikost po meri s podatki privzete velikosti stolpcev in "
-#~ "vrstic."
-
-#~ msgid "Default size:"
-#~ msgstr "Privzeta velikost:"
-
-#~ msgid "Title"
-#~ msgstr "Naslov"
-
-#~ msgid "_Title:"
-#~ msgstr "_Naziv:"
-
-#~ msgid "Title and Command"
-#~ msgstr "Naziv in ukaz"
-
-#~ msgid "Set Title"
-#~ msgstr "Doloitev naziva okna"
-
-#~ msgid "Current Locale"
-#~ msgstr "Trenutne jezikovne nastavitve"
-
-#~ msgid "Visible only when necessary"
-#~ msgstr "Vidno po potrebi"
-
-#~ msgid "Hidden"
-#~ msgstr "Skrito"
-
-#~ msgid "_About Terminal"
-#~ msgstr "_O programu"
-
-#~ msgid "What to do with dynamic title"
-#~ msgstr "Kaj narediti z dinaminim nazivom"
-
-#~ msgid ""
-#~ "If the application in the terminal sets the title (most typically people "
-#~ "have their shell set up to do this), the dynamically-set title can erase "
-#~ "the configured title, go before it, go after it, or replace it. The "
-#~ "possible values are \"replace\", \"before\", \"after\", and \"ignore\"."
-#~ msgstr ""
-#~ "V primeru, da program nastavi naziv terminala (to je obiajna nastavitev) "
-#~ "lahko dinamino izbran naziv izbrie prej doloeno nastavitev naziva, je "
-#~ "postavljen pred njim, za njim, ali pa ga zamenja. Mone vrednosti so "
-#~ "\"replace\" (zamenjaj), \"before\" (pred), \"after\" (za) in "
-#~ "\"ignore\" (prezri)."
-
-#~ msgid "When terminal commands set their o_wn titles:"
-#~ msgstr "Ko terminalski ukazi doloajo lastne naslove:"
-
-#~ msgid "The shortcut key %s is already bound to the %s action"
-#~ msgstr "Tipkovna blinjica  %s je e povezana z dejanjem %s"
-
-#~ msgid "_Input Methods"
-#~ msgstr "_Naini vnosa"
-
-#~ msgid "Keyboard shortcut to switch to tab 1"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 1"
-
-#~ msgid "Keyboard shortcut to switch to tab 2"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 2"
-
-#~ msgid "Keyboard shortcut to switch to tab 3"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 3"
-
-#~ msgid "Keyboard shortcut to switch to tab 4"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 4"
-
-#~ msgid "Keyboard shortcut to switch to tab 5"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 5"
-
-#~ msgid "Keyboard shortcut to switch to tab 6"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 6"
-
-#~ msgid "Keyboard shortcut to switch to tab 7"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 7"
-
-#~ msgid "Keyboard shortcut to switch to tab 8"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 8"
-
-#~ msgid "Keyboard shortcut to switch to tab 9"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 9"
-
-#~ msgid "Keyboard shortcut to switch to tab 10"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 10"
-
-#~ msgid "Keyboard shortcut to switch to tab 11"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 11"
-
-#~ msgid "Keyboard shortcut to switch to tab 12"
-#~ msgstr "Tipkovna blinjica za preklop na zavihek 12"
-
-#~ msgid "Switch to Tab 3"
-#~ msgstr "Preklopi na zavihek 3"
-
-#~ msgid "Switch to Tab 4"
-#~ msgstr "Preklopi na zavihek 4"
-
-#~ msgid "Switch to Tab 5"
-#~ msgstr "Preklopi na zavihek 5"
-
-#~ msgid "Switch to Tab 6"
-#~ msgstr "Preklopi na zavihek 6"
-
-#~ msgid "Switch to Tab 7"
-#~ msgstr "Preklopi na zavihek 7"
-
-#~ msgid "Switch to Tab 8"
-#~ msgstr "Preklopi na zavihek 8"
-
-#~ msgid "Switch to Tab 9"
-#~ msgstr "Preklopi na zavihek 9"
-
-#~ msgid "Switch to Tab 10"
-#~ msgstr "Preklopi na zavihek 10"
-
-#~ msgid "Switch to Tab 11"
-#~ msgstr "Preklopi na zavihek 11"
-
-#~ msgid "Switch to Tab 12"
-#~ msgstr "Preklopi na zavihek 12"
-
-#~ msgid "Keybindings"
-#~ msgstr "Tipkovne blinjice"
-
-#~ msgid "Foreground, Background, Bold and Underline"
-#~ msgstr "Pisava, ozadje, krepko in podrtano besedilo"
-
-#~ msgid "New _Profile"
-#~ msgstr "Nov _profil ..."
-
-#~ msgid "_Profile Preferences"
-#~ msgstr "Monosti _profila ..."
+msgid "Transparent background"
+msgstr "Prosojno ozadje"
diff --git a/po/sq.po b/po/sq.po
index 158f6cb1..a3494fb7 100644
--- a/po/sq.po
+++ b/po/sq.po
@@ -225,8 +225,8 @@ msgid "<b>Background</b>"
 msgstr "<b>Sfondi</b>"
 
 #: ../src/gnome-terminal.glade2.h:3
-msgid "<b>Command</b>"
-msgstr "<b>Komanda</b>"
+msgid "Command"
+msgstr "Komanda"
 
 #: ../src/gnome-terminal.glade2.h:4
 msgid "<b>Compatibility</b>"
@@ -568,8 +568,8 @@ msgstr "Ngjyra e _tekstit:"
 
 # (pofilter) simplecaps: checks the capitalisation of two strings isn't wildly different
 #: ../src/gnome-terminal.glade2.h:85
-msgid "_Transparent background"
-msgstr "Sfond _Trasparent"
+msgid "Transparent background"
+msgstr "Sfond Trasparent"
 
 #: ../src/gnome-terminal.glade2.h:86
 msgid "_Update login records when command is launched"
diff --git a/po/sr.po b/po/sr.po
index af7e13ed..b6ff94d7 100644
--- a/po/sr.po
+++ b/po/sr.po
@@ -2780,10 +2780,9 @@ msgstr "    : %s\n"
 #~ msgid "GNOME Terminal Client"
 #~ msgstr "  "
 
-#~| msgid "Terminal"
-#~ msgctxt "title"
-#~ msgid "'Terminal'"
-#~ msgstr ""
+msgctxt "title"
+msgid "'Terminal'"
+msgstr ""
 
 #~ msgid "Title for terminal"
 #~ msgstr "  "
@@ -2829,11 +2828,11 @@ msgstr "    : %s\n"
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "_:"
+msgid "_Title:"
+msgstr "_:"
 
 #~ msgid "Title and Command"
 #~ msgstr "  "
@@ -2841,8 +2840,8 @@ msgstr "    : %s\n"
 #~ msgid "_Unlimited"
 #~ msgstr "_"
 
-#~ msgid "Set Title"
-#~ msgstr " "
+msgid "Set Title"
+msgstr " "
 
 #~ msgid "Current Locale"
 #~ msgstr " "
@@ -2852,3 +2851,6 @@ msgstr "    : %s\n"
 
 #~ msgid "Hidden"
 #~ msgstr ""
+
+msgid "Transparent background"
+msgstr " "
diff --git a/po/sr@latin.po b/po/sr@latin.po
index 45dbad07..852c47cc 100644
--- a/po/sr@latin.po
+++ b/po/sr@latin.po
@@ -2576,10 +2576,9 @@ msgstr "_Zatvori prozor"
 #~ msgid "GNOME Terminal Client"
 #~ msgstr "Klijent Gnomovog terminala"
 
-#~| msgid "Terminal"
-#~ msgctxt "title"
-#~ msgid "'Terminal'"
-#~ msgstr "Terminal"
+msgctxt "title"
+msgid "'Terminal'"
+msgstr "Terminal"
 
 #~ msgid "Title for terminal"
 #~ msgstr "Naslov za terminal"
@@ -2625,11 +2624,11 @@ msgstr "_Zatvori prozor"
 #~ msgid "Default size:"
 #~ msgstr "Osnovna veliina:"
 
-#~ msgid "Title"
-#~ msgstr "Naslov"
+msgid "Title"
+msgstr "Naslov"
 
-#~ msgid "_Title:"
-#~ msgstr "_Naslov:"
+msgid "_Title:"
+msgstr "_Naslov:"
 
 #~ msgid "Title and Command"
 #~ msgstr "Naslov i naredba"
@@ -2637,8 +2636,8 @@ msgstr "_Zatvori prozor"
 #~ msgid "_Unlimited"
 #~ msgstr "_Neogranieno"
 
-#~ msgid "Set Title"
-#~ msgstr "Postavi naslov"
+msgid "Set Title"
+msgstr "Postavi naslov"
 
 #~ msgid "Current Locale"
 #~ msgstr "Tekui lokalitet"
@@ -2648,3 +2647,6 @@ msgstr "_Zatvori prozor"
 
 #~ msgid "Hidden"
 #~ msgstr "Skriven"
+
+msgid "Transparent background"
+msgstr "Providna pozadina"
diff --git a/po/sv.po b/po/sv.po
index 74890c35..5abf9fa1 100644
--- a/po/sv.po
+++ b/po/sv.po
@@ -2800,5 +2800,17 @@ msgstr "Misslyckades med att tolka argument: %s\n"
 #~ msgid "Unknown completion request for \"%s\""
 #~ msgstr "Oknd kompletteringsbegran fr \"%s\""
 
+msgid "Transparent background"
+msgstr "Genomskinlig bakgrund"
+
 #~ msgid "Missing command"
 #~ msgstr "Kommando saknas"
+
+msgid "_Title:"
+msgstr "_Titel:"
+
+msgid "Set Title"
+msgstr "Stll in titel"
+
+msgid "_Set Title"
+msgstr "A_nge titel..."
diff --git a/po/ta.po b/po/ta.po
index 80aa2f68..afd335b0 100644
--- a/po/ta.po
+++ b/po/ta.po
@@ -2171,10 +2171,9 @@ msgstr "_l  "
 #~ msgid "Show server options"
 #~ msgstr "  "
 
-#~| msgid "Terminal"
-#~ msgctxt "title"
-#~ msgid "'Terminal'"
-#~ msgstr "''"
+msgctxt "title"
+msgid "'Terminal'"
+msgstr "''"
 
 #~ msgid "Title for terminal"
 #~ msgstr " "
@@ -2221,11 +2220,11 @@ msgstr "_l  "
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "_T :"
+msgid "_Title:"
+msgstr "_T :"
 
 #~ msgid "Title and Command"
 #~ msgstr " "
@@ -2233,8 +2232,8 @@ msgstr "_l  "
 #~ msgid "_Unlimited"
 #~ msgstr "_U  "
 
-#~ msgid "Set Title"
-#~ msgstr " "
+msgid "Set Title"
+msgstr " "
 
 #~| msgid "_Terminal"
 #~ msgid "_About Terminal"
@@ -2243,8 +2242,8 @@ msgstr "_l  "
 #~ msgid "Current Locale"
 #~ msgstr " "
 
-#~ msgid "_Set Title"
-#~ msgstr "(_S)  ..."
+msgid "_Set Title"
+msgstr "(_S)  ..."
 
 #~ msgid "_Next Tab"
 #~ msgstr "  (_N)"
@@ -3028,8 +3027,8 @@ msgstr "_l  "
 #~ msgid "_Solid color"
 #~ msgstr "(_S)  "
 
-#~ msgid "_Transparent background"
-#~ msgstr "_T  "
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid "No such profile \"%s\", using default profile\n"
 #~ msgstr "\"%s\"   ,   \n"
diff --git a/po/te.po b/po/te.po
index 82c0e0fc..0dd3d871 100644
--- a/po/te.po
+++ b/po/te.po
@@ -2055,10 +2055,9 @@ msgstr "  (_l)"
 #~ msgid "Show server options"
 #~ msgstr "  "
 
-#, fuzzy
-#~ msgctxt "title"
-#~ msgid "'Terminal'"
-#~ msgstr ""
+msgctxt "title"
+msgid "'Terminal'"
+msgstr ""
 
 #~ msgid "Title for terminal"
 #~ msgstr "  "
@@ -2104,11 +2103,11 @@ msgstr "  (_l)"
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ":"
+msgid "Title"
+msgstr ":"
 
-#~ msgid "_Title:"
-#~ msgstr " (_T):"
+msgid "_Title:"
+msgstr " (_T):"
 
 #~ msgid "Title and Command"
 #~ msgstr "  "
@@ -2116,14 +2115,14 @@ msgstr "  (_l)"
 #~ msgid "_Unlimited"
 #~ msgstr " (_U)"
 
-#~ msgid "Set Title"
-#~ msgstr " "
+msgid "Set Title"
+msgstr " "
 
 #~ msgid "Current Locale"
 #~ msgstr " "
 
-#~ msgid "_Set Title"
-#~ msgstr " ... (_S)"
+msgid "_Set Title"
+msgstr " ... (_S)"
 
 #~ msgid "_Next Tab"
 #~ msgstr " (_N)"
@@ -2898,8 +2897,8 @@ msgstr "  (_l)"
 #~ msgid "Background image _scrolls"
 #~ msgstr "  (_s)"
 
-#~ msgid "_Transparent background"
-#~ msgstr "  (_T)"
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid "S_hade transparent or image background:"
 #~ msgstr "      (_h):"
diff --git a/po/tg.po b/po/tg.po
index e3feef65..6371c036 100644
--- a/po/tg.po
+++ b/po/tg.po
@@ -2158,23 +2158,23 @@ msgstr "_ "
 #~ msgid "Default size:"
 #~ msgstr " :"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "_:"
+msgid "_Title:"
+msgstr "_:"
 
 #~ msgid "Title and Command"
 #~ msgstr "  "
 
-#~ msgid "Set Title"
-#~ msgstr "  "
+msgid "Set Title"
+msgstr "  "
 
 #~ msgid "Current Locale"
 #~ msgstr " "
 
-#~ msgid "_Set Title"
-#~ msgstr "_ ..."
+msgid "_Set Title"
+msgstr "_ ..."
 
 #~ msgid "_Next Tab"
 #~ msgstr "_ "
diff --git a/po/th.po b/po/th.po
index 63263749..496da331 100644
--- a/po/th.po
+++ b/po/th.po
@@ -2308,23 +2308,23 @@ msgstr "_"
 #~ msgid "Default size:"
 #~ msgstr ":"
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "_:"
+msgid "_Title:"
+msgstr "_:"
 
 #~ msgid "Title and Command"
 #~ msgstr ""
 
-#~ msgid "Set Title"
-#~ msgstr ""
+msgid "Set Title"
+msgstr ""
 
 #~ msgid "Current Locale"
 #~ msgstr ""
 
-#~ msgid "_Set Title"
-#~ msgstr "_"
+msgid "_Set Title"
+msgstr "_"
 
 #~ msgid "_Next Tab"
 #~ msgstr "_"
@@ -2803,8 +2803,8 @@ msgstr "_"
 #~ msgid "_Solid color"
 #~ msgstr "_"
 
-#~ msgid "_Transparent background"
-#~ msgstr "_"
+msgid "Transparent background"
+msgstr ""
 
 #~ msgid ""
 #~ "You already have a profile called %s. Do you want to create another "
diff --git a/po/tr.po b/po/tr.po
index a5024ead..95834a7e 100644
--- a/po/tr.po
+++ b/po/tr.po
@@ -2465,3 +2465,15 @@ msgstr "_Pencereyi Kapat"
 #, c-format
 msgid "Failed to parse arguments: %s\n"
 msgstr "Bamsz deikenler ayrtrlamad: %s\n"
+
+msgid "Transparent background"
+msgstr "effaf arkaplan"
+
+msgid "_Title:"
+msgstr "_Balk:"
+
+msgid "Set Title"
+msgstr "Bal Dzenle"
+
+msgid "_Set Title"
+msgstr "_Bal Ata..."
diff --git a/po/ug.po b/po/ug.po
index 313f76b9..be608976 100644
--- a/po/ug.po
+++ b/po/ug.po
@@ -2616,8 +2616,8 @@ msgstr " (_T):"
 #~ msgid "_Solid color"
 #~ msgstr " (_S)"
 
-#~ msgid "_Transparent background"
-#~ msgstr " (_T)"
+msgid "Transparent background"
+msgstr " "
 
 #~ msgid ""
 #~ "You already have a profile called %s. Do you want to create another "
diff --git a/po/uk.po b/po/uk.po
index 74140f17..6dfb6d5f 100644
--- a/po/uk.po
+++ b/po/uk.po
@@ -2481,3 +2481,18 @@ msgstr "   : %s\n"
 
 #~ msgid "Georgian"
 #~ msgstr ""
+
+msgid "Title"
+msgstr ""
+
+msgid "_Title:"
+msgstr "_:"
+
+msgid "Set Title"
+msgstr " "
+
+msgid "_Set Title"
+msgstr "_ "
+
+msgid "Transparent background"
+msgstr " "
diff --git a/po/vi.po b/po/vi.po
index 5304429b..af014ff2 100644
--- a/po/vi.po
+++ b/po/vi.po
@@ -2852,8 +2852,8 @@ msgstr "n_g ca s"
 #~ msgid "Default size:"
 #~ msgstr "C mc nh:"
 
-#~ msgid "Title"
-#~ msgstr "Ta "
+msgid "Title"
+msgstr "Ta "
 
 #~ msgid "When terminal commands set their o_wn titles:"
 #~ msgstr "Khi cu lnh thit b cui t t ta  _mnh:"
@@ -2864,8 +2864,8 @@ msgstr "n_g ca s"
 #~ msgid "_Unlimited"
 #~ msgstr "_Khng hn ch"
 
-#~ msgid "Set Title"
-#~ msgstr "t ta "
+msgid "Set Title"
+msgstr "t ta "
 
 #~ msgid "Switch to Tab 3"
 #~ msgstr "Chuyn sang Thanh 3"
@@ -2906,8 +2906,8 @@ msgstr "n_g ca s"
 #~ msgid "_Input Methods"
 #~ msgstr "K_iu g"
 
-#~ msgid "_Title:"
-#~ msgstr "_Ta :"
+msgid "_Title:"
+msgstr "_Ta :"
 
 #~ msgid "Disable connection to session manager"
 #~ msgstr "Tt kt ni n trnh qun l phin lm vic"
@@ -3292,3 +3292,6 @@ msgstr "n_g ca s"
 #~ "Phm tt  t li thit b cui. Dng dng chui c cng mt khun dng "
 #~ "vi tp tin ti nguyn GTK+. Nu bn t ty chn l chui disabled (b "
 #~ "tt), ngha l khng c phm tt cho hnh ng ny."
+
+msgid "Transparent background"
+msgstr "Nn trong sut"
diff --git a/po/wa.po b/po/wa.po
index 2a29945b..4f1c57c7 100644
--- a/po/wa.po
+++ b/po/wa.po
@@ -224,8 +224,8 @@ msgid "<b>Background</b>"
 msgstr "<b>Fond</b>"
 
 #: ../src/gnome-terminal.glade2.h:3
-msgid "<b>Command</b>"
-msgstr "<b>Comande</b>"
+msgid "Command"
+msgstr "Comande"
 
 #: ../src/gnome-terminal.glade2.h:4
 msgid "<b>Compatibility</b>"
@@ -564,8 +564,8 @@ msgid "_Text color:"
 msgstr "Coleur pol _tecse:"
 
 #: ../src/gnome-terminal.glade2.h:86
-msgid "_Transparent background"
-msgstr "Fond k'on voet _houte"
+msgid "Transparent background"
+msgstr "Fond k'on voet houte"
 
 #: ../src/gnome-terminal.glade2.h:87
 msgid "_Update login records when command is launched"
@@ -2227,8 +2227,8 @@ msgid "Change _Profile"
 msgstr "Candj _profil"
 
 #: ../src/terminal-window.c:1013
-msgid "_Set Title..."
-msgstr "_Candj l'tite..."
+msgid "_Set Title"
+msgstr "_Candj l'tite"
 
 #: ../src/terminal-window.c:1020
 msgid "Set _Character Encoding"
diff --git a/po/xh.po b/po/xh.po
index cb78ec67..a4f3b4dd 100644
--- a/po/xh.po
+++ b/po/xh.po
@@ -217,8 +217,8 @@ msgid "<b>Background</b>"
 msgstr "<b>Okungasemva</b>"
 
 #: ../src/gnome-terminal.glade2.h:2
-msgid "<b>Command</b>"
-msgstr "<b>Umyalelo</b>"
+msgid "Command"
+msgstr "Umyalelo"
 
 #: ../src/gnome-terminal.glade2.h:3
 msgid "<b>Compatibility</b>"
@@ -621,8 +621,8 @@ msgid "_Text color:"
 msgstr "_Umbala wombhalo:"
 
 #: ../src/gnome-terminal.glade2.h:102
-msgid "_Transparent background"
-msgstr "_Okungasemva okucace gca"
+msgid "Transparent background"
+msgstr "Okungasemva okucace gca"
 
 #: ../src/gnome-terminal.glade2.h:103
 msgid "_Update login records when command is launched"
@@ -2265,8 +2265,8 @@ msgid "Change _Profile"
 msgstr "Tsintsha i_Nkangeleko"
 
 #: ../src/terminal-window.c:979
-msgid "_Set Title..."
-msgstr "_Misela..."
+msgid "_Set Title"
+msgstr "_Misela"
 
 #: ../src/terminal-window.c:986
 msgid "Set _Character Encoding"
diff --git a/po/zh_CN.po b/po/zh_CN.po
index f68c7ce5..a3be00e1 100644
--- a/po/zh_CN.po
+++ b/po/zh_CN.po
@@ -2805,17 +2805,17 @@ msgstr "%s\n"
 #~ msgid "Default size:"
 #~ msgstr ""
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "(_T)"
+msgid "_Title:"
+msgstr "(_T)"
 
 #~ msgid "Title and Command"
 #~ msgstr ""
 
-#~ msgid "Set Title"
-#~ msgstr ""
+msgid "Set Title"
+msgstr ""
 
 #~ msgid "Current Locale"
 #~ msgstr ""
@@ -2928,3 +2928,6 @@ msgstr "%s\n"
 
 #~ msgid "_Find..."
 #~ msgstr "(_F)..."
+
+msgid "Transparent background"
+msgstr ""
diff --git a/po/zh_HK.po b/po/zh_HK.po
index 61153529..c366abdd 100644
--- a/po/zh_HK.po
+++ b/po/zh_HK.po
@@ -2114,17 +2114,17 @@ msgstr "(_L)"
 #~ msgid "Default size:"
 #~ msgstr ""
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "(_T):"
+msgid "_Title:"
+msgstr "(_T):"
 
 #~ msgid "Title and Command"
 #~ msgstr ""
 
-#~ msgid "Set Title"
-#~ msgstr ""
+msgid "Set Title"
+msgstr ""
 
 #~ msgid "Current Locale"
 #~ msgstr ""
@@ -2376,3 +2376,6 @@ msgstr "(_L)"
 
 #~ msgid "Show session management options"
 #~ msgstr ""
+
+msgid "Transparent background"
+msgstr ""
diff --git a/po/zh_TW.po b/po/zh_TW.po
index 80cb2343..20e2a93c 100644
--- a/po/zh_TW.po
+++ b/po/zh_TW.po
@@ -2735,17 +2735,17 @@ msgstr "(_L)"
 #~ msgid "Default size:"
 #~ msgstr ""
 
-#~ msgid "Title"
-#~ msgstr ""
+msgid "Title"
+msgstr ""
 
-#~ msgid "_Title:"
-#~ msgstr "(_T):"
+msgid "_Title:"
+msgstr "(_T):"
 
 #~ msgid "Title and Command"
 #~ msgstr ""
 
-#~ msgid "Set Title"
-#~ msgstr ""
+msgid "Set Title"
+msgstr ""
 
 #~ msgid "Current Locale"
 #~ msgstr ""
@@ -2957,3 +2957,6 @@ msgstr "(_L)"
 
 #~ msgid "Show session management options"
 #~ msgstr ""
+
+msgid "Transparent background"
+msgstr ""
-- 
2.40.0


From ffacb3f8a6e53999ced1b7e6eb7bdbf8ec0f6287 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Wed, 25 May 2016 13:47:36 +0200
Subject: [PATCH 12/16] Restore the action and shortcut to set a static title
 from the menus

This reverts 9bbe19e98f62aa3c9020913a3a5a8080a5177505 with various
minor adjustments to keep up with later changes.

https://bugzilla.redhat.com/show_bug.cgi?id=1296110
---
 src/org.gnome.Terminal.gschema.xml |  4 ++
 src/terminal-accels.cc             |  2 +
 src/terminal-window.cc             | 76 ++++++++++++++++++++++++++++++
 3 files changed, 82 insertions(+)

diff --git a/src/org.gnome.Terminal.gschema.xml b/src/org.gnome.Terminal.gschema.xml
index 9ba0f3b5..c2b97e8b 100644
--- a/src/org.gnome.Terminal.gschema.xml
+++ b/src/org.gnome.Terminal.gschema.xml
@@ -429,6 +429,10 @@
       <default>'disabled'</default>
       <summary>Keyboard shortcut to toggle the read-only state</summary>
     </key>
+    <key name="set-terminal-title" type="s">
+      <default>'disabled'</default>
+      <summary>Keyboard shortcut to set the terminal title</summary>
+    </key>
     <key name="reset" type="s">
       <default>'disabled'</default>
       <summary>Keyboard shortcut to reset the terminal</summary>
diff --git a/src/terminal-accels.cc b/src/terminal-accels.cc
index 66298100..b2b4e442 100644
--- a/src/terminal-accels.cc
+++ b/src/terminal-accels.cc
@@ -76,6 +76,7 @@
 #define KEY_RESET               "reset"
 #define KEY_SAVE_CONTENTS       "save-contents"
 #define KEY_SELECT_ALL          "select-all"
+#define KEY_SET_TERMINAL_TITLE  "set-terminal-title"
 #define KEY_TOGGLE_MENUBAR      "toggle-menubar"
 #define KEY_ZOOM_IN             "zoom-in"
 #define KEY_ZOOM_NORMAL         "zoom-normal"
@@ -165,6 +166,7 @@ static KeyEntry terminal_entries[] = {
   ENTRY (N_("Read-Only"),       KEY_READ_ONLY,          "read-only", nullptr, nullptr   ),
   ENTRY (N_("Reset"),           KEY_RESET,              "reset",     "b",  "false"),
   ENTRY (N_("Reset and Clear"), KEY_RESET_AND_CLEAR,    "reset",     "b",  "true" ),
+  ENTRY (N_("Set Title"),       KEY_SET_TERMINAL_TITLE, "set-title", nullptr, nullptr   ),
 };
 
 static KeyEntry tabs_entries[] = {
diff --git a/src/terminal-window.cc b/src/terminal-window.cc
index 61857bfe..98332c6d 100644
--- a/src/terminal-window.cc
+++ b/src/terminal-window.cc
@@ -764,6 +764,81 @@ action_select_all_cb (GSimpleAction *action,
   vte_terminal_select_all (VTE_TERMINAL (priv->active_screen));
 }
 
+static void
+terminal_set_title_dialog_response_cb (GtkWidget *dialog,
+                                       int response,
+                                       TerminalScreen *screen)
+{
+  if (response == GTK_RESPONSE_OK)
+    {
+      GtkEntry *entry;
+      const char *text;
+
+      entry = GTK_ENTRY (g_object_get_data (G_OBJECT (dialog), "title-entry"));
+      text = gtk_entry_get_text (entry);
+      terminal_screen_set_user_title (screen, text);
+    }
+
+  gtk_widget_destroy (dialog);
+}
+
+static void
+action_set_title_cb (GSimpleAction *action,
+                     GVariant *parameter,
+                     gpointer user_data)
+{
+  TerminalWindow *window = (TerminalWindow*)user_data;
+  TerminalWindowPrivate *priv = window->priv;
+  GtkWidget *dialog, *message_area, *hbox, *label, *entry;
+
+  if (priv->active_screen == nullptr)
+    return;
+
+  /* FIXME: hook the screen up so this dialogue closes if the terminal screen closes */
+
+  dialog = gtk_message_dialog_new (GTK_WINDOW (window),
+                                   GtkDialogFlags(GTK_DIALOG_MODAL |
+                                                  GTK_DIALOG_DESTROY_WITH_PARENT),
+                                   GTK_MESSAGE_OTHER,
+                                   GTK_BUTTONS_OK_CANCEL,
+                                   "%s", "");
+
+  gtk_window_set_title (GTK_WINDOW (dialog), _("Set Title"));
+  gtk_window_set_resizable (GTK_WINDOW (dialog), FALSE);
+  gtk_window_set_role (GTK_WINDOW (dialog), "gnome-terminal-change-title");
+  gtk_dialog_set_default_response (GTK_DIALOG (dialog), GTK_RESPONSE_OK);
+  /* Alternative button order was set automatically by GtkMessageDialog */
+
+  g_signal_connect (dialog, "response",
+                    G_CALLBACK (terminal_set_title_dialog_response_cb), priv->active_screen);
+  g_signal_connect (dialog, "delete-event",
+                    G_CALLBACK (terminal_util_dialog_response_on_delete), nullptr);
+
+  message_area = gtk_message_dialog_get_message_area (GTK_MESSAGE_DIALOG (dialog));
+  gtk_container_foreach (GTK_CONTAINER (message_area), (GtkCallback) gtk_widget_hide, nullptr);
+
+  hbox = gtk_box_new (GTK_ORIENTATION_HORIZONTAL, 12);
+  gtk_box_pack_start (GTK_BOX (message_area), hbox, FALSE, FALSE, 0);
+
+  label = gtk_label_new_with_mnemonic (_("_Title:"));
+  gtk_misc_set_alignment (GTK_MISC (label), 0.0, 0.5);
+  gtk_box_pack_start (GTK_BOX (hbox), label, FALSE, FALSE, 0);
+
+  entry = gtk_entry_new ();
+  gtk_entry_set_width_chars (GTK_ENTRY (entry), 32);
+  gtk_entry_set_activates_default (GTK_ENTRY (entry), TRUE);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (label), entry);
+  gtk_box_pack_start (GTK_BOX (hbox), entry, TRUE, TRUE, 0);
+  gtk_widget_show_all (hbox);
+
+  gtk_widget_grab_focus (entry);
+  gtk_entry_set_text (GTK_ENTRY (entry), terminal_screen_get_user_title (priv->active_screen));
+  gtk_editable_select_region (GTK_EDITABLE (entry), 0, -1);
+  g_object_set_data (G_OBJECT (dialog), "title-entry", entry);
+
+  gtk_window_present (GTK_WINDOW (dialog));
+}
+
 static void
 action_reset_cb (GSimpleAction *action,
                  GVariant *parameter,
@@ -2165,6 +2240,7 @@ terminal_window_init (TerminalWindow *window)
     { "paste-uris",          action_paste_uris_cb,       nullptr,   nullptr, nullptr },
     { "reset",               action_reset_cb,            "b",    nullptr, nullptr },
     { "select-all",          action_select_all_cb,       nullptr,   nullptr, nullptr },
+    { "set-title",           action_set_title_cb,        nullptr,   nullptr, nullptr },
     { "size-to",             action_size_to_cb,          "(uu)", nullptr, nullptr },
     { "tab-detach",          action_tab_detach_cb,       nullptr,   nullptr, nullptr },
     { "tab-move-left",       action_tab_move_left_cb,    nullptr,   nullptr, nullptr },
-- 
2.40.0


From 753256853ce8d9e72a7fc9ce4e6b23f937fe0be8 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Thu, 30 Jun 2016 18:14:36 +0200
Subject: [PATCH 13/16] screen: Style fix

This brings the code in line with how it was before
de0dc7c2649c42e2aa02a66e4be27d262b34452d

https://bugzilla.redhat.com/show_bug.cgi?id=1296110
---
 src/terminal-screen.cc | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 506ab66e..28088a98 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -819,7 +819,7 @@ terminal_screen_new (GSettings       *profile,
   /* If given an initial title, strip it of control characters and
    * feed it to the terminal.
    */
-  if (title != nullptr) {
+  if (title) {
     GString *seq;
     const char *p;
 
-- 
2.40.0


From e635c50b92607471cb3ce62210533838ff208f06 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Thu, 30 Jun 2016 16:58:15 +0200
Subject: [PATCH 14/16] Restore the rest of the title handling options and make
 it all work

This reverts commit f27bf0135a2d18ba22158d28bf1f8c5f6ec066c8 and makes
it use the user_title API instead of sending an escape sequence.

https://bugzilla.redhat.com/show_bug.cgi?id=1296110
---
 src/org.gnome.Terminal.gschema.xml |  12 ++
 src/preferences.ui                 |  33 +++-
 src/profile-editor.cc              |  10 ++
 src/terminal-enums.hh              |   8 +
 src/terminal-schemas.hh            |   1 +
 src/terminal-screen.cc             | 258 +++++++++++++++++++++--------
 src/terminal-screen.hh             |   8 +-
 src/terminal-window.cc             |   9 +-
 8 files changed, 264 insertions(+), 75 deletions(-)

diff --git a/src/org.gnome.Terminal.gschema.xml b/src/org.gnome.Terminal.gschema.xml
index c2b97e8b..60d2e87f 100644
--- a/src/org.gnome.Terminal.gschema.xml
+++ b/src/org.gnome.Terminal.gschema.xml
@@ -24,6 +24,13 @@
 -->
 <schemalist gettext-domain="gnome-terminal">
 
+  <enum id='org.gnome.Terminal.TitleMode'>
+    <value nick='replace' value='0'/>
+    <value nick='before' value='1'/>
+    <value nick='after' value='2'/>
+    <value nick='ignore' value='3'/>
+  </enum>
+
    <enum id='org.gnome.Terminal.NewTerminalMode'>
     <value nick='window' value='0'/>
     <value nick='tab' value='1'/>
@@ -209,6 +216,11 @@
       <summary>Whether to enable SIXEL images</summary>
       <description>If true, SIXEL sequences are parsed and images are rendered.</description>
     </key>
+    <key name="title-mode" enum="org.gnome.Terminal.TitleMode">
+      <default>'replace'</default>
+      <summary>What to do with dynamic title</summary>
+      <description>If the application in the terminal sets the title (most typically people have their shell set up to do this), the dynamically-set title can erase the configured title, go before it, go after it, or replace it. The possible values are "replace", "before", "after", and "ignore".</description>
+    </key>
     <key name="title" type="s">
       <default l10n="messages" context="title">'Terminal'</default>
       <summary>Title for terminal</summary>
diff --git a/src/preferences.ui b/src/preferences.ui
index d851bcb6..a9600d9a 100644
--- a/src/preferences.ui
+++ b/src/preferences.ui
@@ -2035,7 +2035,7 @@
                                             <property name="visible">True</property>
                                             <property name="can_focus">False</property>
                                             <property name="xalign">0</property>
-                                            <property name="label" translatable="yes">Title:</property>
+                                            <property name="label" translatable="yes">Initial _title:</property>
                                             <property name="use_underline">True</property>
                                             <property name="mnemonic_widget">title-entry</property>
                                           </object>
@@ -2055,6 +2055,37 @@
                                             <property name="left_attach">1</property>
                                           </packing>
                                         </child>
+                                        <child>
+                                          <object class="GtkLabel" id="title-mode-combobox-label">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="xalign">0</property>
+                                            <property name="label" translatable="yes">When terminal commands set their o_wn titles:</property>
+                                            <property name="use_underline">True</property>
+                                            <property name="mnemonic_widget">title-mode-combobox</property>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">1</property>
+                                            <property name="left_attach">0</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <object class="GtkComboBox" id="title-mode-combobox">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="model">model2</property>
+                                            <child>
+                                              <object class="GtkCellRendererText"/>
+                                              <attributes>
+                                                <attribute name="text">0</attribute>
+                                              </attributes>
+                                            </child>
+                                          </object>
+                                          <packing>
+                                            <property name="top_attach">1</property>
+                                            <property name="left_attach">1</property>
+                                          </packing>
+                                        </child>
                                       </object>
                                     </child>
                                   </object>
diff --git a/src/profile-editor.cc b/src/profile-editor.cc
index f7997fbf..2f756fa3 100644
--- a/src/profile-editor.cc
+++ b/src/profile-editor.cc
@@ -1422,6 +1422,16 @@ profile_prefs_load (const char *uuid, GSettings *profile)
                                "text",
                                GSettingsBindFlags(G_SETTINGS_BIND_GET |
                                                   G_SETTINGS_BIND_SET));
+  profile_prefs_settings_bind_with_mapping (profile,
+                                            TERMINAL_PROFILE_TITLE_MODE_KEY,
+                                            gtk_builder_get_object (builder,
+                                                                    "title-mode-combobox"),
+                                            "active",
+                                            GSettingsBindFlags(G_SETTINGS_BIND_GET |
+                                                               G_SETTINGS_BIND_SET),
+                                            (GSettingsBindGetMapping) string_to_enum,
+                                            (GSettingsBindSetMapping) enum_to_string,
+                                            terminal_title_mode_get_type, nullptr);
   profile_prefs_settings_bind (profile, TERMINAL_PROFILE_USE_CUSTOM_COMMAND_KEY,
                                gtk_builder_get_object (builder,
                                                        "use-custom-command-checkbutton"),
diff --git a/src/terminal-enums.hh b/src/terminal-enums.hh
index 93f1460c..5e816f71 100644
--- a/src/terminal-enums.hh
+++ b/src/terminal-enums.hh
@@ -34,6 +34,14 @@ typedef enum {
   TERMINAL_NEW_TAB_POSITION_NEXT
 } TerminalNewTabPosition;
 
+typedef enum
+{
+  TERMINAL_TITLE_REPLACE,
+  TERMINAL_TITLE_BEFORE,
+  TERMINAL_TITLE_AFTER,
+  TERMINAL_TITLE_IGNORE
+} TerminalTitleMode;
+
 typedef enum
 {
   TERMINAL_EXIT_CLOSE,
diff --git a/src/terminal-schemas.hh b/src/terminal-schemas.hh
index d0f111a0..1c67e55d 100644
--- a/src/terminal-schemas.hh
+++ b/src/terminal-schemas.hh
@@ -71,6 +71,7 @@ G_BEGIN_DECLS
 #define TERMINAL_PROFILE_SCROLL_ON_KEYSTROKE_KEY        "scroll-on-keystroke"
 #define TERMINAL_PROFILE_SCROLL_ON_OUTPUT_KEY           "scroll-on-output"
 #define TERMINAL_PROFILE_TEXT_BLINK_MODE_KEY            "text-blink-mode"
+#define TERMINAL_PROFILE_TITLE_MODE_KEY                 "title-mode"
 #define TERMINAL_PROFILE_TITLE_KEY                      "title"
 #define TERMINAL_PROFILE_USE_CUSTOM_COMMAND_KEY         "use-custom-command"
 #define TERMINAL_PROFILE_USE_SKEY_KEY                   "use-skey"
diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 28088a98..5456839a 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -115,8 +115,11 @@ struct _TerminalScreenPrivate
   ExecData *exec_data;
 
   gboolean between_preexec_and_precmd;
+  gboolean user_title; /* title was manually set */
   char *current_cmdline;
-  char *title;
+  char *raw_title;
+  char *cooked_title;
+  char *override_title;
   guint contents_changed_source_id;
   guint shell_preexec_source_id;
 };
@@ -133,8 +136,7 @@ enum
 enum {
   PROP_0,
   PROP_PROFILE,
-  PROP_TITLE,
-  PROP_DESCRIPTION
+  PROP_TITLE
 };
 
 enum
@@ -184,8 +186,13 @@ static void terminal_screen_window_title_changed      (VteTerminal *vte_terminal
 
 static void update_color_scheme                      (TerminalScreen *screen);
 
+static gboolean terminal_screen_format_title (TerminalScreen *screen, const char *raw_title, char **old_cooked_title);
+
+static void terminal_screen_cook_title      (TerminalScreen *screen);
+
 static char* terminal_screen_check_hyperlink   (TerminalScreen            *screen,
                                                 GdkEvent                  *event);
+
 static void terminal_screen_check_extra (TerminalScreen *screen,
                                          GdkEvent       *event,
                                          char           **number_info,
@@ -547,6 +554,9 @@ terminal_screen_init (TerminalScreen *screen)
   gtk_target_table_free (targets, n_targets);
   gtk_target_list_unref (target_list);
 
+  priv->override_title = nullptr;
+  priv->user_title = FALSE;
+
   g_signal_connect (screen, "window-title-changed",
                     G_CALLBACK (terminal_screen_window_title_changed),
                     screen);
@@ -573,9 +583,6 @@ terminal_screen_get_property (GObject *object,
       case PROP_TITLE:
         g_value_set_string (value, terminal_screen_get_title (screen));
         break;
-      case PROP_DESCRIPTION:
-        g_value_take_string (value, terminal_screen_get_description (screen));
-        break;
       default:
         G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
         break;
@@ -596,7 +603,6 @@ terminal_screen_set_property (GObject *object,
         terminal_screen_set_profile (screen, (GSettings*)g_value_get_object (value));
         break;
       case PROP_TITLE:
-      case PROP_DESCRIPTION:
         /* not writable */
       default:
         G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
@@ -692,14 +698,6 @@ terminal_screen_class_init (TerminalScreenClass *klass)
 				      G_PARAM_STATIC_NICK |
 				      G_PARAM_STATIC_BLURB)));
 
-  g_object_class_install_property
-    (object_class,
-     PROP_DESCRIPTION,
-     g_param_spec_string ("description", nullptr, nullptr,
-                          nullptr,
-                          GParamFlags(G_PARAM_READABLE |
-                                      G_PARAM_STATIC_STRINGS)));
-
   g_type_class_add_private (object_class, sizeof (TerminalScreenPrivate));
 
   n_url_regexes = G_N_ELEMENTS (url_regex_patterns);
@@ -796,7 +794,9 @@ terminal_screen_finalize (GObject *object)
 
   g_free (priv->uuid);
   g_free (priv->current_cmdline);
-  g_free (priv->title);
+  g_free (priv->raw_title);
+  g_free (priv->cooked_title);
+  g_free (priv->override_title);
 
   G_OBJECT_CLASS (terminal_screen_parent_class)->finalize (object);
 }
@@ -816,28 +816,8 @@ terminal_screen_new (GSettings       *profile,
                          g_settings_get_int (profile, TERMINAL_PROFILE_DEFAULT_SIZE_COLUMNS_KEY),
                          g_settings_get_int (profile, TERMINAL_PROFILE_DEFAULT_SIZE_ROWS_KEY));
 
-  /* If given an initial title, strip it of control characters and
-   * feed it to the terminal.
-   */
-  if (title) {
-    GString *seq;
-    const char *p;
-
-    seq = g_string_new ("\033]0;");
-    for (p = title; *p; p = g_utf8_next_char (p)) {
-      gunichar c = g_utf8_get_char (p);
-      if (c < 0x20 || (c >= 0x7f && c <= 0x9f))
-        continue;
-      else if (c == ';')
-        break;
-
-      g_string_append_unichar (seq, c);
-    }
-    g_string_append (seq, "\033\\");
-
-    vte_terminal_feed (VTE_TERMINAL (screen), seq->str, seq->len);
-    g_string_free (seq, TRUE);
-  }
+  if (title)
+    terminal_screen_set_override_title (screen, title);
 
   vte_terminal_set_font_scale (VTE_TERMINAL (screen), zoom);
   terminal_screen_set_font (screen);
@@ -1049,28 +1029,139 @@ terminal_screen_exec (TerminalScreen *screen,
   return TRUE;
 }
 
+const char*
+terminal_screen_get_raw_title (TerminalScreen *screen)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+
+  if (priv->raw_title)
+    return priv->raw_title;
+
+  return "";
+}
+
 const char*
 terminal_screen_get_title (TerminalScreen *screen)
 {
-  return vte_terminal_get_window_title (VTE_TERMINAL (screen));
+  TerminalScreenPrivate *priv = screen->priv;
+
+  if (priv->cooked_title == nullptr)
+    terminal_screen_cook_title (screen);
+
+  /* cooked_title may still be nullptr */
+  if (priv->cooked_title != nullptr)
+    return priv->cooked_title;
+  else
+    return "";
 }
 
-char *
-terminal_screen_get_description (TerminalScreen *screen)
+/* Supported format specifiers:
+ * %S = static title
+ * %D = dynamic title
+ * %A = dynamic title, falling back to static title if empty
+ * %- = separator, if not at start or end of string (excluding whitespace)
+ */
+static const char *
+terminal_screen_get_title_format (TerminalScreen *screen)
 {
   TerminalScreenPrivate *priv = screen->priv;
-  gs_free char *title_string = nullptr;
-  const char *title;
+  static const char *formats[] = {
+    "%A"      /* TERMINAL_TITLE_REPLACE */,
+    "%D%-%S"  /* TERMINAL_TITLE_BEFORE  */,
+    "%S%-%D"  /* TERMINAL_TITLE_AFTER   */,
+    "%S"      /* TERMINAL_TITLE_IGNORE  */
+  };
+
+  return formats[g_settings_get_enum (priv->profile, TERMINAL_PROFILE_TITLE_MODE_KEY)];
+}
+
+/**
+ * terminal_screen_format_title::
+ * @screen:
+ * @raw_title: main ingredient
+ * @titleptr <inout>: pointer of the current title string
+ *
+ * Format title according @format, and stores it in <literal>*titleptr</literal>.
+ * Always ensures that *titleptr will be non-nullptr.
+ *
+ * Returns: %TRUE iff the title changed
+ */
+static gboolean
+terminal_screen_format_title (TerminalScreen *screen,
+                              const char *raw_title,
+                              char **titleptr)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+  gs_free char *static_title_string = nullptr;
+  const char *format, *arg;
+  const char *static_title = nullptr;
+  GString *title;
+  gboolean add_sep = FALSE;
+
+  g_assert (titleptr);
 
   /* use --title argument if one was supplied, otherwise ask the profile */
-  if (priv->title)
-    title = priv->title;
+  if (priv->override_title)
+    static_title = priv->override_title;
   else
-    title = title_string = g_settings_get_string (priv->profile, TERMINAL_PROFILE_TITLE_KEY);
+    static_title = static_title_string = g_settings_get_string (priv->profile, TERMINAL_PROFILE_TITLE_KEY);
+
+  title = g_string_sized_new (128);
+
+  format = terminal_screen_get_title_format (screen);
+  for (arg = format; *arg; arg += 2)
+    {
+      const char *text_to_append = nullptr;
+
+      g_assert (arg[0] == '%');
 
-  return g_strdup_printf ("%s  %d",
-                          title && title[0] ? title : _("Terminal"),
-                          screen->priv->child_pid);
+      switch (arg[1])
+        {
+          case 'A':
+            text_to_append = raw_title ? raw_title : static_title;
+            break;
+          case 'D':
+            text_to_append = raw_title;
+            break;
+          case 'S':
+            text_to_append = static_title;
+            break;
+          case '-':
+            text_to_append = nullptr;
+            add_sep = TRUE;
+            break;
+          default:
+            g_assert_not_reached ();
+        }
+
+      if (!text_to_append || !text_to_append[0])
+        continue;
+
+      if (add_sep && title->len > 0)
+        g_string_append (title, "  ");
+
+      g_string_append (title, text_to_append);
+      add_sep = FALSE;
+    }
+
+  if (*titleptr == nullptr || strcmp (title->str, *titleptr) != 0)
+    {
+      g_free (*titleptr);
+      *titleptr = g_string_free (title, FALSE);
+      return TRUE;
+    }
+
+  g_string_free (title, TRUE);
+  return FALSE;
+}
+
+static void
+terminal_screen_cook_title (TerminalScreen *screen)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+
+  if (terminal_screen_format_title (screen, priv->raw_title, &priv->cooked_title))
+    g_object_notify (G_OBJECT (screen), "title");
 }
 
 static void
@@ -1113,9 +1204,10 @@ terminal_screen_profile_changed_cb (GSettings     *profile,
     }
 
   if (!prop_name ||
+      prop_name == I_(TERMINAL_PROFILE_TITLE_MODE_KEY) ||
       prop_name == I_(TERMINAL_PROFILE_TITLE_KEY))
     {
-      g_object_notify (object, "description");
+      terminal_screen_cook_title (screen);
     }
 
   if (gtk_widget_get_realized (GTK_WIDGET (screen)) &&
@@ -1407,7 +1499,6 @@ terminal_screen_set_profile (TerminalScreen *screen,
     g_object_unref (old_profile);
 
   g_object_notify (G_OBJECT (screen), "profile");
-  g_object_notify (G_OBJECT (screen), "description");
 }
 
 GSettings*
@@ -1698,8 +1789,6 @@ spawn_result_cb (VteTerminal *terminal,
 
   priv->child_pid = pid;
 
-  g_object_notify (G_OBJECT (screen), "description");
-
   if (error) {
      // FIXMEchpe should be unnecessary, vte already does this internally
     vte_terminal_set_pty (terminal, nullptr);
@@ -1991,33 +2080,45 @@ terminal_screen_focus_in (GtkWidget     *widget,
   return GTK_WIDGET_CLASS (terminal_screen_parent_class)->focus_in_event (widget, event);
 }
 
-void
-terminal_screen_set_user_title (TerminalScreen *screen,
-                                const char     *title)
+static void
+terminal_screen_set_dynamic_title (TerminalScreen *screen,
+                                   const char     *title,
+				   gboolean	  userset)
 {
   TerminalScreenPrivate *priv = screen->priv;
 
-  g_return_if_fail (TERMINAL_IS_SCREEN (screen));
+  g_assert (TERMINAL_IS_SCREEN (screen));
 
-  if (g_strcmp0 (priv->title, title) == 0)
+  if ((priv->user_title && !userset) ||
+      (priv->raw_title && title &&
+       strcmp (priv->raw_title, title) == 0))
     return;
 
-  g_free (priv->title);
-  priv->title = title && title[0] ? g_strdup (title) : nullptr;
+  g_free (priv->raw_title);
+  priv->raw_title = g_strdup (title);
+  terminal_screen_cook_title (screen);
+}
+
+void
+terminal_screen_set_override_title (TerminalScreen *screen,
+                                    const char     *title)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+  char *old_title;
+
+  old_title = priv->override_title;
+  priv->override_title = g_strdup (title);
+  g_free (old_title);
 
-  g_object_notify (G_OBJECT (screen), "description");
+  terminal_screen_set_dynamic_title (screen, title, FALSE);
 }
 
 const char*
-terminal_screen_get_user_title (TerminalScreen *screen)
+terminal_screen_get_dynamic_title (TerminalScreen *screen)
 {
-  TerminalScreenPrivate *priv;
-
   g_return_val_if_fail (TERMINAL_IS_SCREEN (screen), nullptr);
 
-  priv = screen->priv;
-
-  return priv->title ? priv->title : _("Terminal");
+  return screen->priv->raw_title;
 }
 
 /**
@@ -2050,7 +2151,9 @@ static void
 terminal_screen_window_title_changed (VteTerminal *vte_terminal,
                                       TerminalScreen *screen)
 {
-  g_object_notify (G_OBJECT (screen), "title");
+  terminal_screen_set_dynamic_title (screen,
+                                     vte_terminal_get_window_title (vte_terminal),
+				     FALSE);
 }
 
 static void
@@ -2073,8 +2176,6 @@ terminal_screen_child_exited (VteTerminal *terminal,
 
   priv->child_pid = -1;
 
-  g_object_notify (G_OBJECT (screen), "description");
-
   action = TerminalExitAction(g_settings_get_enum (priv->profile, TERMINAL_PROFILE_EXIT_ACTION_KEY));
 
   switch (action)
@@ -2118,6 +2219,23 @@ terminal_screen_child_exited (VteTerminal *terminal,
     }
 }
 
+void
+terminal_screen_set_user_title (TerminalScreen *screen,
+                                const char *text)
+{
+  TerminalScreenPrivate *priv = screen->priv;
+
+  /* The user set the title to nothing, let's understand that as a
+     request to revert to dynamically setting the title again. */
+  if (!text || !text[0])
+    priv->user_title = FALSE;
+  else
+    {
+      priv->user_title = TRUE;
+      terminal_screen_set_dynamic_title (screen, text, TRUE);
+    }
+}
+
 static gboolean
 terminal_screen_contents_changed_cb (TerminalScreen *screen)
 {
diff --git a/src/terminal-screen.hh b/src/terminal-screen.hh
index f4ec9047..feeab852 100644
--- a/src/terminal-screen.hh
+++ b/src/terminal-screen.hh
@@ -113,13 +113,17 @@ void terminal_screen_set_profile (TerminalScreen *screen,
 GSettings* terminal_screen_get_profile (TerminalScreen *screen);
 GSettings* terminal_screen_ref_profile (TerminalScreen *screen);
 
-const char *terminal_screen_get_user_title     (TerminalScreen *screen);
+const char* terminal_screen_get_raw_title      (TerminalScreen *screen);
 const char* terminal_screen_get_title          (TerminalScreen *screen);
-char *      terminal_screen_get_description    (TerminalScreen *screen);
 
 void terminal_screen_set_user_title (TerminalScreen *screen,
                                      const char *text);
 
+void        terminal_screen_set_override_title     (TerminalScreen *screen,
+                                                    const char     *title);
+
+const char *terminal_screen_get_dynamic_title      (TerminalScreen *screen);
+
 char *terminal_screen_get_current_dir (TerminalScreen *screen);
 
 void       terminal_screen_get_size (TerminalScreen *screen,
diff --git a/src/terminal-window.cc b/src/terminal-window.cc
index 98332c6d..389d4d71 100644
--- a/src/terminal-window.cc
+++ b/src/terminal-window.cc
@@ -782,6 +782,12 @@ terminal_set_title_dialog_response_cb (GtkWidget *dialog,
   gtk_widget_destroy (dialog);
 }
 
+static const char *
+terminal_screen_get_user_title (TerminalScreen *screen)
+{
+  return terminal_screen_get_raw_title (screen);
+}
+
 static void
 action_set_title_cb (GSimpleAction *action,
                      GVariant *parameter,
@@ -2628,8 +2634,7 @@ sync_screen_title (TerminalScreen *screen,
     return;
 
   title = terminal_screen_get_title (screen);
-  gtk_window_set_title (GTK_WINDOW (window),
-                        title && title[0] ? title : _("Terminal"));
+  gtk_window_set_title (GTK_WINDOW (window), title);
 }
 
 static void
-- 
2.40.0


From 0b6eababdab6f530e4e500db6f1e87d39639c25f Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Wed, 3 Apr 2019 15:38:09 +0200
Subject: [PATCH 15/16] Update the title with the current foreground process

Some changes by:
  Bill Nottingham <notting@splat.cc>
  Ting-Wei Lan <lantw44@gmail.com>

https://bugzilla.gnome.org/show_bug.cgi?id=711060
---
 src/org.gnome.Terminal.gschema.xml |  5 ++++
 src/terminal-schemas.hh            |  1 +
 src/terminal-screen.cc             | 45 +++++++++++++++++++++++++++++-
 3 files changed, 50 insertions(+), 1 deletion(-)

diff --git a/src/org.gnome.Terminal.gschema.xml b/src/org.gnome.Terminal.gschema.xml
index 60d2e87f..f048c9c5 100644
--- a/src/org.gnome.Terminal.gschema.xml
+++ b/src/org.gnome.Terminal.gschema.xml
@@ -275,6 +275,11 @@
       <summary>Whether to scroll to the bottom when theres new output</summary>
       <description>If true, whenever theres new output the terminal will scroll to the bottom.</description>
     </key>
+    <key name="show-foreground-process-in-title" type="b">
+      <default>true</default>
+      <summary>Whether to show the current foreground process in the title</summary>
+      <description>If true, the current foreground process will be shown in the window and tab titles.</description>
+    </key>
     <key name="exit-action" enum="org.gnome.Terminal.ExitAction">
       <default>'close'</default>
       <summary>What to do with the terminal when the child command exits</summary>
diff --git a/src/terminal-schemas.hh b/src/terminal-schemas.hh
index 1c67e55d..443ebae4 100644
--- a/src/terminal-schemas.hh
+++ b/src/terminal-schemas.hh
@@ -70,6 +70,7 @@ G_BEGIN_DECLS
 #define TERMINAL_PROFILE_SCROLLBAR_POLICY_KEY           "scrollbar-policy"
 #define TERMINAL_PROFILE_SCROLL_ON_KEYSTROKE_KEY        "scroll-on-keystroke"
 #define TERMINAL_PROFILE_SCROLL_ON_OUTPUT_KEY           "scroll-on-output"
+#define TERMINAL_PROFILE_SHOW_FOREGROUND_PROCESS_IN_TITLE "show-foreground-process-in-title"
 #define TERMINAL_PROFILE_TEXT_BLINK_MODE_KEY            "text-blink-mode"
 #define TERMINAL_PROFILE_TITLE_MODE_KEY                 "title-mode"
 #define TERMINAL_PROFILE_TITLE_KEY                      "title"
diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 5456839a..177431d0 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -114,7 +114,9 @@ struct _TerminalScreenPrivate
   guint idle_exec_source;
   ExecData *exec_data;
 
+  gboolean application_title; /* title was set by an application */
   gboolean between_preexec_and_precmd;
+  gboolean show_foreground_process;
   gboolean user_title; /* title was manually set */
   char *current_cmdline;
   char *raw_title;
@@ -1144,6 +1146,26 @@ terminal_screen_format_title (TerminalScreen *screen,
       add_sep = FALSE;
     }
 
+  if (priv->show_foreground_process &&
+      !priv->application_title &&
+      !priv->user_title &&
+      priv->current_cmdline != nullptr &&
+      priv->current_cmdline[0] != '\0')
+    {
+      gs_free char *current_cmdline_truncated = nullptr;
+      gs_free char *current_cmdline_valid = nullptr;
+      glong len_truncated;
+      glong len_valid;
+
+      current_cmdline_valid = g_utf8_make_valid (priv->current_cmdline, -1);
+      len_valid = g_utf8_strlen (current_cmdline_valid, -1);
+
+      len_truncated = len_valid > 1024 ? 1024 : len_valid;
+      current_cmdline_truncated = g_utf8_substring (current_cmdline_valid, 0, len_truncated);
+
+      g_string_append_printf (title, "  %s", current_cmdline_truncated);
+    }
+
   if (*titleptr == nullptr || strcmp (title->str, *titleptr) != 0)
     {
       g_free (*titleptr);
@@ -1173,6 +1195,7 @@ terminal_screen_profile_changed_cb (GSettings     *profile,
   GObject *object = G_OBJECT (screen);
   VteTerminal *vte_terminal = VTE_TERMINAL (screen);
   TerminalWindow *window;
+  gboolean cook_title = FALSE;
 
   g_object_freeze_notify (object);
 
@@ -1207,7 +1230,7 @@ terminal_screen_profile_changed_cb (GSettings     *profile,
       prop_name == I_(TERMINAL_PROFILE_TITLE_MODE_KEY) ||
       prop_name == I_(TERMINAL_PROFILE_TITLE_KEY))
     {
-      terminal_screen_cook_title (screen);
+      cook_title = TRUE;
     }
 
   if (gtk_widget_get_realized (GTK_WIDGET (screen)) &&
@@ -1235,6 +1258,13 @@ terminal_screen_profile_changed_cb (GSettings     *profile,
       prop_name == I_(TERMINAL_PROFILE_BACKGROUND_TRANSPARENCY_PERCENT))
     update_color_scheme (screen);
 
+  if (!prop_name || prop_name == I_(TERMINAL_PROFILE_SHOW_FOREGROUND_PROCESS_IN_TITLE))
+    {
+      priv->show_foreground_process = g_settings_get_boolean (profile,
+                                                              TERMINAL_PROFILE_SHOW_FOREGROUND_PROCESS_IN_TITLE);
+      cook_title = TRUE;
+    }
+
   if (!prop_name || prop_name == I_(TERMINAL_PROFILE_AUDIBLE_BELL_KEY))
       vte_terminal_set_audible_bell (vte_terminal, g_settings_get_boolean (profile, TERMINAL_PROFILE_AUDIBLE_BELL_KEY));
 
@@ -1299,6 +1329,9 @@ terminal_screen_profile_changed_cb (GSettings     *profile,
       vte_terminal_set_word_char_exceptions (vte_terminal, word_char_exceptions);
     }
 
+  if (cook_title)
+    terminal_screen_cook_title (screen);
+
   g_object_thaw_notify (object);
 }
 
@@ -2151,6 +2184,9 @@ static void
 terminal_screen_window_title_changed (VteTerminal *vte_terminal,
                                       TerminalScreen *screen)
 {
+  TerminalScreenPrivate *priv = screen->priv;
+
+  priv->application_title = priv->between_preexec_and_precmd;
   terminal_screen_set_dynamic_title (screen,
                                      vte_terminal_get_window_title (vte_terminal),
 				     FALSE);
@@ -2258,6 +2294,8 @@ terminal_screen_contents_changed_cb (TerminalScreen *screen)
   cmdline = nullptr;
   _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Current foreground command-line: %s\n", priv->current_cmdline);
 
+  terminal_screen_cook_title (screen);
+
  out:
   priv->contents_changed_source_id = 0;
   return G_SOURCE_REMOVE;
@@ -2350,6 +2388,7 @@ terminal_screen_shell_precmd (VteTerminal *terminal)
 
   _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Shell precmd\n");
 
+  priv->application_title = FALSE;
   priv->between_preexec_and_precmd = FALSE;
 
   if (priv->contents_changed_source_id != 0)
@@ -2369,6 +2408,8 @@ terminal_screen_shell_precmd (VteTerminal *terminal)
 
   g_clear_pointer (&priv->current_cmdline, g_free);
   _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Current foreground command-line: (none)\n");
+
+  terminal_screen_cook_title (screen);
 }
 
 static gboolean
@@ -2390,6 +2431,8 @@ terminal_screen_shell_preexec_cb (TerminalScreen *screen)
   cmdline = nullptr;
   _terminal_debug_print (TERMINAL_DEBUG_SHELL_COMMAND, "Current foreground command-line: %s\n", priv->current_cmdline);
 
+  terminal_screen_cook_title (screen);
+
   priv->shell_preexec_source_id = 0;
   retval = G_SOURCE_REMOVE;
 
-- 
2.40.0


From a9ad18506922e20f8e4d705bbffff14b926297c7 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Thu, 27 Feb 2020 19:32:08 +0100
Subject: [PATCH 16/16] screen, window: Preserve current toolbox, if any

This relies on toolbox(1) emitting a terminal escape sequence that
advertises the name of the current toolbox container.

https://gitlab.freedesktop.org/terminal-wg/specifications/issues/17
---
 src/terminal-screen.cc | 33 ++++++++++++++++++++++++++++++++-
 src/terminal-screen.hh |  6 ++++++
 src/terminal-window.cc | 26 ++++++++++++++++++++++++--
 3 files changed, 62 insertions(+), 3 deletions(-)

diff --git a/src/terminal-screen.cc b/src/terminal-screen.cc
index 177431d0..3ce7fc05 100644
--- a/src/terminal-screen.cc
+++ b/src/terminal-screen.cc
@@ -862,6 +862,25 @@ terminal_screen_reexec_from_screen (TerminalScreen *screen,
                                     TerminalScreen *parent_screen,
                                     GCancellable *cancellable,
                                     GError **error)
+{
+  _terminal_debug_print (TERMINAL_DEBUG_PROCESSES,
+                         "[screen %p] reexec_from_screen: parent:%p\n",
+                         screen,
+                         parent_screen);
+
+  return terminal_screen_reexec_from_screen_with_override_command (screen,
+                                                                   parent_screen,
+                                                                   nullptr,
+                                                                   cancellable,
+                                                                   error);
+}
+
+gboolean
+terminal_screen_reexec_from_screen_with_override_command (TerminalScreen *screen,
+                                                          TerminalScreen *parent_screen,
+                                                          char **override_command,
+                                                          GCancellable *cancellable,
+                                                          GError **error)
 {
   g_return_val_if_fail (TERMINAL_IS_SCREEN (screen), FALSE);
 
@@ -873,8 +892,20 @@ terminal_screen_reexec_from_screen (TerminalScreen *screen,
   terminal_unref_exec_data ExecData* data = exec_data_clone (parent_screen->priv->exec_data, FALSE);
   gs_free char* cwd = terminal_screen_get_current_dir (parent_screen);
 
+  if (override_command != nullptr)
+    {
+      g_return_val_if_fail (parent_screen->priv->exec_data != nullptr, FALSE);
+      g_return_val_if_fail (data != nullptr, FALSE);
+
+      g_strfreev (data->argv);
+      data->argv = g_strdupv (override_command);
+
+      g_free (data->cwd);
+      data->cwd = g_strdup (cwd);
+    }
+
   _terminal_debug_print (TERMINAL_DEBUG_PROCESSES,
-                         "[screen %p] reexec_from_screen: parent:%p cwd:%s\n",
+                         "[screen %p] reexec_from_screen_with_override_command: parent:%p cwd:%s\n",
                          screen,
                          parent_screen,
                          cwd);
diff --git a/src/terminal-screen.hh b/src/terminal-screen.hh
index feeab852..b5ab7908 100644
--- a/src/terminal-screen.hh
+++ b/src/terminal-screen.hh
@@ -108,6 +108,12 @@ gboolean terminal_screen_reexec_from_screen (TerminalScreen *screen,
                                              GCancellable *cancellable,
                                              GError **error);
 
+gboolean terminal_screen_reexec_from_screen_with_override_command (TerminalScreen *screen,
+                                                                   TerminalScreen *parent_screen,
+                                                                   char **override_command,
+                                                                   GCancellable *cancellable,
+                                                                   GError **error);
+
 void terminal_screen_set_profile (TerminalScreen *screen,
                                   GSettings      *profile);
 GSettings* terminal_screen_get_profile (TerminalScreen *screen);
diff --git a/src/terminal-window.cc b/src/terminal-window.cc
index 389d4d71..d69cf1f0 100644
--- a/src/terminal-window.cc
+++ b/src/terminal-window.cc
@@ -417,8 +417,30 @@ action_new_terminal_cb (GSimpleAction *action,
   terminal_window_switch_screen (window, screen);
   gtk_widget_grab_focus (GTK_WIDGET (screen));
 
-  /* Start child process, if possible by using the same args as the parent screen */
-  terminal_screen_reexec_from_screen (screen, parent_screen, nullptr, nullptr);
+  const char *container_name = vte_terminal_get_current_container_name (VTE_TERMINAL (parent_screen));
+  const char *container_runtime = vte_terminal_get_current_container_runtime (VTE_TERMINAL (parent_screen));
+  if (g_strcmp0 (container_runtime, "toolbox") == 0 && container_name != nullptr && container_name[0] != '\0')
+    {
+      gs_free_error GError *error = nullptr;
+      gs_free char *override_command_str = nullptr;
+      gs_strfreev char **override_command = nullptr;
+
+      override_command_str = g_strdup_printf ("toolbox enter --container %s", container_name);
+      if (!g_shell_parse_argv (override_command_str, nullptr, &override_command, &error))
+        g_printerr ("Failed to parse '%s': %s\n", override_command_str, error->message);
+
+      /* Start child process, if possible by using the same args as the parent screen */
+      terminal_screen_reexec_from_screen_with_override_command (screen,
+                                                                parent_screen,
+                                                                override_command,
+                                                                nullptr,
+                                                                nullptr);
+    }
+  else
+    {
+      /* Start child process, if possible by using the same args as the parent screen */
+      terminal_screen_reexec_from_screen (screen, parent_screen, nullptr, nullptr);
+    }
 
   if (mode == TERMINAL_NEW_TERMINAL_MODE_WINDOW)
     gtk_window_present (GTK_WINDOW (window));
-- 
2.40.0


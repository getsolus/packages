# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: python-typer
version: 0.17.3
release: 1
source:
    - https://files.pythonhosted.org/packages/source/t/typer/typer-0.16.1.tar.gz: d358c65a464a7a90f338e3bb7ff0c74ac081449e53884b12ba658cbd72990614
homepage: https://pypi.org/project/typer
license: MIT
component: programming.python
summary: Build great CLIs
description: |
    Typer is a library for building CLI applications that users will love using and developers will love creating. Based on Python type hints.
builddeps:
    - python-build
    - python-installer
    - python-pdm-backend
    - python-setuptools
checkdeps:
    - python-click
    - python-pytest
    - python-rich
    - python-shellingham
    - python-typing-extensions
rundeps:
    - python-click
    - python-rich
    - python-shellingham
    - python-typing-extensions
build: |
    %python3_setup
install: |
    %python3_install

    # /usr/bin/typer conflicts with the erlang
    # package, so rename the binary here.
    mv $installdir/usr/bin/typer $installdir/usr/bin/python-typer
check: |
    # See scripts/test.sh. We do not run the linters (scripts/lint.sh, i.e.,
    # mypy/black/isort).
    export TERMINAL_WIDTH=3000
    export _TYPER_FORCE_DISABLE_TERMINAL=1
    export _TYPER_RUN_INSTALL_COMPLETION_TESTS=1

    # These cannot find the typer package because the tests override PYTHONPATH.
    ignore="${ignore-} --ignore=tests/test_tutorial/test_subcommands/test_tutorial001.py"
    ignore="${ignore-} --ignore=tests/test_tutorial/test_subcommands/test_tutorial003.py"

    mkdir _stub
    cat > _stub/coverage.py <<'EOF'
    from subprocess import run
    from sys import argv, executable, exit
    if len(argv) < 3 or argv[1] != "run":
        exit(f"Unsupported arguments: {argv!r}")
    exit(run([executable] + argv[2:]).returncode)
    EOF
    export PYTHONPATH="${PWD}/_stub:$installdir/usr/lib/python%python3_version%/site-packages"

    %python3_test pytest -k "${k-}" ${ignore} -v -rs

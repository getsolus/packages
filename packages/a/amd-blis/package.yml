# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : amd-blis
version    : '5.2'
release    : 1
source     :
    - https://github.com/amd/blis/archive/refs/tags/5.2.tar.gz : c553bd543eedc87920df9b82634ae4c02662145ed737f51fdf4c9bca5e588028
homepage   : https://github.com/amd/blis
license    :
    - BSD-3-Clause
    - MIT
component  : programming.library
summary    : AMD's optimized version of BLAS targeted for AMD EPYC and Ryzen CPUs.
description: |
    AOCL-BLAS is AMD's optimized version of BLAS targeted for AMD EPYC and Ryzen CPUs. It is developed as a forked version of BLIS (https://github.com/flame/blis), which is developed by members of the Science of High-Performance Computing (SHPC) group in the Institute for Computational Engineering and Sciences at The University of Texas at Austin and other collaborators (including AMD). All known features and functionalities of BLIS are retained and supported in AOCL-BLAS library. AOCL-BLAS is regularly updated with the improvements from the upstream repository.

    AOCL BLAS is optimized with SSE2, AVX2, AVX512 instruction sets which would be enabled based on the target Zen architecture using the dynamic dispatch feature. All prominent Level 3, Level 2 and Level 1 APIs are designed and optimized for specific paths targeting different size spectrums e.g., Small, Medium and Large sizes. These algorithms are designed and customized to exploit the architectural improvements of the target platform.
environment: |
    # Decontaminate because they likely have their own flags configurations
    unset CFLAGS CXXFLAGS FFLAGS FCFLAGS LDFLAGS
setup      : |
    %patch -p1 -i $pkgfiles/0001-Respect-GNUInstallDirs-when-installing.patch

    # TODO: can we have separate packages for zen2/3/4/5 separately?
    %cmake_ninja -L \
      -DBLIS_CONFIG_FAMILY=amdzen \
      -DBUILD_SHARED_LIBS=ON \
      -DBUILD_STATIC_LIBS=OFF \
      -DENABLE_THREADING=openmp \
      -DENABLE_CBLAS=ON
build      : |
    %ninja_build
install    : |
    %ninja_install

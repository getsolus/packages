From af9c481c92953dbe675f68fd58d5aff4d6bdcfa1 Mon Sep 17 00:00:00 2001
From: Reilly Brogan <reilly@reillybrogan.com>
Date: Thu, 18 Jul 2024 16:25:20 -0500
Subject: [PATCH] moss: Fix duplicate inserts

Signed-off-by: Reilly Brogan <reilly@reillybrogan.com>
---
 moss/src/db/meta/mod.rs | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/moss/src/db/meta/mod.rs b/moss/src/db/meta/mod.rs
index 73b10afb..0f5f70e4 100644
--- a/moss/src/db/meta/mod.rs
+++ b/moss/src/db/meta/mod.rs
@@ -315,16 +315,16 @@ impl Database {
                 batch_remove_impl(&ids, conn)?;
 
                 diesel::insert_into(model::meta::table).values(entries).execute(conn)?;
-                diesel::insert_into(model::meta_licenses::table)
+                diesel::insert_or_ignore_into(model::meta_licenses::table)
                     .values(licenses)
                     .execute(conn)?;
-                diesel::insert_into(model::meta_dependencies::table)
+                diesel::insert_or_ignore_into(model::meta_dependencies::table)
                     .values(dependencies)
                     .execute(conn)?;
-                diesel::insert_into(model::meta_providers::table)
+                diesel::insert_or_ignore_into(model::meta_providers::table)
                     .values(providers)
                     .execute(conn)?;
-                diesel::insert_into(model::meta_conflicts::table)
+                diesel::insert_or_ignore_into(model::meta_conflicts::table)
                     .values(conflicts)
                     .execute(conn)?;
                 Ok(())

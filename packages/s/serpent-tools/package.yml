name       : serpent-tools
version    : 0.1.0
release    : 1
source     :
    - git|https://github.com/serpent-os/moss.git : 5cfe01cf08548604fda18a10beb80723ff9dec3d
homepage   : https://serpentos.com/
license    : MPL-2.0
component  : system.utils
summary    : EXPERIMENTAL tools from Serpent
description: |-
    EXPERIMENTAL tools from Serpent. Included so that interested packagers can work on Serpent packages
networking : yes
builddeps  :
    - pkgconfig(libzstd)
    - pkgconfig(openssl)
    - pkgconfig(sqlite3)
    - rust
environment: |
    # Force use of system libs. Eventually we'll have a moss-static or moss-recovery that is fully
    # statically linked, but the base system moss/boulder will use system libraries
    export LIBSQLITE3_SYS_USE_PKG_CONFIG=1
    export ZSTD_SYS_USE_PKG_CONFIG=1
setup      : |
    %patch -p1 -i $pkgfiles/282.patch
    %patch -p1 -i $pkgfiles/283.patch
    %patch -p1 -i $pkgfiles/0001-moss-Disable-blsforme.patch

    %cargo_fetch
build      : |
    cargo build -v -j "%YJOBS%" --frozen \
            --config profile.packaging.debug=\"full\" \
            --config profile.packaging.split-debuginfo=\"off\" \
            --config profile.packaging.strip=\"none\" --profile packaging -p boulder -p moss
install    : |
    install -Dm00755 target/packaging/{moss,boulder} -t $installdir/usr/bin

    # Don't want users getting any ideas about this being non-experimental
    mv $installdir/usr/bin/moss $installdir/usr/bin/moss-experimental

    install -dm00755 $installdir/usr/share/boulder
    cp -ra boulder/data/* $installdir/usr/share/boulder

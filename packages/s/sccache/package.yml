# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : sccache
version    : 0.13.0
release    : 12
source     :
    - https://github.com/mozilla/sccache/archive/refs/tags/v0.13.0.tar.gz : cc93c603b938f7444c180c049ce9d983e6b08eb2a0d44973b4794508589f891c
homepage   : https://github.com/mozilla/sccache
license    : Apache-2.0
component  : programming.tools
summary    : ccache with cloud storage for C/C++/Rust
description: |
    sccache is a ccache-like compiler caching tool. It is used as a compiler wrapper and avoids compilation when possible, storing cached results either on local disk or in one of several cloud storage backends. It includes support for caching the compilation of C/C++ code, Rust, as well as NVIDIA's CUDA using nvcc.
networking : true
builddeps  :
    - pkgconfig(libzstd)
    - pkgconfig(openssl)
    - rust
setup      : |
    # Note(GZGavinZhao): occasionally sccache fails on Cargo startup when
    # calling `sccache rustc -vV`, failing with message "Failed to create
    # ~/.rustup"!
    #
    # This behavior is flaky and I can't reliably reproduce it. If that happens,
    # uncomment the line below to make `sccache` work again.
    # sccache --stop-server

    %cargo_fetch
build      : |
    # Build against system zstd
    export ZSTD_SYS_USE_PKG_CONFIG=1

    %cargo_build --features all,native-zlib,dist-server
install    : |
    install -Dm00755 target/release/sccache{,-dist} -t $installdir/usr/bin
    %install_license LICENSE

From 09d401cd89fd3be1e8f968f45aa2cbd8523176cb Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 19 Jun 2016 23:15:53 +0100
Subject: [PATCH] Deal with mass string asshattery

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 eopkg_assist/backend.py | 17 +++++++++++++----
 solus_sc/basket.py      |  2 +-
 2 files changed, 14 insertions(+), 5 deletions(-)

diff --git a/eopkg_assist/backend.py b/eopkg_assist/backend.py
index 78a4fbd..48f76fe 100644
--- a/eopkg_assist/backend.py
+++ b/eopkg_assist/backend.py
@@ -162,9 +162,11 @@ class EopkgAssistService(dbus.service.Object):
         else:
             return True  # Already authorized by PolKit in this session
 
-    def __build_package(self, pkgname):
+    def __build_package(self, pkgname2):
         def ok(msg):
             self.Progress(0, msg)
+
+        pkgname = str(pkgname2)
         ui = EopkgUiMonitor(ok, ok)
         pisi.context.ui = ui
         pisi.context.config.values.general.ignore_safety = True
@@ -192,12 +194,15 @@ class EopkgAssistService(dbus.service.Object):
             self._do_purge(options.output_dir)
             return
 
-        pkg = BASE_URI + "/" + APPS[pkgname]
+        pkg = str(BASE_URI) + "/" + str(APPS[pkgname])
 
         # Ruthless I know.
         kids = os.listdir(options.output_dir)
         if len(kids) > 0:
-            os.system("rm -f {}/*.eopkg".format(options.output_dir))
+            try:
+                os.system("rm -f {}/*.eopkg".format(options.output_dir))
+            except Exception as e:
+                print(e)
 
         try:
             pisi.api.build(pkg)
@@ -241,7 +246,11 @@ class EopkgAssistService(dbus.service.Object):
             error_handler("Not authorized")
             self.Progress(0, "DONE")
             return
-        t = threading.Thread(target=self.__build_package, args=(pkgname,))
+        try:
+            sane_name = str(str(pkgname).decode("latin1"))
+        except:
+            sane_name = str(pkgname)
+        t = threading.Thread(target=self.__build_package, args=(sane_name,))
         t.start()
 
     ''' Shut down this service '''
diff --git a/solus_sc/basket.py b/solus_sc/basket.py
index acc66a7..4c59487 100644
--- a/solus_sc/basket.py
+++ b/solus_sc/basket.py
@@ -111,7 +111,7 @@ class BasketView(Gtk.Revealer):
 
     def do_prog(self, pct, message):
         if str(message).startswith("ERROR: "):
-            content = message.split("ERROR: ")[1]
+            content = message.split("ERROR: ")[1:]
             d = Gtk.MessageDialog(self.owner,
                                   Gtk.DialogFlags.DESTROY_WITH_PARENT |
                                   Gtk.DialogFlags.MODAL,
-- 
2.8.4


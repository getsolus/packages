# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : scx-tools
version    : 1.0.19
release    : 1
source     :
    - https://github.com/sched-ext/scx-loader/archive/refs/tags/v1.0.19.tar.gz : a8a334a2b8bab79ad48860ac88bba75c1c9cf75c2d35628de95823926a8e6787
homepage   : https://github.com/sched-ext/scx-loader
license    : GPL-2.0-only
component  : system.utils
summary    : sched_ext tools
description: |
    sched_ext tools
networking : true
builddeps  :
    - rust-devel
environment: |
    export VENDORDIR=/usr/share/defaults/
setup      : |
    %cargo_fetch
build      : |
    %cargo_build
install    : |
    find target/release \
            -maxdepth 1 -type f -executable \
            -exec install -Dm00755 -t "$installdir/usr/bin/" {} +

    ./target/release/xtask install --destdir "$installdir/"

    # Useless stuff not needed
    rm -v $installdir/usr/bin/xtask

    # Replaced by our own
    rm -v $installdir/usr/share/scx_loader/config.toml
    rmdir $installdir/usr/share/scx_loader

    # Install our default config
    install -Dm00644 $pkgfiles/config.toml -t ${installdir}/${VENDORDIR}/scx_loader

    # Enable service
    install -Ddm00755 $installdir/usr/lib/systemd/system/sysinit.target.wants
    ln -sv ../scx_loader.service $installdir/usr/lib/systemd/system/sysinit.target.wants/scx_loader.service

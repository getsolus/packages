# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : sudo-rs
version    : 0.2.12
release    : 1
source     :
    - https://github.com/trifectatechfoundation/sudo-rs/archive/refs/tags/v0.2.12.tar.gz : 1f4a0577df3ae64fd35d75d30ece458fa18d57bdc7bc777aea3bfdfcb841dbeb
homepage   : https://github.com/trifectatechfoundation/sudo-rs
license    :
    - Apache-2.0
    - MIT
component  : system.utils
summary    : A memory safe implementation of sudo and su written in Rust
description: |
    sudo-rs is a safety oriented and memory safe implementation of sudo and su
    written in Rust. It aims to be a drop-in replacement for the traditional
    sudo utility while providing improved security through memory safety guarantees.
networking : true
builddeps  :
    - pkgconfig(pam)
    - rust
setup      : |
    %apply_patches
    %cargo_fetch
build      : |
    %cargo_build --features pam-login
install    : |
    # Install binaries with setuid for sudo/su
    install -Dm4755 target/release/sudo $installdir/usr/bin/sudo-rs
    install -Dm4755 target/release/su $installdir/usr/bin/su-rs

    # Install visudo without setuid (should not be setuid)
    install -Dm0755 target/release/visudo $installdir/usr/bin/visudo-rs

    # Create sudoedit symlink
    ln -s sudo-rs $installdir/usr/bin/sudoedit-rs

    # Install man pages
    install -Dm00644 docs/man/sudo.8.man $installdir/usr/share/man/man8/sudo-rs.8
    install -Dm00644 docs/man/su.1.man $installdir/usr/share/man/man1/su-rs.1
    install -Dm00644 docs/man/visudo.8.man $installdir/usr/share/man/man8/visudo-rs.8
    install -Dm00644 docs/man/sudoers.5.man $installdir/usr/share/man/man5/sudoers-rs.5

    # Create sudoedit man page symlink
    ln -s sudo-rs.8 $installdir/usr/share/man/man8/sudoedit-rs.8

    # tmpfiles for /etc/sudoers.d directory
    install -Dm00644 $pkgfiles/sudo-rs.tmpfiles $installdir/%libdir%/tmpfiles.d/sudo-rs.conf

    # Install license files
    %install_license LICENSE*

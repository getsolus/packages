name       : openssh
version    : 7.7_p1
release    : 30
source     :
    - https://github.com/openssh/openssh-portable/archive/V_7_7_P1.tar.gz : 79d6708f00c2d6257afd3cb2adade76615a4a154025da5901429a88be080de1a
homepage   : https://www.openssh.com/
license    :
    - BSD-2-Clause
    - BSD-3-Clause
    - ISC
    - MIT
summary    :
    - OpenSSH (OpenBSD Secure Shell)
    - server : OpenSSH Daemon
description: |
    OpenSSH is a free version of secure shell tools developed by the OpenBSD project to help facilitate secure connections and communications.
component  :
    - network.clients
    - server : network.clients
builddeps  :
    - pkgconfig(ext2fs)
    - pkgconfig(libedit)
    - pkgconfig(libldns)
    - pkgconfig(krb5)
    - groff
    - xauth
rundeps    :
    - server :
        - openssh
        - xauth
patterns   :
    - server :
        - /usr/sbin
        - /usr/lib/systemd/system
        - /usr/lib/sysusers.d
        - /usr/lib/tmpfiles.d
        - /etc/ssh/sshd_config
        - /usr/lib64/openssh/sftp*
        - /usr/share/man/*/sshd*
        - /usr/share/man/*/sftp-*
setup      : |
    %patch -p3 < $pkgfiles/security/cve-2018-15473.patch
    %reconfigure --sysconfdir=/etc/ssh \
               --datadir=/usr/share/sshd \
               --with-xauth=/usr/bin/xauth \
               --with-kerberos5=/usr \
               --with-ldns=/usr \
               --with-libedit \
               --with-md5-passwords \
               --with-pam \
               --with-ssl-engine \
               --with-privsep-path=/var/lib/sshd
build      : |
    %make
install    : |
    %make_install

    # Make PAM + systemd work
    install -Dm 00644 $pkgfiles/sshd.pam $installdir/usr/share/defaults/etc/pam.d/sshd
    install -Dm 00644 $pkgfiles/sshd.service $installdir/usr/lib/systemd/system/sshd.service
    install -Dm 00644 $pkgfiles/sshd@.service $installdir/usr/lib/systemd/system/sshd@.service

    # Folks want ssh-copy-id :)
    install -Dm 00755 contrib/ssh-copy-id $installdir/usr/bin/.

    install -Dm 00644 $pkgfiles/openssh.tmpfiles $installdir/usr/lib/tmpfiles.d/openssh.conf
    install -Dm 00644 $pkgfiles/openssh.sysusers $installdir/usr/lib/sysusers.d/openssh.conf

    rm -rf $installdir/var

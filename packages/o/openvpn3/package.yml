# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: openvpn3
version: '26'
release: 5
source:
    - https://swupdate.openvpn.net/community/releases/openvpn3-linux-26.tar.xz: 80e35615ae913fbdbdda53495b27934a3bbb21d8b15c49a624d4992c15e196e1
homepage: https://community.openvpn.net/Pages/OpenVPN3Linux
license: AGPL-3.0-only
component: network.clients
summary: Next generation OpenVPN client
description: |
    Next generation OpenVPN implementation, building on features available on modern Linux distributions
builddeps:
    - pkgconfig(asio)
    - pkgconfig(dbus-1)
    - pkgconfig(gdbuspp)
    - pkgconfig(jsoncpp)
    - pkgconfig(libcap-ng)
    - pkgconfig(liblz4)
    - pkgconfig(libnl-3.0)
    - pkgconfig(libselinux)
    - pkgconfig(libssl)
    - pkgconfig(libxml-2.0)
    - pkgconfig(polkit-agent-1)
    - pkgconfig(protobuf)
    - pkgconfig(python3)
    - pkgconfig(systemd)
    - pkgconfig(tinyxml2)
    - pkgconfig(uuid)
    - gtest
    - python-docutils
    - python-jinja
    - python-systemd
    - python3-dbus
rundeps:
    - python-systemd
setup: |
    %apply_patches
    %meson_configure -Dasio_path=/usr/ -Dunit_tests=disabled -Dtest_programs=disabled
build: |
    %ninja_build
install: |
    %ninja_install

    rm -r $installdir/var
    install -Dm00644 $pkgfiles/sysusers.conf $installdir/usr/lib/sysusers.d/openvpn3.conf
    install -Dm00644 $pkgfiles/tmpfiles.conf $installdir/usr/lib/tmpfiles.d/openvpn3.conf
    install -Dm00644 src/shell/bash-completion/openvpn3 $installdir/usr/share/bash-completion/completions/openvpn3

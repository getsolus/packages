name       : obsidian
version    : 1.5.3
release    : 1
source     :
    - https://github.com/obsidianmd/obsidian-releases/releases/download/v1.5.3/obsidian-1.5.3.tar.gz : 17b9ea58e7811864a6495353a5cc7794745e8d28cd78cd8106a4bdb6c6ac4ef8
homepage   : https://obsidian.md/
license    : custom:Commercial
component  : office.notes
summary    : Obsidian is the private and flexible note taking app.
description: |
    Obsidian is the private and flexible writing app that adapts to the way you think.
networking: yes
builddeps  :
    - pkgconfig(gbm)
    - pkgconfig(gtk+-3.0)
    - pkgconfig(xshmfence)
    - nodejs
rundeps    :
    - nodejs
    - fuse
    - hicolor-icon-theme
    - zlib
    
setup      : | 
    npm i @electron/asar
    ./node_modules/.bin/asar ef ./resources/obsidian.asar icon.png
install    : |

    # Metadata
    install -Dm00644 $pkgfiles/obsidian.desktop $installdir/usr/share/applications/obsidian.desktop
    install -Dm00644 icon.png $installdir/usr/share/pixmaps/obsidian.png
    
    # Binary
    install -Dm00755 obsidian $installdir/usr/share/obsidian/obsidian
    install -Dm00755 $pkgfiles/obsidian.sh $installdir/usr/bin/obsidian

    # Assets
    for i in *.pak *.dat *.bin *.png; do
        install -m00644 $i $installdir/usr/share/obsidian/.
    done
    install -m00755 chrome_crashpad_handler $installdir/usr/share/obsidian/

    # .so's
    for i in *.so; do
        install -m00755 $i $installdir/usr/share/obsidian/.
    done

    # Asset dirs
    for i in locales resources; do
        cp -Ra $i $installdir/usr/share/obsidian/.
    done

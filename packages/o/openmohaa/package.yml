name       : openmohaa
version    : 0.82.1
release    : 2
source     :
    - git|https://github.com/openmoh/openmohaa.git : a72bc153db1e6ced6e30431b5217e1a53576712c # v0.82.1
homepage   : https://www.openmohaa.org/
license    : GPL-2.0-or-later
component  : games
summary    : Open re-implementation of Medal of Honor Allied Assault with modern features and bugfixes from ioquake3 with cross-platform support
description: |
    The main goal of OpenMoHAA is to ensure the future and continuity of Medal of Honor: Allied Assault. It has always been a dream in the community to provide patches and security fixes for the game. Thanks to the ioquake3 project, F.A.K.K SDK and other quality tools, OpenMoHAA has already reached more than half of its goal: to create an open-source version of MoH:AA (based on version 2.40) that is fully compatible with the original game (in terms of protocol, assets, and scripts).

    Requires an original copy of the game installed to `~/.openmohaa`.
builddeps  :
    - pkgconfig(libjpeg)
    - pkgconfig(mad)
    - pkgconfig(openal)
    - pkgconfig(sdl2)
checkdeps  :
    - imagemagick # don't confuse dependency solvers
setup      : |
    %patch -p1 -i $pkgfiles/0001-launcher-CMake-Add-symlink-to-bin-on-Linux.patch
    %cmake_ninja -DUSE_SYSTEM_LIBS=ON -DTARGET_LOCAL_SYSTEM=ON
build      : |
    %ninja_build
install    : |
    %ninja_install

    %install_license COPYING.txt

    # Install .png to keep appstream generator happy...
    convert misc/openmohaa.png -filter Lanczos -resize 64x64 misc/openmohaa-64.png
    install -Dm00644 misc/openmohaa-64.png $installdir/usr/share/icons/hicolor/64x64/apps/org.openmoh.openmohaa.png

    # remove unnecessary static files
    rm -v $installdir/%libdir%/*.a

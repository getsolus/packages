name       : opendoas
version    : 6.8.2
release    : 1
source     :
    - https://github.com/Duncaen/OpenDoas/releases/download/v6.8.2/opendoas-6.8.2.tar.gz : 28dca29adec5f4336465812d9e2243f599e62a78903de71c24f0cd6fe667edac
homepage   : https://github.com/Duncaen/OpenDoas
license    : ISC
component  : system.base
summary    : A portable fork of the OpenBSD `doas` command
description: |
    Run commands as super user or another user
rundeps    :
    - glibc
    - pam
setup      : |
    ./configure --prefix=/usr \
               --with-timestamp
build      : |
    %make
install    : |
    %make_install
    cat << EOL > $installdir/etc/pam.d/doas
        #%PAM-1.0
        auth        required    pam_unix.so    try_first_pass nullok
        auth        optional    pam_permit.so
        auth        required    pam_env.so
        
        account     required    pam_unix.so
        account     optional    pam_permit.so
        account     required    pam_time.so
        
        password    required    pam_unix.so    try_first_pass nullok sha512 shadow
        password    optional    pam_permit.so
        
        session     optional    pam_umask.so   usergroups
        session     required    pam_limits.so
        session     required    pam_unix.so
        session     optional    pam_permit.so
    EOL
    chmod 0644 $installdir/etc/pam.d/doas || true

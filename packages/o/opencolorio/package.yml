# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : opencolorio
version    : 2.5.1
release    : 14
source     :
    - https://github.com/AcademySoftwareFoundation/OpenColorIO/releases/download/v2.5.1/OpenColorIO-2.5.1.tar.gz : 49ab04d023d7a7a7237e24f2cfead3171b0ff7f466ce20e6e32859ec8c7cc94b
    - git|https://github.com/imageworks/pystring : 76a2024e132bcc83bec1ecfebeacd5d20d490bfe
homepage   : https://opencolorio.org/
license    :
    - BSD-3-Clause
    - BSD-4-Clause
    - Zlib
component  : multimedia.library
summary    : A color management framework for visual effects and animation
description: |
    OpenColorIO (OCIO) is a complete color management solution geared towards motion picture production with an emphasis on visual effects and computer animation. OCIO provides a straightforward and consistent user experience across all supporting applications while allowing for sophisticated back-end configuration options suitable for high-end production usage. OCIO is compatible with the Academy Color Encoding Specification (ACES) and is LUT-format agnostic, supporting many popular formats.
builddeps  :
    - pkgconfig(Imath)
    - pkgconfig(OpenEXR)
    - pkgconfig(OpenImageIO)
    - pkgconfig(expat)
    - pkgconfig(glew)
    - pkgconfig(glut)
    - pkgconfig(lcms2)
    - pkgconfig(minizip-ng)
    - pkgconfig(oslcomp)
    - pkgconfig(python3)
    - pkgconfig(yaml-cpp)
    - libboost-devel
    - pybind11
setup      : |
    cp -r $sources/pystring.git src/pystring
    pushd src/pystring
    x86_64-solus-linux-g++ $CXXFLAGS -o pystring.cpp.o -c pystring.cpp
    ar rcs libpystring.a pystring.cpp.o
    popd

    # Allow yaml-cpp 0.7.0
    sed -i 's|MIN_VERSION 0.8.0|MIN_VERSION 0.7.0|' share/cmake/modules/FindExtPackages.cmake

    %cmake_ninja -L \
        -DOCIO_BUILD_STATIC=OFF \
        -DLIB_SUFFIX=64 \
        -DOCIO_BUILD_APPS=OFF \
        -DOCIO_BUILD_TESTS=ON \
        -DOCIO_BUILD_GPU_TESTS=OFF \
        -DOCIO_BUILD_DOCS=OFF \
        -Dpystring_LIBRARY=$workdir/src/pystring/libpystring.a \
        -Dpystring_INCLUDE_DIR=$workdir/src/pystring
build      : |
    %ninja_build
install    : |
    %ninja_install
check      : |
    # It seems like tests don't know what instructions the machine running the
    # tests have, so running AVX512 tests on a Zen2 CPU would fail...
    %ninja_check || :

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : opera-stable
version    : 126.0.5750.18
release    : 369
source     :
    - https://ftp.opera.com/pub/opera/desktop/126.0.5750.18/linux/opera-stable_126.0.5750.18_amd64.deb : f31c35821eef95b746f4c6bca37fd4a3b2276d953602cd2bc4e6b2f3ec5cfcc5
license    : Distributable
homepage   : https://www.opera.com
extract    : false
strip      : false
component  : network.web.browser
summary    : The Opera browser brings you more speed, more discoveries and more safety on the web - all for free
description: |
    The Opera browser brings you more speed, more discoveries and more safety on the web - all for free.
patterns   : /*
builddeps  :
    - pkgconfig(Qt5Core)
    - pkgconfig(Qt6Core)
    - pkgconfig(alsa)
    - pkgconfig(cups)
    - pkgconfig(gbm)
    - pkgconfig(gconf-2.0)
    - pkgconfig(gtk+-3.0)
    - pkgconfig(xscrnsaver)
    - ffmpeg-chromium-opera
rundeps    :
    - ffmpeg-chromium-opera
setup      : |
    ar xf $sources/opera-stable_${version}_amd64.deb
    mkdir root
    tar xf data.tar.xz -C root
install    : |
    pushd $workdir/root
        chown root:root usr/lib/x86_64-linux-gnu/opera-stable/opera_sandbox
        chmod 4755 usr/lib/x86_64-linux-gnu/opera-stable/opera_sandbox
    popd

    install -dm00755 $installdir/usr/bin
    install -dm00644 $installdir/usr/lib
    install -dm00644 $installdir/usr/share
    cd root
    mv usr/lib/x86_64-linux-gnu/* $installdir/usr/lib/
    rm -r usr/share/lintian
    mv usr/share/* $installdir/usr/share/
    ln -s /usr/lib/opera-stable/opera $installdir/usr/bin/opera

    # Use system chromium ffmpeg
    rm $installdir/usr/lib/opera-stable/libffmpeg.so

    # Install AppStream metainfo
    install -Dm00644 $pkgfiles/com.opera.Opera.metainfo.xml $installdir/usr/share/metainfo/com.opera.Opera.metainfo.xml

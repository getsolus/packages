# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : mupdf
version    : 1.27.0
release    : 12
source     :
    - https://casper.mupdf.com/downloads/archive/mupdf-1.27.0-source.tar.lz : 61b109c82093a1c39b1b7f58c04b6d8ad6fe8e83e266ce1d8423e1e5c9310911
homepage   : https://mupdf.com
license    : AGPL-3.0-or-later
component  :
    - office.viewers
    - examples : programming.library
summary    :
    - lightweight PDF, XPS, and e-book viewer
    - examples : Example scripts and code for mupdf
description: |
    MuPDF is a lightweight PDF, XPS, and E-book viewer.
    MuPDF consists of a software library, command line tools, and viewers for various platforms.
    The renderer in MuPDF is tailored for high quality anti-aliased graphics. It renders text with metrics and spacing accurate to within fractions of a pixel for the highest fidelity in reproducing the look of a printed page on screen.
    The viewer is small, fast, yet complete. It supports many document formats, such as PDF, XPS, OpenXPS, CBZ, EPUB, and FictionBook 2. You can annotate PDF documents and fill out forms with the mobile viewers (this feature is coming soon to the desktop viewer as well).
    The command line tools allow you to annotate, edit, and convert documents to other formats such as HTML, SVG, PDF, and CBZ. You can also write scripts to manipulate documents using Javascript.
libsplit   : false
patterns   :
    - examples :
        - /usr/share/doc/mupdf/examples/
builddeps  :
    - pkgconfig(freetype2)
    - pkgconfig(glu)
    - pkgconfig(gumbo)
    - pkgconfig(harfbuzz)
    - pkgconfig(jbig2dec)
    - pkgconfig(libbrotlicommon)
    - pkgconfig(libcurl)
    - pkgconfig(libopenjp2)
    - pkgconfig(libturbojpeg)
    - pkgconfig(xext)
    - pkgconfig(xi)
    - pkgconfig(xrandr)
rundeps    :
    - examples :
        - mupdf
setup      : |
    # Keep bundled: freeglut (patched for unicode), mujs (build needs sources),
    # lcms2 (needs Artifex fork for thread safety), extract (not system packaged)
    find thirdparty -mindepth 1 -maxdepth 1 \
        ! -name freeglut \
        ! -name mujs \
        ! -name lcms2 \
        ! -name extract \
        -exec rm -rf {} +

    echo "LINUX_OR_OPENBSD = yes
    shared = yes
    build = release
    USE_SYSTEM_BROTLI = yes
    USE_SYSTEM_FREETYPE = yes
    USE_SYSTEM_GUMBO = yes
    USE_SYSTEM_HARFBUZZ = yes
    USE_SYSTEM_JBIG2DEC = yes
    USE_SYSTEM_LCMS2 = no
    USE_SYSTEM_LIBJPEG = yes
    USE_SYSTEM_MUJS = no
    USE_SYSTEM_OPENJPEG = yes
    USE_SYSTEM_ZLIB = yes" > user.make
build      : |
    %make
install    : |
    %install_license COPYING
    %make_install prefix=%PREFIX% SO_INSTALL_MODE=755

    install -Dm00644 docs/logo/mupdf-logo.svg $installdir/usr/share/icons/hicolor/scalable/apps/mupdf.svg
    install -Dm00644 $pkgfiles/mupdf.desktop -t $installdir/usr/share/applications

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: msedit
version: 1.2.1
release: 1
source:
    - https://github.com/microsoft/edit/archive/refs/tags/v1.2.1.tar.gz: 41c719b08212fa4ab6e434a53242b2718ba313e8d24d090f244bb857d6a9d0fd
homepage: https://github.com/microsoft/edit
license: MIT
component: editor
networking: true
summary: Microsoft Edit - A simple editor for simple needs
description: |
    This editor pays homage to the classic MS-DOS Editor, but with a modern
    interface and input controls similar to VS Code. The goal is to provide an
    accessible editor that even users largely unfamiliar with terminals can
    easily use.

builddeps:
    - pkgconfig(icu-i18n)
    - rust

setup: |
    # Fix desktop file to use msedit instead of edit
    sed -i 's/Exec=edit %U/Exec=msedit %U/' assets/com.microsoft.edit.desktop

    # Desktop file - add missing Categories field and fix icon name
    sed -e '/^Terminal=/a Categories=Utility;TextEditor;' \
        -e 's/^Icon=.*/Icon=msedit/' \
        assets/com.microsoft.edit.desktop > com.microsoft.edit.desktop

    %cargo_fetch

build: |
    # Allow nightly features on stable Rust (as recommended by upstream)
    export RUSTC_BOOTSTRAP=1

    %cargo_build

install: |
    install -Dm00755 $workdir/target/release/edit $installdir/usr/bin/msedit
    install -Dm00644 assets/edit.svg $installdir/usr/share/icons/hicolor/scalable/apps/msedit.svg
    install -Dm00644 com.microsoft.edit.desktop $installdir/usr/share/applications/com.microsoft.edit.desktop
    install -Dm00644 $pkgfiles/com.microsoft.edit.metainfo.xml $installdir/usr/share/metainfo/com.microsoft.edit.metainfo.xml
    install -Dm00644 assets/manpage/edit.1 $installdir/usr/share/man/man1/msedit.1

check: |
    export RUSTC_BOOTSTRAP=1
    %cargo_test -- --ignored

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : mattermost-desktop
version    : 6.0.4
release    : 1
source     :
    - https://github.com/mattermost/desktop/archive/refs/tags/v6.0.4.tar.gz : 59a06019ce3fdb0483fd70c8feaf65210afd662fd429720762078c5e7da8e200
homepage   : https://mattermost.com/
license    : Apache-2.0
component  : network.im
summary    : Mattermost Desktop application for Linux
description: |
    Mattermost is an open-source, self-hostable online chat service with file sharing, search, and third party application integrations.
networking : true
builddeps  :
    - pkgconfig(alsa)
    - pkgconfig(gbm)
    - pkgconfig(gdk-3.0)
    - nodejs-22
environment: |
    # npm install needs to also call npm-22
    export PATH=/usr/lib64/nodejs-22/bin:$PATH
setup      : |
    # fix version instead of trying to infer it from git
    %patch -p1 -i $pkgfiles/webpack-set-version.patch
    npm install
build      : |
    npm run build-prod
    npx electron-builder --linux dir
install    : |
    # Install application
    install -dm00644 $installdir/usr/share/mattermost-desktop
    cp -Rv release/linux-unpacked/* $installdir/usr/share/mattermost-desktop

    # Create symlink for binary
    install -dm00644 $installdir/usr/bin
    ln -s /usr/share/mattermost-desktop/mattermost-desktop $installdir/usr/bin/mattermost-desktop

    # Install icon
    install -Dm00644 src/assets/linux/app_icon.png $installdir/usr/share/icons/hicolor/512x512/apps/mattermost-desktop.png

    # Install desktop file
    install -Dm00644 $pkgfiles/com.mattermost.Desktop.desktop $installdir/usr/share/applications/com.mattermost.Desktop.desktop

    # Install metainfo
    install -Dm00644 $pkgfiles/com.mattermost.Desktop.metainfo.xml $installdir/usr/share/metainfo/com.mattermost.Desktop.metainfo.xml
    # Install license
    %install_license LICENSE.txt

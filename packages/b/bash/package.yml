name       : bash
version    : 5.2.26
release    : 70
source     :
    - https://ftp.gnu.org/gnu/bash/bash-5.2.21.tar.gz : c8e31bdc59b69aaffc5b36509905ba3e5cbb12747091d27b4b977f078560d5b8
license    :
    - GPL-3.0-or-later
homepage   : https://www.gnu.org/software/bash
component  :
    - system.base
summary    :
    - bash (sh-compatible shell)
description: |
    bash (sh-compatible shell) The GNU Bourne-Again SHell.  Bash is a sh-compatible command interpreter that executes commands read from the standard input or from a file.  Bash also incorporates useful features from the Korn and C shells (ksh and csh).  Bash is ultimately intended to be a conformant implementation of the IEEE Posix Shell and Tools specification (IEEE Working Group 1003.2). Bash must be present for the system to boot properly.
optimize   :
    - size
    - lto
environment: |
    export CFLAGS="$CFLAGS -DRECYCLES_PIDS -DSYSLOG_HISTORY -DSYSLOG_SHOPT=0"
setup      : |
    %apply_patches
    %configure \
               --with-curses \
               --with-installed-readline \
               --enable-history \
               --enable-readline \
               --disable-rpath \
               --without-bash-malloc \
               --docdir=/usr/share/doc/bash
build      : |
    %make
install    : |
    %make_install

    # Link bash man page to sh
    ln -s bash.1 $installdir/usr/share/man/man1/sh.1

    # These are useless
    rm -rfv $installdir/usr/lib64/bash/Makefile.*

    # usr-merge
    install -dm00755 $installdir/bin
    ln -sv /usr/bin/bash $installdir/bin/bash

    # Bash as system shell
    ln -sv /usr/bin/bash $installdir/usr/bin/sh
    ln -sv /usr/bin/bash $installdir/bin/sh

    install -D -d $installdir/usr/share/defaults/etc/profile.d
    install -m 0644 $pkgfiles/profile/*.sh $installdir/usr/share/defaults/etc/profile.d/.
    install -m 0644 $pkgfiles/profile/profile $installdir/usr/share/defaults/etc/profile

    # Use tmpfiles to create the symlink in order to make this completely stateless
    install -Dm00644 $pkgfiles/bash.tmpfiles $installdir/%libdir%/tmpfiles.d/bash.conf

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : zathura
version    : 0.5.14
release    : 29
source     :
    - https://github.com/pwmt/zathura/archive/refs/tags/0.5.14.tar.gz : e7a6bdfe90ed2d7405c4aa8e35f72ba00eda8306ea0e3dda6c02d0edbb00ce6f
    - https://github.com/pwmt/zathura-pdf-poppler/archive/refs/tags/0.3.4.tar.gz : bcaa73814ddb8d6336c21ff2bb76cd1c4c60759d2ef796ac25bda42ee8766e54
    - https://github.com/pwmt/zathura-djvu/archive/refs/tags/0.2.11.tar.gz : 009ae8231bb7a6a83857a3368fcbd08756c48d68ea225830a2111c3c7524118e
    - https://github.com/pwmt/zathura-cb/archive/refs/tags/0.1.12.tar.gz : be3efb8e836fa1874e156c6143927fc6ca8b35088412e75d4cc5543ce42b42e0
    - https://github.com/pwmt/zathura-ps/archive/refs/tags/0.2.9.tar.gz : c634778c897ce9bf2dae5cf714e6e39fc0d46437691231d485bb8e1d5ef7a034
    - https://github.com/pwmt/zathura-pdf-mupdf/archive/refs/tags/0.4.6.tar.gz : 2adb306c6fe8101b7f4d54c9ad31dbb0121046513aa0b61b24d09f34c0ffe147
homepage   : https://pwmt.org/projects/zathura/
license    : Zlib
component  :
    - office.viewers
    - mupdf : office.viewers
    - poppler : office.viewers
summary    : zathura is a highly customizable and functional document viewer
description:
    - zathura is a highly customizable and functional document viewer based on the girara user interface library and several document libraries
    - mupdf : mupdf plugin for zathura
    - poppler : poppler plugin for zathura
patterns   :
    - mupdf :
        - /usr/lib64/zathura/libpdf-mupdf.so
        - /usr/share/applications/org.pwmt.zathura-pdf-mupdf.desktop
    - poppler :
        - /usr/lib64/zathura/libpdf-poppler.so
        - /usr/share/applications/org.pwmt.zathura-pdf-poppler.desktop
builddeps  :
    - pkgconfig(ddjvuapi)
    - pkgconfig(girara-gtk3)
    - pkgconfig(gumbo)
    - pkgconfig(jbig2dec)
    - pkgconfig(libarchive)
    - pkgconfig(libopenjp2)
    - pkgconfig(librsvg-2.0)
    - pkgconfig(libspectre)
    - pkgconfig(libturbojpeg)
    - pkgconfig(poppler)
    - pkgconfig(sqlite3)
    - pkgconfig(synctex)
    - intltool
    - mupdf-devel
    - python-sphinx
rundeps    :
    - mupdf :
        - zathura
    - poppler :
        - zathura
setup      : |
    %meson_configure
build      : |
    %ninja_build
install    : |
    %ninja_install
    %install_license LICENSE

    export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:$installdir/%libdir%/pkgconfig
    # Build the remaining plugins
    mkdir plugin_build
    pushd plugin_build
        for plugin in 0.1.12 0.2.9 0.2.11 0.3.4 0.4.6 ; do
            tar xvf $sources/${plugin}.tar.gz
            pushd zathura-*-$plugin
            if [ $plugin == '0.4.6' ]; then
                # Remove mupdfthird references - Solus links mupdf externally
                perl -pi -e 's/^\s*mupdfthird\s*=.*\n//;' -e 's/, mupdfthird\]/]/;' meson.build
            fi
            CFLAGS="$CFLAGS -I${installdir}/usr/include" %meson_configure
            %ninja_build
            %ninja_install
            popd
        done
    popd

    # due to a limitation in the SC
    rm -v $installdir/usr/share/metainfo/org.pwmt.zathura-*.metainfo.xml

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: zstd
version: 1.5.7
release: 32
source:
    - https://github.com/facebook/zstd/releases/download/v1.5.7/zstd-1.5.7.tar.zst: 5b331d961d6989dc21bb03397fc7a2a4d86bc65a14adc5ffbbce050354e30fd2
license:
    - BSD-3-Clause
    - GPL-2.0-or-later
homepage: https://facebook.github.io/zstd/
component: system.base
summary: Zstd command line tools
description: |
    Zstd, short for Zstandard, is a fast lossless compression algorithm, targeting real-time compression scenarios at zlib-level and better compression ratios.
emul32: true
optimize:
    - speed
builddeps:
    - pkgconfig(liblzma)
environment: |
    export PREFIX=/usr LIBDIR=%libdir%
build: |
    %make
    if [ -z "${EMUL32BUILD+set}" ]; then
        %make manual
        make zstd-dll -C programs
        %make -C contrib/pzstd
    fi
profile: |
    %make check
install: |
    %make_install
    rm -v $installdir/%libdir%/*.a

    if [ -z "${EMUL32BUILD+set}" ]; then
        install -m00755 contrib/pzstd/pzstd $installdir/usr/bin/pzstd
    fi
check: |
    %make -C contrib/pzstd test

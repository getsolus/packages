# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : niri
version    : '25.08'
release    : 3
source     :
    - https://github.com/YaLTeR/niri/archive/refs/tags/v25.08.tar.gz : 69f8227d621ee6389bcd5368a250c189e672d02528472dc5ef0e3eccf80cf0b8
homepage   : https://github.com/YaLTeR/niri
license    : GPL-3.0-or-later
component  : desktop
summary    :
    - session : Session files for Niri
    - A scrollable-tiling Wayland compositor
description:
    - session : Session files for Niri.
    - A scrollable-tiling Wayland compositor.
builddeps  :
    - pkgconfig(gbm)
    - pkgconfig(libdisplay-info)
    - pkgconfig(libinput)
    - pkgconfig(libseat)
    - pkgconfig(pangocairo)
    - pkgconfig(xkbcommon)
    - rust
checkdeps  :
    - pkgconfig(gtk4)
    - pkgconfig(libadwaita-1)
    - pkgconfig(libpipewire-0.3)
rundeps    :
    - session :
        - niri
    - xdg-desktop-portal-gnome
    - xwayland-satellite
networking : true
setup      : |
    %cargo_fetch
build      : |
    %cargo_build --no-default-features --features dbus,systemd
install    : |
    %cargo_install

    install -Dm00755 -t $installdir/usr/bin resources/niri-session
    install -Dm00644 -t $installdir/usr/share/wayland-sessions resources/niri.desktop
    install -Dm00644 -t $installdir/usr/share/xdg-desktop-portal resources/niri-portals.conf

    install -Dm00644 -t $installdir/usr/lib/systemd/user resources/niri.service
    install -Dm00644 -t $installdir/usr/lib/systemd/user resources/niri-shutdown.target
check      : |
    # Exclude tests that require a session.
    # Limit threads to avoid too many open files error.
    export RAYON_NUM_THREADS=2
    %cargo_test --exclude niri-visual-tests -- --test-threads 2
patterns   :
    - session :
        - /usr/bin/niri-session
        - /usr/share/wayland-sessions/niri.desktop

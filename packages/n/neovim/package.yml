# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : neovim
version    : 0.11.5
release    : 54
source     :
    - https://github.com/neovim/neovim/archive/refs/tags/v0.11.5.tar.gz : c63450dfb42bb0115cd5e959f81c77989e1c8fd020d5e3f1e6d897154ce8b771
homepage   : https://neovim.io
license    : Apache-2.0
component  : editor
summary    : Fork of Vim aiming to improve user experience, plugins, and GUIs
description: |
    Fork of Vim aiming to improve user experience, plugins, and GUIs
builddeps  :
    - pkgconfig(libluv)
    - pkgconfig(libutf8proc)
    - pkgconfig(libuv)
    - pkgconfig(luajit)
    - pkgconfig(termkey)
    - pkgconfig(tree-sitter)
    - pkgconfig(unibilium)
    - gperf
    - libmpack
    - libpth-devel
    - lpeg
rundeps    :
    - lpeg
    - xclip
networking : true
setup      : |
    # Build the bundled tree-sitter parsers
    %cmake_ninja -S cmake.deps -B .deps \
        -DCMAKE_BUILD_TYPE=RelWithDebInfo \
        -DUSE_BUNDLED=OFF \
        -DUSE_BUNDLED_TS_PARSERS=ON

    cmake --build .deps

    %cmake_ninja -DUSE_BUNDLED=OFF \
        -DUSE_BUNDLED_TS_PARSERS=ON \
        -DENABLE_TRANSLATIONS=ON
build      : |
    %ninja_build
install    : |
    %ninja_install
    ln -s /usr/bin/nvim $installdir/usr/bin/neovim

    # Install Appstream data
    install -Dm00644 runtime/nvim.appdata.xml $installdir/usr/share/metainfo/io.neovim.nvim.metainfo.xml

    # Set EDITOR and VISUAL defaults should nano be removed.

    install -Dm00644 $pkgfiles/80-neovim-is-default-EDITOR-and-VISUAL.sh $installdir/usr/share/defaults/etc/profile.d/80-neovim-is-default-EDITOR-and-VISUAL.sh
    install -Dm00644 $pkgfiles/80-neovim-is-default-EDITOR-and-VISUAL.fish $installdir/usr/share/defaults/etc/profile.d/80-neovim-is-default-EDITOR-and-VISUAL.fish

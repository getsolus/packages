# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : nano
version    : 8.7.1
release    : 211
source     :
    - https://www.nano-editor.org/dist/v8/nano-8.7.1.tar.xz : 76f0dcb248f2e2f1251d4ecd20fd30fb400a360a3a37c6c340e0a52c2d1cdedf
homepage   : https://www.nano-editor.org
license    : GPL-3.0-or-later
component  : system.devel
summary    : Small, friendly text editor inspired by Pico
description: |
    GNU nano is an easy-to-use text editor originally designed as a replacement for Pico, the ncurses-based editor from the non-free mailer package Pine (itself now available under the Apache License as Alpine).
mancompress: true
builddeps  :
    - nano-syntax-highlighting
rundeps    :
    - nano-syntax-highlighting
setup      : |
    %patch -p1 -i $pkgfiles/0001-Use-a-stateless-configuration.patch
    %configure \
               --docdir=/usr/share/doc/nano \
               --enable-utf8
build      : |
    %make
install    : |
    %make_install
    %install_license COPYING

    # Include syntax definitions
    for rcfile in $installdir/usr/share/nano/*.nanorc; do
        echo include /usr/share/nano/${rcfile##*nano/} >> $pkgfiles/nanorc
    done
    # Include missing definitions from scopatz's files
    for rcfile in /usr/share/nanorc/*.nanorc; do
        if ! grep -Fq ${rcfile#*highlighting/} $pkgfiles/nanorc
        then
            echo include "$rcfile" >> $pkgfiles/nanorc
        fi
    done
    install -Dm00644 $pkgfiles/nanorc $installdir/usr/share/defaults/nano/nanorc
    # Ensure that nano is set up as default EDITOR and VISUAL
    install -Dm00644 $pkgfiles/81-nano-is-default-EDITOR-and-VISUAL.sh $installdir/usr/share/defaults/etc/profile.d/81-nano-is-default-EDITOR-and-VISUAL.sh
    install -Dm00644 $pkgfiles/81-nano-is-default-EDITOR-and-VISUAL.fish $installdir/usr/share/defaults/etc/profile.d/81-nano-is-default-EDITOR-and-VISUAL.fish

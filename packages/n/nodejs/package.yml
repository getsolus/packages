name       : nodejs
version    : 12.14.0
release    : 78
source     :
    - https://github.com/nodejs/node/archive/v12.14.0.tar.gz : 52727124d7f5ff5d022c157e14bd8a5a0fc7c6ba8f29d34965e63ab03eba004d
license    : MIT
component  : programming
summary    : Node.js is a platform built on Chrome's JavaScript runtime for easily building fast, scalable network applications.
description: |
    Javascript platform to make fast, scalable network application. Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient, perfect for data-intensive real-time applications that run across distributed devices.
builddeps  :
    - pkgconfig(icu-io)
    - pkgconfig(libnghttp2)
    - pkgconfig(libssl)
    - pkgconfig(libuv)
    - pkgconfig(zlib)
setup      : |
    %patch -p1 < $pkgfiles/0001-Disable-running-gyp-on-shared-deps.patch
    %patch -p1 < $pkgfiles/0002-Suppress-NPM-message-to-run-global-update.patch
    ./configure --prefix=/usr \
        --shared-libuv \
        --shared-nghttp2 \
        --shared-zlib \
        --with-intl=system-icu
build      : |
    make BUILDTYPE=Release
install    : |
    %make_install
    pushd $installdir/usr/include/node/openssl/archs/
    find * -maxdepth 0 -type d -not -name "linux-x86_64" -prune -exec rm -r '{}' \;
    popd
    pushd $installdir/usr/lib/node_modules/npm/node_modules/
    find -path "*.md" -prune -exec rm -r '{}' \; \
        -or -name "AUTHOR*" -prune -exec rm -r '{}' \; \
        -or -name "LICENSE*" -prune -exec rm -r '{}' \; \
        -or -name "PULL*" -prune -exec rm -r '{}' \; \
        -or -name "Makefile" -prune -exec rm -r '{}' \; \
        -or -name "appveyor.yml" -prune -exec rm -r '{}' \; \
        -or -name "doc" -prune -exec rm -r '{}' \; \
        -or -name "docs" -prune -exec rm -r '{}' \; \
        -or -name "examples" -prune -exec rm -r '{}' \; \
        -or -name "license*" -prune -exec rm -r '{}' \; \
        -or -name "*.bak" -prune -exec rm -r '{}' \; \
        -or -name "*.d.ts" -prune -exec rm -r '{}' \; \
        -or -name "*.markdown" -prune -exec rm -r '{}' \; \
        -or -name ".*.yml" -prune -exec rm -r '{}' \; \
        -or -name ".editorconfig" -prune -exec rm -r '{}' \; \
        -or -name ".github" -prune -exec rm -r '{}' \; \
        -or -name ".nycrc" -prune -exec rm -r '{}' \;
    popd
    rm -rf $installdir/usr/lib/node_modules/npm/{changelogs,docs}

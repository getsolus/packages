# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : pcsc-lite
version    : 2.4.0
release    : 19
source     :
    - https://github.com/LudovicRousseau/PCSC/archive/refs/tags/2.4.0.tar.gz : 3d20f3d23c29260fed9195529d30ec3e9f1db60a8a835b4be68716d97751f2e7
homepage   : https://pcsclite.apdu.fr/
license    :
    - BSD-3-Clause
    - GPL-3.0-or-later
component  : programming
summary    : PC/SC Architecture smartcard middleware library
description: |
    Middleware to access a smart card using SCard API (PC/SC)
builddeps  :
    - doxygen
clang      : true
optimize   : thin-lto
setup      : |
    %meson_configure \
                     -Dsystemdunit=system \
                     -Dusbdropdir=%libdir%/pcsc/drivers
build      : |
    %ninja_build
install    : |
    %ninja_install

    # Enable the socket by default
    install -dm00755 $installdir/usr/lib/systemd/system/sockets.target.wants
    ln -sv ../pcscd.socket -t $installdir/usr/lib/systemd/system/sockets.target.wants

    # Polkit policy file
    install -D -m0644 doc/org.debian.pcsc-lite.policy -t $installdir/usr/share/polkit-1/actions/
    # License files
    install -D -m0644 COPYING -t $installdir/usr/share/licenses/pcsc-lite

    # Remove /etc, it was added to suppress harmless warning https://github.com/LudovicRousseau/PCSC/issues/211
    rm -fr $installdir/etc

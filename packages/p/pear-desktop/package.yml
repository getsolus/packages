# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : pear-desktop
version    : 3.11.0
release    : 1
source     :
    - https://github.com/pear-devs/pear-desktop/archive/refs/tags/v3.11.0.tar.gz : fb2e06ae019214ad62e0aaee7545d11f6ff42c79084ec4fe0dad7d9f534cbeec
homepage   : https://github.com/pear-devs/pear-desktop
license    : MIT
component  : multimedia.audio
summary    : A desktop application for YouTube Music with enhanced features
description: |
    Pear Desktop is a cross-platform desktop application for YouTube Music, offering enhanced features through a plugin system. It provides a better user experience with additional functionality not available in the web version.
networking : true
builddeps  :
    - pkgconfig(alsa)
    - pkgconfig(gbm)
    - pkgconfig(gtk+-3.0)
    - pkgconfig(xscrnsaver)
    - git
    - jq
    - nodejs-22
environment: |
    export PATH="/usr/lib64/nodejs-22/bin/:$PATH"
setup      : |
    corepack-22 enable
    corepack-22 prepare pnpm@latest --activate
    pnpm install
build      : |
    pnpm run build
    pnpm exec electron-builder --linux --x64 --dir --publish never
install    : |
    %install_license license
    install -dm00755 $installdir/usr/share/pear-desktop
    cp -a pack/linux-unpacked/. $installdir/usr/share/pear-desktop/

    install -Dm00644 $pkgfiles/pear-desktop.desktop $installdir/usr/share/applications/pear-desktop.desktop
    install -Dm00644 $pkgfiles/pear-desktop.metainfo.xml $installdir/usr/share/metainfo/pear-desktop.metainfo.xml

    install -dm00755 $installdir/usr/bin
    ln -sv /usr/share/pear-desktop/youtube-music $installdir/usr/bin/pear-desktop

    # Install icons
    for i in 16 24 32 48 64 128 256 512 1024; do
        install -Dm00644 pack/linux-unpacked/resources/app.asar.unpacked/assets/generated/icons/png/${i}x${i}.png \
            $installdir/usr/share/icons/hicolor/${i}x${i}/apps/pear-desktop.png
    done

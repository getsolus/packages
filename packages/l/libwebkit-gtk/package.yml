# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : libwebkit-gtk
version    : 2.50.2
release    : 134
source     :
    - https://webkitgtk.org/releases/webkitgtk-2.50.2.tar.xz : 19ab61f2d44e62cd443673943d2d5341b84d08405f67a7c37b7a77ad3550f880
homepage   : https://webkitgtk.org
license    : LGPL-2.1-only
component  :
    - ^libwebkit-gtk41 : desktop.gtk
    - ^libwebkit-gtk41-devel : programming.devel
    - ^javascriptcore-gtk41 : desktop.gtk
    - ^javascriptcore-gtk41-devel : programming.devel
    - ^libwebkit-gtk41-docs : desktop.gtk
    - ^libwebkit-gtk6 : desktop.gtk
    - ^libwebkit-gtk6-devel : programming.devel
    - ^javascriptcore-gtk6 : desktop.gtk
    - ^javascriptcore-gtk6-devel : programming.devel
    - ^libwebkit-gtk6-docs : desktop.gtk
    - desktop.gtk
summary    :
    - ^libwebkit-gtk41 : WebKitGTK for GTK 3 and libsoup 3
    - ^libwebkit-gtk41-devel : Development files for libwebkit-gtk41
    - ^javascriptcore-gtk41 : JavaScript engine from libwebkit-gtk41
    - ^javascriptcore-gtk41-devel : Development files for javascriptcore-gtk41
    - ^libwebkit-gtk41-docs : Documentation files for libwebkit-gtk41
    - ^libwebkit-gtk6 : WebKitGTK for GTK 4
    - ^libwebkit-gtk6-devel : Development files for libwebkit-gtk6
    - ^javascriptcore-gtk6 : JavaScript engine from libwebkit-gtk6
    - ^javascriptcore-gtk6-devel : Development files for javascriptcore-gtk6
    - ^libwebkit-gtk6-docs : Documentation files for libwebkit-gtk6
    - GTK web content engine library
description:
    - ^libwebkit-gtk41 : WebKitGTK is the port of the WebKit web rendering engine to the GTK platform. This package contains WebKitGTK for GTK 3 and libsoup 3.
    - ^libwebkit-gtk41-devel : The libwebkit-gtk41-devel package contains libraries, build data, and header files for developing applications that use libwebkit-gtk41.
    - ^javascriptcore-gtk41 : This package contains the JavaScript engine from libwebkit-gtk41.
    - ^javascriptcore-gtk41-devel : The javascriptcore-gtk41-devel package contains libraries, build data, and header files for developing applications that use JavaScript engine from libwebkit-gtk41.
    - ^libwebkit-gtk41-docs : This package contains developer documentation for libwebkit-gtk41.
    - ^libwebkit-gtk6 : WebKitGTK is the port of the WebKit web rendering engine to the GTK platform. This package contains WebKitGTK for GTK 4.
    - ^libwebkit-gtk6-devel : The libwebkit-gtk6-devel package contains libraries, build data, and header files for developing applications that use libwebkit-gtk6.
    - ^javascriptcore-gtk6 : This package contains the JavaScript engine from libwebkit-gtk6.
    - ^javascriptcore-gtk6-devel : The javascriptcore-gtk6-devel package contains libraries, build data, and header files for developing applications that use JavaScript engine from libwebkit-gtk6.
    - ^libwebkit-gtk6-docs : This package contains developer documentation for libwebkit-gtk6.
    - GTK web content engine library.
clang      : true
optimize   :
    - no-symbolic
    - speed
    # Leads to segfaults during runtime
    # - thin-lto
builddeps  :
    - pkgconfig(enchant-2)
    - pkgconfig(gbm)
    - pkgconfig(geoclue-2.0)
    - pkgconfig(gi-docgen)
    - pkgconfig(gstreamer-gl-1.0)
    - pkgconfig(gstreamer-transcoder-1.0)
    - pkgconfig(gstreamer-video-1.0)
    - pkgconfig(gtk+-3.0)
    - pkgconfig(gtk4)
    - pkgconfig(ice)
    - pkgconfig(icu-uc)
    - pkgconfig(lcms2)
    - pkgconfig(libavif)
    - pkgconfig(libgcrypt)
    - pkgconfig(libjpeg)
    - pkgconfig(libjxl)
    - pkgconfig(libseccomp)
    - pkgconfig(libsecret-1)
    - pkgconfig(libsoup-3.0)
    - pkgconfig(libwebp)
    - pkgconfig(libwoff2dec)
    - pkgconfig(libxslt)
    - pkgconfig(manette-0.2)
    - pkgconfig(ruby-3.4)
    - pkgconfig(sysprof-capture-4)
    - pkgconfig(wayland-protocols)
    - bubblewrap
    - gperf
    - hyphen-devel
    - unifdef
    - xdg-dbus-proxy
rundeps    :
    - ^javascriptcore-gtk41-devel :
        - javascriptcore-gtk41
    - ^javascriptcore-gtk6-devel :
        - javascriptcore-gtk6
    - ^libwebkit-gtk41 :
        - bubblewrap
        - xdg-dbus-proxy
    - ^libwebkit-gtk41-devel :
        - libwebkit-gtk41
    - ^libwebkit-gtk41-docs :
        - libwebkit-gtk41
    - ^libwebkit-gtk6 :
        - bubblewrap
        - xdg-dbus-proxy
    - ^libwebkit-gtk6-devel :
        - libwebkit-gtk6
    - ^libwebkit-gtk6-docs :
        - libwebkit-gtk6
    - bubblewrap
    - xdg-dbus-proxy
setup      : |
    %patch -p1 -i $pkgfiles/disable-dmabuf-nvidia.patch
    %patch -p1 -i $pkgfiles/fix-link-error.patch

    # USE_SOUP2=OFF can be dropped in webkitgtk v2.52
    function cmake_webkitgtk() {
        %cmake_ninja \
            -DENABLE_SPEECH_SYNTHESIS=OFF \
            -DPORT=GTK \
            -DUSE_FLITE=OFF \
            -DUSE_LIBBACKTRACE=OFF \
            -DUSE_SOUP2=OFF \
            "$@"
    }

    # We only want one webdriver binary, so build it in the gtk4 build
    cmake_webkitgtk \
        -B gtk41 \
        -DENABLE_WEBDRIVER=OFF \
        -DUSE_GTK4=OFF

    cmake_webkitgtk \
        -B gtk6 \
        -DENABLE_WEBDRIVER=ON \
        -DUSE_GTK4=ON
build      : |
    _build_of=0
    for b in gtk41 gtk6; do
        # Add which build we are on to the ninja output
        # Make sure to update the number of builds if we add an additional variant
        # I have no idea why we can't use ++ or let bash syntax
        _build_of=$( expr ${_build_of} + 1 )
        export NINJA_STATUS="[${_build_of}/2][%f/%t %es] "

        BUILDDIR=${b}
        env CCACHE_BASEDIR="${PWD}/${b}" %ninja_build -C ${b}
    done
install    : |
    for b in gtk41 gtk6; do
        BUILDDIR=${b}
        %ninja_install -C ${b}
    done
patterns   :
    - ^libwebkit-gtk41 :
        - /usr/lib64/libwebkit2gtk-4.1.so.*
        - /usr/lib64/girepository-1.0/WebKit2*-4.1.typelib
        - /usr/lib64/webkit2gtk-4.1/
        - /usr/lib64/webkitgtk/webkit2gtk-4.1/ # minibrowser and jsc are split out to later packages
        - /usr/libexec/webkit2gtk-4.1/
        - /usr/share/locale/*/*/WebKitGTK-4.1.mo
    - ^libwebkit-gtk41-devel :
        - /usr/include/webkitgtk-4.1/
        - /usr/lib64/libwebkit2gtk-4.1.so
        - /usr/lib64/webkitgtk/webkit2gtk-4.1/MiniBrowser
        - /usr/lib64/pkgconfig/webkit2gtk*-4.1.pc
        - /usr/share/gir-1.0/WebKit2*-4.1.gir
    - ^javascriptcore-gtk41 :
        - /usr/lib64/libjavascriptcoregtk-4.1.so.*
        - /usr/lib64/girepository-1.0/JavaScriptCore-4.1.typelib
        - /usr/libexec/webkit2gtk-4.1/jsc
    - ^javascriptcore-gtk41-devel :
        - /usr/include/webkitgtk-4.1/JavaScriptCore/
        - /usr/include/webkitgtk-4.1/jsc/
        - /usr/lib64/libjavascriptcoregtk-4.1.so
        - /usr/lib64/webkitgtk/webkit2gtk-4.1/jsc
        - /usr/lib64/pkgconfig/javascriptcoregtk-4.1.pc
        - /usr/share/gir-1.0/JavaScriptCore-4.1.gir
    - ^libwebkit-gtk41-docs :
        - /usr/share/doc/javascriptcoregtk-4.1/
        - /usr/share/doc/webkit2gtk-4.1/
        - /usr/share/doc/webkit2gtk-web-extension-4.1/
    - ^libwebkit-gtk6 :
        - /usr/bin/WebKitWebDriver
        - /usr/lib64/libwebkitgtk-6.0.so.*
        - /usr/lib64/girepository-1.0/WebKit*-6.0.typelib
        - /usr/lib64/webkitgtk-6.0/
        - /usr/lib64/webkitgtk/webkitgtk-6.0/ # minibrowser and jsc are split out to later packages
        - /usr/libexec/webkitgtk-6.0/
        - /usr/share/locale/*/*/WebKitGTK-6.0.mo
    - ^libwebkit-gtk6-devel :
        - /usr/include/webkitgtk-6.0/
        - /usr/lib64/libwebkitgtk-6.0.so
        - /usr/lib64/webkitgtk/webkitgtk-6.0/MiniBrowser
        - /usr/lib64/pkgconfig/webkitgtk*-6.0.pc
        - /usr/share/gir-1.0/WebKit*-6.0.gir
    - ^javascriptcore-gtk6 :
        - /usr/lib64/libjavascriptcoregtk-6.0.so.*
        - /usr/lib64/girepository-1.0/JavaScriptCore-6.0.typelib
        - /usr/libexec/webkitgtk-6.0/jsc
    - ^javascriptcore-gtk6-devel :
        - /usr/include/webkitgtk-6.0/jsc/
        - /usr/lib64/libjavascriptcoregtk-6.0.so
        - /usr/lib64/webkitgtk/webkitgtk-6.0/jsc
        - /usr/lib64/pkgconfig/javascriptcoregtk-6.0.pc
        - /usr/share/gir-1.0/JavaScriptCore-6.0.gir
    - ^libwebkit-gtk6-docs :
        - /usr/share/doc/javascriptcoregtk-6.0/
        - /usr/share/doc/webkitgtk-6.0/
        - /usr/share/doc/webkitgtk-web-process-extension-6.0/

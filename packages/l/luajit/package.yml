# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : luajit
version    : 2.1.1767980792
release    : 20
source     :
    - https://github.com/LuaJIT/LuaJIT/archive/refs/heads/v2.1/luajit-2.1.1767980792.tar.gz : 00361a660e4496dc125818ea6881d17e1c45a341e5400edfd531f2ba5ce863d7
    - https://github.com/LuaJIT/LuaJIT-test-cleanup/archive/refs/heads/master/LuaJIT-test-cleanup.tar.gz : e27fc51e3b2666cc1086e08f55a3ae90c5ecef6f6cbb445a374c74d83bf232bf
homepage   : https://luajit.org
license    : MIT
summary    : Just-in-time compiler and drop-in replacement for Lua 5.1
component  : programming.library
description: |
    Just-in-time compiler and drop-in replacement for Lua 5.1
builddeps  :
    - git
build      : |
    tar -xf ${sources}/LuaJIT-test-cleanup.tar.gz

    %patch -p1 -i ${pkgfiles}/luajit-2.1-make-check.patch

    ln -s LuaJIT-test-cleanup-master/bench bench
    ln -s LuaJIT-test-cleanup-master/test test

    %make amalg PREFIX=/usr INSTALL_LIB=$installdir/%libdir% XCFLAGS="-DLUAJIT_ENABLE_LUA52COMPAT"
install    : |
    %make_install PREFIX=/usr INSTALL_LIB=$installdir/%libdir%
    %install_license COPYRIGHT

    # Some build systems need an unversioned symlink to LuaJIT interpreter
    ln -sf luajit-$version $installdir/usr/bin/luajit
    rmdir $installdir/%libdir%/lua/5.1
    rmdir $installdir/%libdir%/lua
    rmdir $installdir/usr/share/lua/5.1
    rmdir $installdir/usr/share/lua
    rm $installdir/usr/lib64/libluajit-5.1.a ## `go-task check` complained
check     : |
    %make check

name       : libwebkit-gtk41
version    : 2.50.2
release    : 46
source     :
    - https://webkitgtk.org/releases/webkitgtk-2.50.2.tar.xz : 19ab61f2d44e62cd443673943d2d5341b84d08405f67a7c37b7a77ad3550f880
homepage   : https://webkitgtk.org
license    : LGPL-2.1-only
component  : desktop.web
summary    : Web rendering engine
description: |
    The WebKitGTK+ package is the port of the portable web rendering engine WebKit to the GTK+ platform.
clang      : true
optimize   :
    - no-symbolic
    - speed
    # Leads to segfaults during runtime
    # - thin-lto
builddeps  :
    - pkgconfig(enchant-2)
    - pkgconfig(gbm)
    - pkgconfig(geoclue-2.0)
    - pkgconfig(gstreamer-gl-1.0)
    - pkgconfig(gstreamer-transcoder-1.0)
    - pkgconfig(gstreamer-video-1.0)
    - pkgconfig(gtk+-3.0)
    - pkgconfig(ice)
    - pkgconfig(icu-uc)
    - pkgconfig(lcms2)
    - pkgconfig(libavif)
    - pkgconfig(libgcrypt)
    - pkgconfig(libjpeg)
    - pkgconfig(libjxl)
    - pkgconfig(libseccomp)
    - pkgconfig(libsecret-1)
    - pkgconfig(libsoup-3.0)
    - pkgconfig(libwebp)
    - pkgconfig(libwoff2dec)
    - pkgconfig(libxslt)
    - pkgconfig(ruby-3.4)
    - pkgconfig(sysprof-capture-4)
    - pkgconfig(wayland-protocols)
    - bubblewrap
    - gperf
    - hyphen-devel
    - unifdef
    - xdg-dbus-proxy
rundeps    :
    - bubblewrap
    - xdg-dbus-proxy
setup      : |
    %patch -p1 -i $pkgfiles/disable-dmabuf-nvidia.patch
    %patch -p1 -i $pkgfiles/fix-link-error.patch

    %cmake_ninja \
                 -DENABLE_DOCUMENTATION=OFF \
                 -DENABLE_SPEECH_SYNTHESIS=OFF \
                 -DENABLE_GAMEPAD=OFF \
                 -DPORT=GTK \
                 -DUSE_GTK4=OFF \
                 -DUSE_LIBBACKTRACE=OFF \
                 -DUSE_SOUP2=OFF
build      : |
    # Warning: uses 24G at -j8 with gcc toolchain
    %ninja_build
install    : |
    %ninja_install
    # Provided by webkit 6.0
    rm -frv $installdir/usr/bin

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
# Updating this package? Run the create-vpx-testdata.sh script and if the hash of the test data changes
# then let Solus staff know so they can update the new test data to sources.getsol.us
name       : libvpx
version    : 1.16.0
release    : 23
source     :
    - https://github.com/webmproject/libvpx/archive/refs/tags/v1.16.0.tar.gz : 7a479a3c66b9f5d5542a4c6a1b7d3768a983b1e5c14c60a9396edc9b649e015c
    - https://sources.getsol.us/libvpx/libvpx-test-data-23e5b86ce37d7cef.tar.zst : 23e5b86ce37d7cef8571fdd66d743de5906ee3e481dbbf6d17a5b0cc031bd61f
homepage   : https://www.webmproject.org/
license    : MIT
component  : multimedia.codecs
summary    : Reference implementation of the VP8 & VP9 codec
description: |
    Reference implementation of the VP8 & VP9 codec
emul32     : true
avx2       : true
optimize   :
    - lto
builddeps  :
    - yasm
environment: |
    export LIBVPX_TEST_DATA_PATH=$workdir/libvpx-test-data
setup      : |
    if [[ ! -z "${EMUL32BUILD}" ]]; then
        TARGET_CC=x86-linux-gcc
    else
        TARGET_CC=x86_64-linux-gcc
    fi

    # Breaks tests
    %patch -p1 -i $pkgfiles/0001-Revert-Modify-vp9_c_vs_simd_enc_test-script.patch

    tar xf $sources/libvpx-test-data*.tar.zst -C $workdir

    ./configure \
        --disable-static \
        --enable-shared \
        --enable-unit-tests \
        --enable-vp9-highbitdepth \
        --enable-vp9-postproc \
        --enable-vp9-temporal-denoising \
        --libdir=%libdir% \
        --prefix=/usr \
        --target=$TARGET_CC
build      : |
    %make
profile    : |
    LD_LIBRARY_PATH="$workdir:$LD_LIBRARY_PATH" %make exampletest-no-data-check
install    : |
    %make_install
    %install_license AUTHORS LICENSE
check      : |
    unset LD_PRELOAD
    LD_LIBRARY_PATH="$workdir:$LD_LIBRARY_PATH" %make exampletest-no-data-check

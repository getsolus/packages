name       : logseq
version    : 0.9.20
release    : 1
source     :
    - https://github.com/logseq/logseq/archive/refs/tags/0.9.20.tar.gz : 306a8e7adc78bf62f6c931bdd2a118d39bb437d7dd4cfe9f9193b7548de32e32
homepage   : https://logseq.com/
license    : AGPL-3.0
component  : office
summary    : A privacy-first, open-source platform for knowledge management and collaboration
description: |
    Logseq is a knowledge management and collaboration platform. It focuses on privacy, longevity, and user control. Logseq offers a range of powerful tools for knowledge management, collaboration, PDF annotation, and task management with support for multiple file formats, including Markdown and Org-mode, and various features for organizing and structuring your notes.    
networking : yes
builddeps   :
    - clojure-tools
    - git
    - nodejs
    - yarn
environment: |
    export JAVA_HOME=/usr/lib64/openjdk-17
    export PATH=$JAVA_HOME/bin:$PATH
setup      : |
    # patch :parallel-build true in shadow-cljs.edn
    %patch -p1 -i $pkgfiles/build.patch
     # download required js modules
    yarn install
    # create and sync files to folder `static`
    yarn gulp:build
    # go to folder `static` and download required js modules in static
    cd $workdir/static
    yarn install
    # go back to the top-level folder and download clojure dependencies
    cd $workdir
    clojure -P -M:cljs
build      : |
    # build
    yarn cljs:release
    # packaging javescript files to an executable
    cd $workdir/static
    yarn electron-forge package
install    : |
    export logdir=/usr/share/logseq
    # create destination folder and copy files
    install -dm00755 $installdir/$logdir
    cp -R $workdir/static/out/Logseq-linux-x64/* $installdir/$logdir/
    # create a soft link to the executable
    install -dm00755 $installdir/usr/bin
    install -m755 $pkgfiles/logseq.sh $installdir/usr/bin/logseq
    # copy xdg desktop files
    install -Dm00644 $pkgfiles/logseq.desktop $installdir/usr/share/applications/logseq.desktop

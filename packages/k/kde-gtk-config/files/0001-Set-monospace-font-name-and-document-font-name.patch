From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Reilly Brogan <reilly@reillybrogan.com>
Date: Sat, 9 Aug 2025 16:26:45 -0500
Subject: [PATCH] Set monospace-font-name and document-font-name

Part of https://bugs.kde.org/show_bug.cgi?id=487714
---
 kded/configvalueprovider.cpp | 12 ++++++++++++
 kded/configvalueprovider.h   |  1 +
 kded/gtkconfig.cpp           | 11 +++++++++++
 kded/gtkconfig.h             |  1 +
 4 files changed, 25 insertions(+)

diff --git a/kded/configvalueprovider.cpp b/kded/configvalueprovider.cpp
index abfe570..0fdea3c 100644
--- a/kded/configvalueprovider.cpp
+++ b/kded/configvalueprovider.cpp
@@ -40,6 +40,18 @@ ConfigValueProvider::ConfigValueProvider()
 {
 }
 
+QString ConfigValueProvider::fixedName() const
+{
+    static const QFont defaultFixed(QStringLiteral("Hack"), 10);
+
+    KConfigGroup configGroup = kdeglobalsConfig->group(QStringLiteral("General"));
+    QString fixedAsString = configGroup.readEntry(QStringLiteral("fixed"), defaultFixed.toString());
+    static QFont font;
+    font.fromString(fixedAsString);
+    const QString fontStyle = fontStyleHelper(font);
+    return font.family() + QStringLiteral(", ") + fontStyle + ' ' + QString::number(font.pointSize());
+}
+
 QString ConfigValueProvider::fontName() const
 {
     static const QFont defaultFont(QStringLiteral("Noto Sans"), 10);
diff --git a/kded/configvalueprovider.h b/kded/configvalueprovider.h
index 32ae577..97fb4ae 100644
--- a/kded/configvalueprovider.h
+++ b/kded/configvalueprovider.h
@@ -18,6 +18,7 @@ class ConfigValueProvider
 public:
     ConfigValueProvider();
 
+    QString fixedName() const;
     QString fontName() const;
     QString iconThemeName() const;
     QString cursorThemeName() const;
diff --git a/kded/gtkconfig.cpp b/kded/gtkconfig.cpp
index 9e82561..f25b15f 100644
--- a/kded/gtkconfig.cpp
+++ b/kded/gtkconfig.cpp
@@ -96,10 +96,17 @@ void GtkConfig::showGtkThemePreview(const QString &themeName) const
     themePreviewer->showGtk3App(themeName);
 }
 
+void GtkConfig::setFixed() const
+{
+    const QString configfixedName = configValueProvider->fixedName();
+    GSettingsEditor::setValue("monospace-font-name", configfixedName);
+}
+
 void GtkConfig::setFont() const
 {
     const QString configFontName = configValueProvider->fontName();
     Gtk2ConfigEditor::setValue(QStringLiteral("gtk-font-name"), configFontName);
+    GSettingsEditor::setValue("document-font-name", configFontName);
     GSettingsEditor::setValue("font-name", configFontName);
     SettingsIniEditor::setValue(QStringLiteral("gtk-font-name"), configFontName);
     XSettingsEditor::setValue(QStringLiteral("Gtk/FontName"), configFontName);
@@ -313,6 +320,7 @@ void GtkConfig::setColors() const
 
 void GtkConfig::applyAllSettings() const
 {
+    setFixed();
     setFont();
     setIconTheme();
     setSoundTheme();
@@ -371,6 +379,9 @@ void GtkConfig::onKdeglobalsSettingsChange(const KConfigGroup &group, const QByt
             setEventSoundsEnabled();
         }
     } else if (group.name() == QStringLiteral("General")) {
+        if (names.contains(QByteArrayLiteral("fixed"))) {
+            setFixed();
+        }
         if (names.contains(QByteArrayLiteral("font"))) {
             setFont();
         }
diff --git a/kded/gtkconfig.h b/kded/gtkconfig.h
index f11f6e9..dd867a7 100644
--- a/kded/gtkconfig.h
+++ b/kded/gtkconfig.h
@@ -24,6 +24,7 @@ public:
     GtkConfig(QObject *parent, const QVariantList &args);
     ~GtkConfig();
 
+    void setFixed() const;
     void setFont() const;
     void setIconTheme() const;
     void setSoundTheme() const;

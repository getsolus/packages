name       : kodi
version    : '18.9'
release    : 74
source     :
    - git|https://github.com/xbmc/xbmc.git : 18.9-Leia
license    : GPL-2.0-or-later
component  : desktop.multimedia
summary    : Free and open source software media center
description: |
    Kodi® (formerly known as XBMC™) is an award-winning free and open source (GPL) software media center for playing videos, music, pictures, games, and more.

    The Solus Kodi build includes all official binary add-ons.
networking : yes
replaces   :
    - kodi-addon-inputstream-adaptive
    - kodi-pvr-iptvsimple
builddeps  :
    - pkgconfig(RapidJSON)
    - pkgconfig(alsa)
    - pkgconfig(avahi-client)
    - pkgconfig(bluez)
    - pkgconfig(dbus-1)
    - pkgconfig(fmt)
    - pkgconfig(fstrcmp)
    - pkgconfig(gbm)
    - pkgconfig(glu)
    - pkgconfig(lcms2)
    - pkgconfig(libass)
    - pkgconfig(libavcodec)
    - pkgconfig(libbluray)
    - pkgconfig(libcap)
    - pkgconfig(libcdio)
    - pkgconfig(libcec)
    - pkgconfig(libcurl)
    - pkgconfig(libdrm)
    - pkgconfig(libdvdcss)
    - pkgconfig(libjpeg)
    - pkgconfig(liblzma)
    - pkgconfig(libmicrohttpd)
    - pkgconfig(libmodplug)
    - pkgconfig(libnfs)
    - pkgconfig(libplist-2.0)
    - pkgconfig(libpulse)
    - pkgconfig(libraw)
    - pkgconfig(libssh)
    - pkgconfig(libusb-1.0)
    - pkgconfig(libva)
    - pkgconfig(libxslt)
    - pkgconfig(libzip)
    - pkgconfig(lirc)
    - pkgconfig(mariadb)
    - pkgconfig(smbclient)
    - pkgconfig(sqlite3)
    - pkgconfig(taglib)
    - pkgconfig(tinyxml)
    - pkgconfig(vdpau)
    - pkgconfig(xrandr)
    - flatbuffers-devel
    - giflib-devel
    - git
    - gperf
    - libunistring-devel
    - lzo-devel
    - openjdk-11-devel
    - shairplay-devel
    - sndio-devel
    - swig
rundeps    :
    - libmodplug
    - shairplay
environment: PATH="$PATH:/usr/lib64/openjdk-11/bin/"
setup      : |
    # WARN: Do NOT enable binutils-gold, even if kodi says it prefers it
    #   --  binutils-gold makes the main kodi build fail.
    #

    # Fix up mariadb mysql.h include path
    %patch -p1 < $pkgfiles/mariadb-fix.patch

    mkdir kodi-build && cd kodi-build
    %cmake .. \
      -DBUILD_SHARED_LIBS=ON \
      -DENABLE_EVENTCLIENTS=ON \
      -DENABLE_MARIADBCLIENT=ON \
      -DMARIADBCLIENT_INCLUDE_DIR=/usr/include/mysql \
      -DENABLE_MYSQLCLIENT=OFF \
      -DLIRC_DEVICE=/run/lirc/lircd

    # INFO: To display available configuration variables and
    #       their detected values, uncomment the following:
    #
    #cmake .. -L | awk '{if(f)print} /-- Cache values/{f=0}'
    #exit 1  # stop the build here to inspect config options
    #
build      : |
    # main kodi build
    #
    %make -C kodi-build

    # INFO: noiser build for troubleshooting purposes
    #%make VERBOSE=1 -j1 -C kodi-build
    #
install    : |
    # install kodi proper
    #
    %make_install -C kodi-build

    # INFO: The binary addons need to reference installed Kodi software
    #       artifacts.
    #       Since we're building a "batteries included" version
    #       of Kodi in one go, we need to violate the configure/build/install
    #       order here and only configure *after* kodi has been installed to
    #       the CMAKE_INSTALL_PREFIX.
    #
    #       Note that the default binary add-on make target includes all sorts
    #       of fancy dependency fetching/building with vendored libs
    #       plus an install target.
    #
    %make -C tools/depends/target/binary-addons PREFIX="$installdir/usr"
check      : |
    # INFO: Tests last forever. You can run them locally but please make sure
    #       the commands are commented out before publishing
    #
    #%make check -C kodi-build

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: e2fsprogs
version: 1.47.3
release: 30
source:
    - https://mirrors.edge.kernel.org/pub/linux/kernel/people/tytso/e2fsprogs/v1.47.3/e2fsprogs-1.47.3.tar.xz: 857e6ef800feaa2bb4578fbc810214be5d3c88b072ea53c5384733a965737329
homepage: https://e2fsprogs.sourceforge.net
license:
    - GPL-2.0-only
    - LGPL-2.0-only
    - BSD-3-Clause
    - MIT
component: system.base
autodep: false
emul32: true
summary: e2fsprogs (Filesystem utilities for ext2/3/4 filesystems)
description: |
    e2fsprofs are tools for checking and creating ext2, ext3, and ext4 filesystem formats.  They were written by Theodore Ts'o and Remy Card.
builddeps:
    - pkgconfig32(uuid)
    - glibc-32bit-devel
    - libgcc-32bit
setup: |
    %patch -p1 -i $pkgfiles/0001-Stateless.patch

    %patch -p1 -i $pkgfiles/0001-Don-t-run-ldconfig-on-make-install.patch

    %configure --with-root-prefix="" \
        --enable-elf-shlibs \
        --enable-symlink-install \
        --disable-libblkid \
        --disable-libuuid \
        --disable-static \
        --disable-uuidd
build: |
    %make
install: |
    if [ -n "${EMUL32BUILD+set}" ]; then
        %make install-libs DESTDIR="$installdir"
        exit 0
    fi
    %make_install

    # Duplicate file with util-linux
    rm $installdir/usr/sbin/fsck
    rm $installdir/usr/share/man/man8/fsck.8

    # Stateless
    rm -v $installdir/etc/e2scrub.conf
    rmdir -v $installdir/etc
check: |
    # Remove mmp since it fails on build server
    rm -rf tests/*mmp*
    %make check -k 0 || :

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : elfutils
version    : '0.194'
release    : 30
source     :
    - https://sourceware.org/elfutils/ftp/0.194/elfutils-0.194.tar.bz2 : 09e2ff033d39baa8b388a2d7fbc5390bfde99ae3b7c67c7daaf7433fbcf0f01e
homepage   : https://fedorahosted.org/elfutils/
license    :
    - GPL-2.0-or-later
    - LGPL-3.0-or-later
component  :
    - programming.tools
    - ^debuginfod : programming.tools
    - ^libdebuginfod-devel : programming.devel
    - ^libdw : system.base
    - ^libdw-devel : programming.devel
    - ^libdw-32bit : emul32
    - ^libdw-32bit-devel : programming.devel
    - ^libelf : system.base
    - ^libelf-devel : programming.devel
    - ^libelf-32bit : emul32
    - ^libelf-32bit-devel : programming.devel
emul32     : true
summary    : Utilities and library for manipulating ELF files
description: |
    The elfutils package contains set of utilities and libraries for handling ELF (Executable and Linkable Format) files.
builddeps  :
    - pkgconfig32(bzip2)
    - pkgconfig32(json-c)
    - pkgconfig32(libarchive)
    - pkgconfig32(libcurl)
    - pkgconfig32(liblzma)
    - pkgconfig32(libzstd)
    - pkgconfig32(zlib)
    - pkgconfig(libmicrohttpd)
    - pkgconfig(sqlite3)
rundeps    :
    - ^debuginfod :
        - libdebuginfod
    - ^libdebuginfod-devel :
        - libelf-devel
        - libdebuginfod
        - libdw-devel
    - ^libdw-32bit :
        - libdw
    - ^libdw-32bit-devel :
        - libdw-32bit
        - libdw-devel
    - ^libdw-devel :
        - libdw
    - ^libelf-32bit :
        - libelf
    - ^libelf-32bit-devel :
        - libelf-32bit
        - libelf-devel
    - ^libelf-devel :
        - libelf
    - devel :
        - libdw-devel
        - libelf-devel
setup      : |
    if [[ ! -z "${EMUL32BUILD}" ]]; then
        debuginfod="--disable-debuginfod"
    fi

    %patch -p1 -i $pkgfiles/0001-config-Hardcode-profile-to-look-in-usr-share-default.patch

    %configure --disable-static \
            --program-prefix=eu- \
            --enable-deterministic-archives \
            $debuginfod
build      : |
    %make
install    : |
    %make_install

    install -dm00755 $installdir/usr/share/defaults/etc/profile.d
    mv $installdir/etc/profile.d/* $installdir/usr/share/defaults/etc/profile.d/

    install -dm00755 $installdir/usr/share/defaults/etc/debuginfod
    echo "https://debuginfod.getsol.us" > $installdir/usr/share/defaults/etc/debuginfod/solus.urls

    rm -rvf $installdir/etc

    # No static libs!
    rm -v $installdir/%libdir%/lib*.a
check      : |
    %make check || ( cat tests/test-suite.log && exit 1 )
patterns   :
    - ^libdebuginfod-devel :
        - /usr/include/elfutils/debuginfod.h
        - /usr/lib64/libdebuginfod.so
        - /usr/lib64/pkgconfig/libdebuginfod.pc
        - /usr/share/man/man3/debuginfod*
    - ^libdebuginfod :
        - /usr/lib64/libdebuginfod-*.so
        - /usr/lib64/libdebuginfod.so.1
        - /usr/share/defaults/
        - /usr/share/fish/
        - /usr/share/man/man7/debuginfod-client-config.7*
    - ^libdw-devel :
        - /usr/include/dwarf.h
        - /usr/include/elfutils/known-dwarf.h
        - /usr/include/elfutils/libdw*.h
        - /usr/lib64/libdw*
        - /usr/lib64/pkgconfig/libdw.pc
    - ^libdw :
        - /usr/lib64/libdw-*.so
        - /usr/lib64/libdw.so.1
    - ^libdw-32bit-devel :
        - /usr/lib32/libdw.so
        - /usr/lib32/pkgconfig/libdw.pc
    - ^libdw-32bit :
        - /usr/lib32/libdw-*.so
        - /usr/lib32/libdw.so.1
    - ^libelf-devel :
        - /usr/include/elfutils/elf-knowledge.h
        - /usr/include/elfutils/version.h
        - /usr/include/gelf.h
        - /usr/include/libelf.h
        - /usr/include/nlist.h
        - /usr/lib64/libelf*
        - /usr/lib64/pkgconfig/libelf.pc
    - ^libelf :
        - /usr/lib64/libelf-*.so
        - /usr/lib64/libelf*.so.1
    - ^libelf-32bit-devel :
        - /usr/lib32/libelf.so
        - /usr/lib32/pkgconfig/libelf.pc
    - ^libelf-32bit :
        - /usr/lib32/libelf-*.so
        - /usr/lib32/libelf.so.1
    - ^debuginfod :
        - /usr/bin/debuginfod*
        - /usr/share/man/man1/debuginfod-find.1*
        - /usr/share/man/man8/debuginfod*.8*
    - main :
        - /usr/lib64/libasm-*.so

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Evan Maddock <maddock.evan@vivaldi.net>
Date: Sat, 1 Nov 2025 19:41:27 -0400
Subject: [PATCH] libpeas girepository2

Signed-off-by: Evan Maddock <maddock.evan@vivaldi.net>
---
 meson.build                         | 1 -
 src/entangle-main.c                 | 7 ++++---
 src/frontend/entangle-application.c | 2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/meson.build b/meson.build
index 90873ef..2cd41fc 100644
--- a/meson.build
+++ b/meson.build
@@ -42,7 +42,6 @@ pango_dep = dependency('pango', version: pango_min_version)
 pango_cairo_dep = dependency('pangocairo', version: pango_min_version)
 gphoto2_dep = dependency('libgphoto2', version: gphoto2_min_version)
 gudev_dep = dependency('gudev-1.0', version: gudev_min_version)
-gobject_introspection_dep = dependency('gobject-introspection-1.0', version: gobject_introspection_min_version)
 lcms2_dep = dependency('lcms2', version: lcms2_min_version)
 libpeas_dep = dependency('libpeas-1.0', version: libpeas_min_version)
 libpeas_gtk_dep = dependency('libpeas-gtk-1.0', version: libpeas_min_version)
diff --git a/src/entangle-main.c b/src/entangle-main.c
index 970bfee..f08b552 100644
--- a/src/entangle-main.c
+++ b/src/entangle-main.c
@@ -21,7 +21,7 @@
 #include <locale.h>
 #include <stdio.h>
 
-#include <girepository.h>
+#include <girepository/girepository.h>
 #include <glib/gi18n.h>
 #include <gst/gst.h>
 #include <gtk/gtk.h>
@@ -46,7 +46,7 @@ main(int argc, char **argv)
           "Enable debugging of application code", NULL },
         { "debug-gphoto", 'g', 0, G_OPTION_ARG_NONE, &debug_gphoto,
           "Enable debugging of gphoto library", NULL },
-        { "introspect-dump", 'i', 0, G_OPTION_ARG_STRING, &ins,
+        { "introspect-dump", 'i', 0, G_OPTION_ARG_FILENAME, &ins,
           "Dump introspection data", NULL },
         { NULL, 0, 0, 0, NULL, NULL, NULL },
     };
@@ -80,7 +80,8 @@ main(int argc, char **argv)
     gst_init(NULL, NULL);
 
     if (ins) {
-        g_irepository_dump(ins, NULL);
+        gchar **parts = g_strsplit(ins, ",", 2);
+        gi_repository_dump(parts[0], parts[1], NULL);
         return 0;
     }
 
diff --git a/src/frontend/entangle-application.c b/src/frontend/entangle-application.c
index 3e3e1af..f7c03d5 100644
--- a/src/frontend/entangle-application.c
+++ b/src/frontend/entangle-application.c
@@ -470,7 +470,7 @@ entangle_application_init(EntangleApplication *app)
     app->activeCameras = entangle_camera_list_new_active();
     app->supportedCameras = entangle_camera_list_new_supported();
 
-    g_irepository_require(g_irepository_get_default(), "Peas", "1.0", 0, NULL);
+    gi_repository_require(gi_repository_dup_default(), "Peas", "1.0", 0, NULL);
 
     userdir =
         g_build_filename(g_get_user_config_dir(), "entangle/plugins", NULL);

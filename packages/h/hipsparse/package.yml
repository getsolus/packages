# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : hipsparse
version    : 7.0.2
release    : 6
source     :
    - https://github.com/ROCm/rocm-libraries/archive/refs/tags/rocm-7.0.2.tar.gz : 85b8afb2e233bb99567b44be7e3655e5272f9bdb36776a60efc1304eddea8c85
homepage   : https://github.com/ROCmSoftwarePlatform/hipSPARSE
license    : MIT
component  : programming.library
summary    : ROCm SPARSE marshalling library
description: |
    hipSPARSE is a SPARSE marshalling library, with multiple supported backends. It sits between the application and a 'worker' SPARSE library, marshalling inputs into the backend library and marshalling results back to the application. hipSPARSE exports an interface that does not require the client to change, regardless of the chosen backend. Currently, hipSPARSE supports rocSPARSE and cuSPARSE as backends.
builddeps  :
    - rocsparse-devel
    - rocm-cmake
    - rocm-hip
environment: |
    export CXXFLAGS="${CXXFLAGS/-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=32/-fcf-protection=none}"

    export ROCM_PATH=/usr
    export HIP_CLANG_PATH=/usr/lib64/llvm-rocm/bin
    export HIP_DEVICE_LIB_PATH=/usr/lib64/amdgcn/bitcode

    if [ -e /usr/bin/sccache ]; then
        export CMAKE_CXX_COMPILER_LAUNCHER=/usr/bin/sccache
    fi
setup      : |
    %cmake_ninja -L projects/hipsparse \
      -DCMAKE_CXX_COMPILER=$HIP_CLANG_PATH/clang++ \
      -DBUILD_CLIENTS_TESTS=OFF \
      -DBUILD_CLIENTS_SAMPLES=OFF \
      -DCMAKE_INSTALL_LIBDIR=lib%LIBSUFFIX% \
      -DROCM_SYMLINK_LIBS=OFF \
      -DAMDGPU_TARGETS="%AMDGPUTARGETS%"
build      : |
    %ninja_build
install    : |
    %ninja_install

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : hipcub
version    : 7.0.2
release    : 6
source     :
    - https://github.com/ROCm/rocm-libraries/archive/refs/tags/rocm-7.0.2.tar.gz : 85b8afb2e233bb99567b44be7e3655e5272f9bdb36776a60efc1304eddea8c85
homepage   : https://github.com/ROCmSoftwarePlatform/hipCUB
license    : MIT
component  : programming.library
summary    : Reusable software components for ROCm developers
description: |
    hipCUB is a thin wrapper library on top of rocPRIM or CUB. It enables developers to port a project using the CUB library to the HIP layer to run on AMD hardware. In the ROCm environment, hipCUB uses the rocPRIM library as the backend. However, on CUDA platforms it uses CUB instead.
patterns   : /*
builddeps  :
    - rocprim
    - rocm-cmake
    - rocm-hip
environment: |
    export CXXFLAGS="${CXXFLAGS/-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=32/-fcf-protection=none}"

    export ROCM_PATH=/usr
    export HIP_CLANG_PATH=/usr/lib64/llvm-rocm/bin
    export HIP_DEVICE_LIB_PATH=/usr/lib64/amdgcn/bitcode
setup      : |
    pushd projects/hipcub
        sed -i 's|set(ROCM_INSTALL_LIBDIR lib)|set(ROCM_INSTALL_LIBDIR lib%LIBSUFFIX%)|' cmake/ROCMExportTargetsHeaderOnly.cmake
    popd

    %cmake_ninja projects/hipcub -L \
      -DCMAKE_C_COMPILER=$HIP_CLANG_PATH/clang \
      -DCMAKE_CXX_COMPILER=$HIP_CLANG_PATH/clang++ \
      -DCMAKE_INSTALL_LIBDIR=lib%LIBSUFFIX% \
      -DROCM_SYMLINK_LIBS=OFF \
      -DAMDGPU_TARGETS="%AMDGPUTARGETS%"
build      : |
    %ninja_build
install    : |
    %ninja_install

name       : httpd
version    : 2.4.51
release    : 22
source     :
    - https://downloads.apache.org/httpd/httpd-2.4.51.tar.gz : c2cedb0b47666bea633b44d5b3a2ebf3c466e0506955fbc3012a5a9b078ca8b4
license    : Apache-2.0
component  : programming
summary    : A secure, efficient and extensible server that provides HTTP services in sync with the current HTTP standards
description: |
    A secure, efficient and extensible server that provides HTTP services in sync with the current HTTP standards.
builddeps  :
    - pkgconfig(apr-util-1)
    - pkgconfig(libnghttp2)
    - pkgconfig(libpcre)
    - pkgconfig(openssl)
    - fcgi-devel
    - openldap-devel
    - perl
setup      : |
    %apply_patches
    cat $pkgfiles/solus.layout >> config.layout
    %configure \
        --datadir=/usr/share/httpd \
        --disable-static \
        --enable-alias \
        --enable-allowmethods \
        --enable-auth-basic \
        --enable-auth-form \
        --enable-authn-file \
        --enable-authnz-fcgi \
        --enable-authz-user \
        --enable-autoindex \
        --enable-cache \
        --enable-cache-disk \
        --enable-cgi \
        --enable-dav \
        --enable-dav-fs \
        --enable-dir \
        --enable-disk-cache \
        --enable-deflate \
        --enable-expires \
        --enable-headers \
        --enable-http2 \
        --enable-layout=Solus \
        --enable-mime \
        --enable-mpms-shared="all" \
        --enable-proxy-fcgi \
        --enable-proxy-http2 \
        --enable-remoteip \
        --enable-rewrite \
        --enable-so \
        --enable-ssl \
        --enable-static-fcgistarter \
        --enable-status \
        --enable-worker=static \
        --sysconfdir=/usr/share/defaults/httpd \
        --with-mpm=worker
build      : |
    %make
install    : |
    %make_install -j1
    # Install httpd systemd stuff
    install -Dm00644 $pkgfiles/httpd.service $installdir/%libdir%/systemd/system/httpd.service
    install -Dm00644 $pkgfiles/httpd.sysusers $installdir/%libdir%/sysusers.d/httpd.conf
    install -Dm00644 $pkgfiles/httpd.tmpfiles $installdir/%libdir%/tmpfiles.d/httpd.conf
    # Cleanup
    rm -rf $installdir/{run,var}

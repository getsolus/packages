name       : dbus
version    : 1.10.14
release    : 15
source     :
    - https://dbus.freedesktop.org/releases/dbus/dbus-1.10.14.tar.gz : 23238f70353e38ce5ca183ebc9525c0d97ac00ef640ad29cf794782af6e6a083
license    :
    - GPL-2.0
    - LGPL-2.1
summary    : System Message Daemon
builddeps  :
    - pkgconfig32(expat)
    - pkgconfig32(glib-2.0)
    - pkgconfig32(x11)
    - pkgconfig32(libudev)
emul32     : yes
component  : system.base
patterns   :
    - devel: /usr/lib64/dbus-1.0/include/
    - 32bit-devel: /usr/lib32/dbus-1.0/include/
description: |
    D-Bus is a message bus system, a simple way for applications to talk to one
    another. D-Bus supplies both a system daemon (for events such as
    "new hardware device added" or "printer queue changed") and a per-user
    login-session daemon (for general IPC needs among user applications).
    Also, the message bus is built on top of a general one-to-one message
    passing framework, which can be used by any two applications to communicate
    directly (without going through the message bus daemon).
setup      : |
    %patch -p1 < $pkgfiles/no-fatal-warnings.patch
    %configure --prefix=/usr \
               --libexecdir=%libdir%/dbus-1.0 \
               --with-console-auth-dir=/run/console/ \
               --with-systemdsystemunitdir=/usr/lib/systemd/system \
               --with-system-pid-file=/run/dbus/pid \
               --with-system-socket=/run/dbus/system_bus_socket \
               --enable-epoll \
               --enable-user-session \
               --disable-static
build      : |
    %make
install    : |
    %make_install
    rm -rf $installdir/var
    if [[ ! -z "${EMUL32BUILD}" ]]; then
        rm -v $installdir/%libdir%/dbus-1.0/dbus-daemon-launch-helper
    else
        chmod o+x $installdir/%libdir%/dbus-1.0/dbus-daemon-launch-helper
        install -D -m 00644 $pkgfiles/dbus.tmpfiles $installdir/%libdir%/tmpfiles.d/dbus.conf
        install -D -m 00644 $pkgfiles/dbus.sysusers $installdir/%libdir%/sysusers.d/dbus.conf
    fi

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : dbus-broker
version    : '37'
release    : 12
source     :
    - https://github.com/bus1/dbus-broker/releases/download/v37/dbus-broker-37.tar.xz : f819a8db8795fa08c767612e3823fd594694a0990f2543ecf35d6a1a6bf2ab5b
homepage   : https://github.com/bus1/dbus-broker/wiki
license    : Apache-2.0
component  : system.base
summary    : Linux D-Bus Message Broker
description: |
    The dbus-broker project is an implementation of a message bus as defined by the D-Bus specification. Its aim is to provide high performance and reliability, while keeping compatibility to the D-Bus reference implementation. It is exclusively written for Linux systems, and makes use of many modern features provided by recent linux kernel releases.
builddeps  :
    - pkgconfig(audit)
    - pkgconfig(libcap-ng)
    - python-docutils
setup      : |
    %meson_configure -Daudit=true \
                     -Ddocs=true
build      : |
    %ninja_build
install    : |
    %ninja_install

    # Enable the system service by default
    ln -s dbus-broker.service $installdir/usr/lib/systemd/system/dbus.service

    # And the user service
    ln -s dbus-broker.service $installdir/usr/lib/systemd/user/dbus.service
check      : |
    unset LD_PRELOAD
    # dbus-broker:unit / D-Bus Socket Options fails on build server
    %ninja_check || :

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : feishin
version    : 1.0.2
release    : 1
source     :
    - https://github.com/jeffvli/feishin/archive/refs/tags/v1.0.2.tar.gz : a31790629db11f53dabdaf02f4eef49f39f88c825de52a2fe9e89b5399f57c7d
homepage   : https://github.com/jeffvli/feishin
license    : GPL-3.0-or-later
component  : multimedia.audio
summary    : A modern self-hosted music player.
description: |
    A modern self-hosted music player. Supports Jellyfin and Subsonic-compatible servers, including Navidrome and others.
patterns   :
    - /*
builddeps  :
    - pkgconfig(alsa)
    - pkgconfig(atkmm-1.6)
    - pkgconfig(gbm)
    - pkgconfig(gdk-3.0)
    - pkgconfig(x11)
    - pkgconfig(xcomposite)
    - pkgconfig(xdamage)
    - libxcrypt-devel
    - nodejs-20
    - pnpm
networking : true
setup      : |
    %patch -p1 -i $pkgfiles/0001-Bump-electron-version.patch
    pnpm install
build      : |
    pnpm run build:electron
    pnpm exec electron-builder -l dir
install    : |
    # Installdir for Feishin
    feishin_installdir=$installdir/usr/share/feishin
    install -dm00644 $feishin_installdir

    # Install the actual program
    cp -Rv dist/linux-unpacked/* $feishin_installdir
    install -dm00644 $installdir/usr/bin
    ln -s /usr/share/feishin/feishin $installdir/usr/bin/feishin

    # Generate a .desktop file in exactly the same way that Feishin's official installer does
    export FEISHIN_DESKTOP_EXECUTABLE="feishin"
    export FEISHIN_DESKTOP_ARGS=""
    install -dm00644 $installdir/usr/share/applications/
    cat feishin.desktop.tmpl | envsubst > $installdir/usr/share/applications/org.jeffvli.feishin.desktop

    # Install appstream metainfo
    install -Dm00644 org.jeffvli.feishin.metainfo.xml $installdir/usr/share/metainfo/org.jeffvli.feishin.metainfo.xml

    # Install icon
    install -Dm00644 resources/icon.png $installdir/usr/share/icons/hicolor/512x512/apps/org.jeffvli.feishin.png

    # Install license
    %install_license LICENSE

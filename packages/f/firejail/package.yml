# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: firejail
version: 0.9.76
release: 17
source:
    - https://github.com/netblue30/firejail/releases/download/0.9.76/firejail-0.9.76.tar.xz: 6bfaa57e10897f65cc1183b330974d555669d888d6897c7a8739bb1d334d9e4a
homepage: https://firejail.wordpress.com/
license: GPL-2.0-or-later
component: security
summary: Sandbox your applications
description: |
    Firejail is a SUID sandbox program that reduces the risk of security breaches by restricting the running environment of untrusted applications. It allows a process and all its descendants to have their own private view of the globally shared kernel resources, such as the network stack, process table, mount table.
builddeps:
    - pkgconfig(libapparmor) # Tests
    - expect # Tests
setup: |
    # Stateless
    %patch -p1 -i $pkgfiles/0001-solus-Support-a-stateless-configuration.patch
    %patch -p1 -i $pkgfiles/0002-Fix-apparmor-profile.patch
    %patch -p1 -i $pkgfiles/0003-Use-stateless-login.defs.patch

    # Fix for Glycin, used in gdk-pixbuf
    # See https://github.com/netblue30/firejail/issues/6906
    %patch -p1 -i $pkgfiles/fix-glycin.patch

    %reconfigure --enable-apparmor
build: |
    %make
install: |
    %make_install

    install -Dm00644 $pkgfiles/firejail.tmpfiles $installdir/usr/lib/tmpfiles.d/firejail.conf

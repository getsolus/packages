# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: colord
version: 1.4.8
release: 25
source:
    - https://www.freedesktop.org/software/colord/releases/colord-1.4.8.tar.xz: 21500bd68975312a7f0f3ce6019d9f75f42aacaa75ca7115ec720b5445406896
homepage: https://www.freedesktop.org/software/colord/
license: GPL-2.0-or-later
component: desktop.core
summary: Color Daemon
description: |
    colord is a system service that makes it easy to manage, install and generate color profiles to accurately color manage input and output devices.
builddeps:
    - pkgconfig32(dbus-1)
    - pkgconfig32(glib-2.0)
    - pkgconfig32(gudev-1.0)
    - pkgconfig32(gusb)
    - pkgconfig32(lcms2)
    - pkgconfig32(libgcrypt)
    - pkgconfig32(liblzma)
    - pkgconfig32(libsystemd)
    - pkgconfig32(libusb-1.0)
    - pkgconfig32(sqlite3)
    - pkgconfig(gtk-doc)
    - vala
emul32: true
setup: |
    %patch -p1 -i $pkgfiles/Fix-writing-to-the-database-with-ProtectSystem-strict.patch

    if [[ ! -z "${EMUL32BUILD}" ]]; then
        exOpts="-Ddaemon=false -Dvapi=false -Dintrospection=false"
    else
        exOpts="-Ddaemon=true -Dvapi=true -Dintrospection=true"
    fi
    %meson_configure \
        -Dargyllcms_sensor=false \
        -Ddaemon_user=colord \
        -Ddocs=false \
        $exOpts
build: |
    %ninja_build
install: |
    %ninja_install
    if [[ ! -z "${EMUL32BUILD}" ]]; then
        # Remove derps.
        rm -rf $installdir/%libdir%/colord{,-plugins,-sensors}
        rm -rf $installdir/%libdir%/udev
    else
        install -D -m 00644 $pkgfiles/colord.sysusers $installdir/%libdir%/sysusers.d/colord.conf
    fi
    rm -rf $installdir/var

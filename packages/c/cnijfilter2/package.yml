# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: cnijfilter2
version: 6.80
release: 1
source:
    - https://gdlp01.c-wss.com/gds/2/0100012302/02/cnijfilter2-source-6.80-1.tar.gz: 5d5b6ba67f0025616d9b1e9d55a613bd812bc343c9df002e570a832182cfc1d3
homepage: https://www.canon.com/home-printers
license:
    - GPL-2.0-or-later
    - Distributable
component: desktop.library
summary: Canon IJ Printer Driver for Linux
description: |
    Canon PIXMA E200 series
    Canon PIXMA E300 series
    Canon PIXMA E3100 series
    Canon PIXMA E460 series
    Canon PIXMA E470 series
    Canon PIXMA E480 series
    Canon PIXMA G3000 series
    Canon PIXMA G4000 series
    Canon MAXIFY iB4000 series
    Canon MAXIFY iB4100 series
    Canon PIXMA iP110
    Canon MAXIFY MB2000 series
    Canon MAXIFY MB2100 series
    Canon MAXIFY MB2300 series
    Canon MAXIFY MB2700 series
    Canon MAXIFY MB5000 series
    Canon MAXIFY MB5100 series
    Canon MAXIFY MB5300 series
    Canon MAXIFY MB5400 series
    Canon PIXMA MG2900 series
    Canon PIXMA MG3000 series
    Canon PIXMA MG3600 series
    Canon PIXMA MG5600 series
    Canon PIXMA MG5700 series
    Canon PIXMA MG6600 series
    Canon PIXMA MG6800 series
    Canon PIXMA MG6900 series
    Canon PIXMA MG7500 series
    Canon PIXMA MG7700 series
    Canon PIXMA MX490 series
    Canon PIXMA TR7500 series
    Canon PIXMA TR7530
    Canon PIXMA TR8500 series
    Canon PIXMA TR8530
    Canon PIXMA TR8580
    Canon PIXMA TS200 series
    Canon PIXMA TS300 series
    Canon PIXMA TS3100 series
    Canon PIXMA TS5000 series
    Canon PIXMA TS5100 series
    Canon PIXMA TS6000 series
    Canon PIXMA TS6100 series
    Canon PIXMA TS6130
    Canon PIXMA TS6180
    Canon PIXMA TS8000 series
    Canon PIXMA TS8100 series
    Canon PIXMA TS8130
    Canon PIXMA TS8180
    Canon PIXMA TS9000 series
    Canon PIXMA TS9100 series
    Canon PIXMA TS9180
    Canon PIXMA XK50
    Canon PIXMA XK70
libsplit: false
builddeps:
    - pkgconfig(cups)
    - pkgconfig(libusb-1.0)
    - pkgconfig(libxml-2.0)
environment: |
    export LDFLAGS="${LDFLAGS} -L$workdir/com/libs_bin_x86_64"
setup: |
    # multiple definitions linker error stolen from AUR
    sed -e '/GET_PROTOCOL/ s:^int:extern &:g' -i 'lgmon3/src/cnijlgmon3.c'

    %patch -p1 -i $pkgfiles/gcc-14.patch
    %patch -p1 -i $pkgfiles/gcc-15.patch
    %patch -p1 -i $pkgfiles/libxml2-include.patch
build: |
    pushd cmdtocanonij2
    %autogen
    %make
    popd

    pushd cmdtocanonij3
    %autogen
    %make
    popd

    pushd cnijbe2
    %autogen --enable-progpath=/usr/bin
    %make
    popd

    pushd lgmon3
    %autogen --enable-libpath=/usr/lib/bjlib2 \
             --enable-progpath=/usr/bin
    %make
    popd

    pushd rastertocanonij
    %autogen --enable-progpath=/usr/bin
    %make
    popd

    pushd tocanonij
    %autogen
    %make
    popd

    pushd tocnpwg
    %autogen
    %make
    popd
install: |
    install -Dm00644 com/ini/cnnet.ini $installdir/%libdir%/bjlib2
    install -sm00755 com/libs_bin_x86_64/*.so $installdir/%libdir%

    pushd ppd
    install -Dm00644 -t $installdir/usr/share/cups/model/canon *.ppd
    popd

    pushd cmdtocanonij2
    %make_install
    popd

    pushd cmdtocanonij3
    %make_install
    popd

    pushd cnijbe2
    %make_install
    popd

    pushd lgmon3
    %make_install
    popd

    pushd rastertocanonij
    %make_install
    popd

    pushd tocanonij
    %make_install
    popd

    pushd tocnpwg
    %make_install
    popd

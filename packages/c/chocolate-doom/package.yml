# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: chocolate-doom
version: 3.1.1
release: 11
source:
    - https://github.com/chocolate-doom/chocolate-doom/archive/refs/tags/chocolate-doom-3.1.1.tar.gz: 1edcc41254bdc194beb0d33e267fae306556c4d24110a1d3d3f865717f25da23
homepage: https://www.chocolate-doom.org/
license: GPL-2.0-or-later
component: games.action
summary:
    - Chocolate Doom is a Doom source port that is conservative and historically accurate.
    - heretic: Chocolate Heretic is a conservative, historically-accurate Heretic source port.
    - hexen: Chocolate Hexen is a conservative, historically-accurate Hexen source port.
    - server: Chocolate Doom Server is a standalone server application that let's you play the chocolate-doom games as multiplayer without client install.
    - strife: Chocolate Strife is a conservative, historically-accurate recreation of the Strife engine.
description:
    - Chocolate Doom is a Doom source port that is conservative and historically accurate.
    - heretic: Chocolate Heretic is a conservative, historically-accurate Heretic source port.
    - hexen: Chocolate Hexen is a conservative, historically-accurate Hexen source port.
    - server: Chocolate Doom Server is a standalone server application that let's you play the chocolate-doom games as multiplayer without client install.
    - strife: Chocolate Strife is a conservative, historically-accurate recreation of the Strife engine.
builddeps:
    - pkgconfig(SDL2_mixer)
    - pkgconfig(SDL2_net)
    - pkgconfig(libpng)
    - pkgconfig(samplerate)
setup: |
    %reconfigure
build: |
    %make
install: |
    %make_install

    # Remove duplicate man pages
    rm -v $installdir/usr/share/man/man5/{default,heretic,hexen,strife}.cfg.5

    # Install addtional setup desktop file and remove unused
    for i in Doom Heretic Hexen Strife; do
        install -Dm00644 $pkgfiles/org.chocolate_doom.${i}_Setup.desktop -t $installdir/usr/share/applications/
    done
    rm -v $installdir/usr/share/applications/org.chocolate_doom.Setup.desktop
    rm -rfv $installdir/usr/share/applications/screensavers

    # Rename setup icon and create icon symlink for additional desktop file
    mv $installdir/usr/share/icons/hicolor/128x128/apps/chocolate-{setup,doom-setup}.png
    for i in heretic hexen strife; do
        ln -sfv /usr/share/icons/hicolor/128x128/apps/chocolate-doom-setup.png $installdir/usr/share/icons/hicolor/128x128/apps/chocolate-${i}-setup.png
    done
patterns:
    - heretic:
          - /usr/bin/chocolate-heretic*
          - /usr/share/applications/org.chocolate_doom.Heretic*
          - /usr/share/bash-completion/completions/chocolate-heretic*
          - /usr/share/doc/chocolate-heretic*
          - /usr/share/icons/hicolor/128x128/apps/chocolate-heretic*
          - /usr/share/man/man5/chocolate-heretic*
          - /usr/share/man/man6/chocolate-heretic*
          - /usr/share/metainfo/org.chocolate_doom.Heretic*
    - hexen:
          - /usr/bin/chocolate-hexen*
          - /usr/share/applications/org.chocolate_doom.Hexen*
          - /usr/share/bash-completion/completions/chocolate-hexen*
          - /usr/share/doc/chocolate-hexen*
          - /usr/share/icons/hicolor/128x128/apps/chocolate-hexen*
          - /usr/share/man/man5/chocolate-hexen*
          - /usr/share/man/man6/chocolate-hexen*
          - /usr/share/metainfo/org.chocolate_doom.Hexen*
    - server:
          - /usr/bin/chocolate-server*
          - /usr/share/man/man6/chocolate-server*
    - strife:
          - /usr/bin/chocolate-strife*
          - /usr/share/applications/org.chocolate_doom.Strife*
          - /usr/share/bash-completion/completions/chocolate-strife*
          - /usr/share/doc/chocolate-strife*
          - /usr/share/icons/hicolor/128x128/apps/chocolate-strife*
          - /usr/share/man/man5/chocolate-strife*
          - /usr/share/man/man6/chocolate-strife*
          - /usr/share/metainfo/org.chocolate_doom.Strife*

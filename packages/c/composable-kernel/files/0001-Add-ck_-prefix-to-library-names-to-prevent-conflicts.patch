From 1af58252cbf8960321005f52717f7c717bef4c1c Mon Sep 17 00:00:00 2001
From: Gavin Zhao <git@gzgz.dev>
Date: Thu, 28 Nov 2024 11:44:00 -0500
Subject: [PATCH 1/4] Add ck_ prefix to library names to prevent conflicts

Signed-off-by: Gavin Zhao <git@gzgz.dev>
---
 library/src/tensor_operation_instance/gpu/CMakeLists.txt | 8 +++++++-
 library/src/utility/CMakeLists.txt                       | 2 ++
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/library/src/tensor_operation_instance/gpu/CMakeLists.txt b/library/src/tensor_operation_instance/gpu/CMakeLists.txt
index d1466206f..7c5b8bfe9 100644
--- a/library/src/tensor_operation_instance/gpu/CMakeLists.txt
+++ b/library/src/tensor_operation_instance/gpu/CMakeLists.txt
@@ -337,6 +337,7 @@ if(CK_DEVICE_OTHER_INSTANCES AND NOT MIOPEN_REQ_LIBS_ONLY)
             PROPERTIES
             VERSION ${CMAKE_PROJECT_VERSION}
             SOVERSION ${CMAKE_PROJECT_VERSION_MAJOR}
+            OUTPUT_NAME ck_device_other_operations
         )
         target_include_directories(device_other_operations PUBLIC
             $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/ck>
@@ -374,6 +375,7 @@ if(CK_DEVICE_GEMM_INSTANCES AND NOT MIOPEN_REQ_LIBS_ONLY)
             PROPERTIES
             VERSION ${CMAKE_PROJECT_VERSION}
             SOVERSION ${CMAKE_PROJECT_VERSION_MAJOR}
+            OUTPUT_NAME ck_device_gemm_operations
         )
         target_include_directories(device_gemm_operations PUBLIC
             $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/ck/library/tensor_operation_instance/gpu>
@@ -395,6 +397,7 @@ if(CK_DEVICE_CONV_INSTANCES)
             PROPERTIES
             VERSION ${CMAKE_PROJECT_VERSION}
             SOVERSION ${CMAKE_PROJECT_VERSION_MAJOR}
+            OUTPUT_NAME ck_device_conv_operations
         )
         target_include_directories(device_conv_operations PUBLIC
             $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/ck/library/tensor_operation_instance/gpu>
@@ -419,11 +422,12 @@ if(CK_DEVICE_MHA_INSTANCES AND NOT MIOPEN_REQ_LIBS_ONLY AND BUILD_MHA_LIB)
                 PROPERTIES
                 VERSION ${CMAKE_PROJECT_VERSION}
                 SOVERSION ${CMAKE_PROJECT_VERSION_MAJOR}
+                OUTPUT_NAME ck_device_mha_operations
             )
             add_library(composablekernels::device_mha_operations ALIAS device_mha_operations)
             target_compile_features(device_mha_operations PUBLIC)
             set_target_properties(device_mha_operations PROPERTIES POSITION_INDEPENDENT_CODE ON)
-            
+
             rocm_install(TARGETS device_mha_operations
                 EXPORT device_mha_operationsTargets)
             rocm_install(EXPORT device_mha_operationsTargets
@@ -442,6 +446,7 @@ if(CK_DEVICE_CONTRACTION_INSTANCES AND NOT MIOPEN_REQ_LIBS_ONLY)
             PROPERTIES
             VERSION ${CMAKE_PROJECT_VERSION}
             SOVERSION ${CMAKE_PROJECT_VERSION_MAJOR}
+            OUTPUT_NAME ck_device_contraction_operations
         )
         target_include_directories(device_contraction_operations PUBLIC
             $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/ck/library/tensor_operation_instance/gpu>
@@ -464,6 +469,7 @@ if(CK_DEVICE_REDUCTION_INSTANCES AND NOT MIOPEN_REQ_LIBS_ONLY)
             PROPERTIES
             VERSION ${CMAKE_PROJECT_VERSION}
             SOVERSION ${CMAKE_PROJECT_VERSION_MAJOR}
+            OUTPUT_NAME ck_device_reduction_operations
         )
         target_include_directories(device_reduction_operations PUBLIC
             $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/ck/library/tensor_operation_instance/gpu/reduce>
diff --git a/library/src/utility/CMakeLists.txt b/library/src/utility/CMakeLists.txt
index 28883efef..5f87b44e3 100644
--- a/library/src/utility/CMakeLists.txt
+++ b/library/src/utility/CMakeLists.txt
@@ -19,6 +19,8 @@ if(WIN32)
     target_compile_definitions(utility PUBLIC NOMINMAX)
 endif()
 
+set_target_properties(utility PROPERTIES OUTPUT_NAME ck_utility)
+
 rocm_install(
     TARGETS utility
     EXPORT utilityTargets
-- 
2.52.0


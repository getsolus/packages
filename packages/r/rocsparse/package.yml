# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : rocsparse
version    : 7.0.2
release    : 6
source     :
    - https://github.com/ROCm/rocm-libraries/archive/refs/tags/rocm-7.0.2.tar.gz : 85b8afb2e233bb99567b44be7e3655e5272f9bdb36776a60efc1304eddea8c85
homepage   : https://github.com/ROCmSoftwarePlatform/rocSPARSE
license    : MIT
component  : programming.library
summary    : Next generation SPARSE implementation for ROCm platform
description: |
    rocSPARSE exposes a common interface that provides Basic Linear Algebra Subroutines for sparse computation implemented on top of AMD's Radeon Open eCosystem Platform ROCm runtime and toolchains. rocSPARSE is created using the HIP programming language and optimized for AMD's latest discrete GPUs.
builddeps  :
    - rocblas-devel
    - roctracer-devel
    - rocm-cmake
    - rocm-hip
    - rocprim
environment: |
    export CXXFLAGS="${CXXFLAGS/-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=32/-fcf-protection=none}"

    export ROCM_PATH=/usr
    export HIP_CLANG_PATH=/usr/lib64/llvm-rocm/bin
    export HIP_DEVICE_LIB_PATH=/usr/lib64/amdgcn/bitcode
    export CMAKE_PREFIX_PATH=/usr/lib64/llvm-rocm

    if [ -e /usr/bin/sccache ]; then
        export CMAKE_CXX_COMPILER_LAUNCHER=/usr/bin/sccache
    fi
setup      : |
    sed -i 's|find_package(rocblas 4.1.0 QUIET)|find_package(rocblas REQUIRED)|g' projects/rocsparse/CMakeLists.txt

    %cmake_ninja -S projects/rocsparse -L \
      -DCMAKE_CXX_COMPILER=$HIP_CLANG_PATH/clang++ \
      -DCMAKE_INSTALL_LIBDIR=lib%LIBSUFFIX% \
      -DROCM_SYMLINK_LIBS=OFF \
      -DBUILD_CLIENTS_SAMPLES=OFF \
      -DBUILD_WITH_ROCBLAS=ON \
      -DBUILD_WITH_ROCTX=ON \
      -DBUILD_WITH_OFFLOAD_COMPRESS=ON \
      -DGPU_TARGETS="%AMDGPUTARGETS%"
build      : |
    %ninja_build
install    : |
    %ninja_install

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : rocwmma
version    : 7.0.1
release    : 1
source     :
    - https://github.com/ROCm/rocWMMA/archive/refs/tags/rocm-7.0.1.tar.gz : f883a76b5cd397418150d9b13d267b81793d8278d874923bbec926fd07b3c5a1
homepage   : https://github.com/ROCm/rocWMMA
license    : MIT
component  : programming.library
summary    : Matrix multiply-accumulate (MMA) operations leveraging AMD GPU hardware
description: |
    rocWMMA is a C++ library for accelerating mixed-precision matrix multiply-accumulate (MMA) operations leveraging AMD GPU hardware. rocWMMA makes it easier to break down MMA problems into fragments and distribute block-wise MMA operations in parallel across GPU wavefronts. The API consists of a header library, that can be used to compile MMA acceleration directly into GPU kernel device code. This can benefit from compiler optimization in the generation of kernel assembly, and doesn't incur additional overhead costs of linking to external runtime libraries or having to launch separate kernels.
patterns   : /*
builddeps  :
    - rocblas-devel
    - rocm-cmake
    - rocm-hip
    - rocm-openmp
environment: |
    export CXXFLAGS="${CXXFLAGS/-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=32/-fcf-protection=none}"
    export CXXFLAGS+=" -w"

    export CMAKE_PREFIX_PATH=/usr/lib64/llvm-rocm
    export ROCM_PATH=/usr
    export HIP_CLANG_PATH=/usr/lib64/llvm-rocm/bin
    export HIP_DEVICE_LIB_PATH=/usr/lib64/amdgcn/bitcode

    if [ -e /usr/bin/sccache ]; then
        export CMAKE_CXX_COMPILER_LAUNCHER=/usr/bin/sccache
    fi
setup      : |
    %cmake_ninja -L \
      -DCMAKE_CXX_COMPILER=$HIP_CLANG_PATH/clang++ \
      -DCMAKE_INSTALL_LIBDIR=lib%LIBSUFFIX% \
      -DROCM_SYMLINK_LIBS=OFF \
      -DROCWMMA_BUILD_TESTS=OFF \
      -DROCWMMA_BUILD_SAMPLES=OFF \
      -DGPU_TARGETS="%AMDGPUTARGETS%" \
build      : |
    %ninja_build
install    : |
    %ninja_install

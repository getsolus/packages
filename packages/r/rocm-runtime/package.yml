# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name       : rocm-runtime
version    : 7.0.2
release    : 9
source     :
    - https://github.com/ROCm/ROCR-Runtime/archive/refs/tags/rocm-7.0.2.tar.gz : 9c2020f7a42d60fe9775865ab58464078007926a3b01f1ca8128557c89e7a566
homepage   : https://github.com/RadeonOpenCompute/ROCR-Runtime
license    : NCSA
component  : programming.devel
summary    : ROCm Runtime Library
description: |
    The ROCm Runtime Library is a thin, user-mode API that exposes the necessary interfaces to access and interact with graphics hardware driven by the AMDGPU driver set and the AMDKFD kernel driver. Together they enable programmers to directly harness the power of AMD discrete graphics devices by allowing host applications to launch compute kernels directly to the graphics hardware.
builddeps  :
    - pkgconfig(libdrm)
    - pkgconfig(libelf)
    - pkgconfig(numa)
    - rocm-device-libs-devel
    - rocprofiler-register-devel
    - rocm-llvm
    - vim # they need the xxd executable during build
environment: |
    export ROCM_PATH=/usr
    export CMAKE_PREFIX_PATH=/usr/lib64/llvm-rocm
    export HIP_DEVICE_LIB_PATH=/usr/lib64/amdgcn/bitcode
setup      : |
    %patch -p1 -i $pkgfiles/0001-rocr-Extend-HIP-ISA-compatibility-check.patch
    %patch -p1 -i $pkgfiles/0002-hsakmt-don-t-force-static-library.patch

    %cmake_ninja -L \
      -DBUILD_SHARED_LIBS=ON
build      : |
    %ninja_build
install    : |
    %ninja_install

name       : rocm-runtime
version    : 6.4.3
release    : 8
source     :
    - https://github.com/ROCm/ROCR-Runtime/archive/refs/tags/rocm-6.4.3.tar.gz : 3b23bed04cbed72304d31d69901eb76afa2099c7ac37f055348dfcda2d25e41a
homepage   : https://github.com/RadeonOpenCompute/ROCR-Runtime
license    : NCSA
component  : programming.devel
summary    : ROCm Runtime Library
description: |
    The ROCm Runtime Library is a thin, user-mode API that exposes the necessary interfaces to access and interact with graphics hardware driven by the AMDGPU driver set and the AMDKFD kernel driver. Together they enable programmers to directly harness the power of AMD discrete graphics devices by allowing host applications to launch compute kernels directly to the graphics hardware.
builddeps  :
    - pkgconfig(libdrm)
    - pkgconfig(libelf)
    # - pkgconfig(libhsakmt)
    - pkgconfig(numa)
    - rocm-device-libs-devel
    - rocprofiler-register-devel
    - rocm-llvm
    - vim # they need the xxd executable during build
environment: |
    export ROCM_PATH=/usr
    export CMAKE_PREFIX_PATH=/usr/lib64/llvm-rocm
    export HIP_DEVICE_LIB_PATH=/usr/lib64/amdgcn/bitcode
    unset CFLAGS CXXFLAGS LDFLAGS
setup      : |
    %patch -p1 -i $pkgfiles/0001-rocr-Add-missing-cstdint-include.patch
    %patch -p1 -i $pkgfiles/0002-rocr-Extend-HIP-ISA-compatibility-check.patch

    %cmake_ninja -L \
      -DBUILD_SHARED_LIBS=ON
build      : |
    %ninja_build
install    : |
    %ninja_install

# yaml-language-server: $schema=/usr/share/ypkg/schema/schema.json
name: readline6
version: 6.3.008
release: 3
source:
    - https://ftpmirror.gnu.org/gnu/readline/readline-6.3.tar.gz: 56ba6071b9462f980c5a72ab0023893b65ba6debb4eeb475d7a563dc65cafd43
homepage: https://tiswww.case.edu/php/chet/readline/rltop.html
license: GPL-3.0-or-later
component: binary.compat
summary: readline6 (Binary Compatibility Library)
description: |
    This package provides binary compatibility only. It is forbidden to build against it.
builddeps:
    - pkgconfig32(ncursesw)
emul32: true
setup: |
    %patch -p1 -i $pkgfiles/readline6.3-upstream-patches1-6.patch

    # add workaround for problem in gdb
    # in new version of readline needs to be deleted
    %patch -p1 -i $pkgfiles/readline-6.2-gdb.patch

    # fix file permissions, remove RPATH, use CFLAGS
    %patch -p1 -i $pkgfiles/readline-6.2-shlib.patch
    %patch -p1 -i $pkgfiles/readline-6.3-config.patch
    %patch -p1 -i $pkgfiles/compat-readline6-wcwidth.patch
    %patch -p1 -i $pkgfiles/compat-readline6-configure-c99.patch

    %patch -p1 -i $pkgfiles/readline-6.3-pre-c23.patch

    %configure_no_runstatedir \
        --disable-static \
        --with-curses
build: |
    export CPPFLAGS="-I/usr/include"
    # make SHLIB_LIBS=-lncurses
    %make
install: |
    %make_install

    # Only ship libraries
    for i in /usr/bin /usr/share %libdir%/pkgconfig /usr/include; do
        rm -rfv "$installdir/$i"
    done
    rm -fr $installdir/usr/share/doc/readline
    # Forbid linking too
    rm $installdir/%libdir%/*.so
